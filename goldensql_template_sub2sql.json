{
  "sql1": "Q: \"统计各个玩法上线首周留存情况\n输出：玩法、上线首周首次玩的日期、第几天留存（0,1,2...7)、玩法留存用户数\n\n各玩法首周上线日期：\n\"广域战场\": \"20240723\",\n\"消灭战\": \"20230804\",\n\"幻想混战\": \"20241115\",\n\"荒野传说\": \"20240903\",\n\"策略载具\": \"20241010\",\n\"炎夏混战\": \"20240625\",\n\"单人装备\": \"20240517\",\n\"交叉堡垒\": \"20240412\"\"\nSchema_links: [dws_jordass_mode_roundrecord_di.dtstatdate,dws_jordass_mode_roundrecord_di.vplayerid,dws_jordass_mode_roundrecord_di.submodename,dws_jordass_mode_roundrecord_di.modename]\nA: Let's think step by step. \"统计各个玩法上线首周留存情况...\" can be solved by knowing the answer to the following sub-questions \"对于每个玩法与每个玩家，首周内该玩家的首次玩的日期是什么？\" 和 \"在首周后的第0~7天中，该玩法哪些玩家有行为？\".\nThe SQL query for the sub-question \"对于每个玩法与每个玩家，首周内该玩家的首次玩的日期是什么？\" is:\n\nselect\n    itype,\n    min(dtstatdate) as dtstatdate,\n    vplayerid\nfrom (\n    select '广域战场'      as itype, min(dtstatdate) as dtstatdate, vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n      and submodename = '广域战场模式'\n    group by vplayerid\n\n    union all\n    select '消灭战', min(dtstatdate), vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n      and modename='组队竞技' and submodename like '%消灭战模式%'\n    group by vplayerid\n\n    union all\n    select '幻想混战', min(dtstatdate), vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n      and modename='创意创作间' and submodename='幻想混战'\n    group by vplayerid\n\n    union all\n    select '荒野传说', min(dtstatdate), vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n      and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n    group by vplayerid\n\n    union all\n    select '策略载具', min(dtstatdate), vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n      and modename='休闲模式' and submodename like '%策略载具%'\n    group by vplayerid\n\n    union all\n    select '炎夏混战', min(dtstatdate), vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n      and modename='创意创作间' and submodename like '%炎夏混战%'\n    group by vplayerid\n\n    union all\n    select '单人装备', min(dtstatdate), vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n      and modename='组队竞技' and submodename like '%单人装备%'\n    group by vplayerid\n\n    union all\n    select '交叉堡垒', min(dtstatdate), vplayerid\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n      and modename='组队竞技' and submodename like '%交叉堡垒%'\n    group by vplayerid\n) t\ngroup by itype, vplayerid;\n\n\nSo, the answer to the question \"统计各个玩法上线首周留存情况...\" is =\nIntermediate_representation: 使用两个派生表（a：每玩法每玩家首日；b：每玩法每玩家在首周后第0~13天的行为记录），然后按玩法、首日和 datediff 关联统计 day 维度留存人数。\nSQL:\n\nselect  a.itype,\n        a.dtstatdate,\n        datediff(b.dtstatdate,a.dtstatdate) as idaynum,\n        count(distinct a.vplayerid)           as iusernum\nfrom (                      \n    select\n        itype,\n        min(dtstatdate) as dtstatdate,\n        vplayerid\n    from  (\n        select '广域战场'      as itype,\n                min(dtstatdate) as dtstatdate,\n                vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',6)\n        and submodename = '广域战场模式'\n        group by vplayerid\n\n        union all\n        select '消灭战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',6)\n        and modename='组队竞技' and submodename like '%消灭战模式%'\n        group by vplayerid\n\n        union all\n        select '幻想混战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',6)\n        and modename='创意创作间' and submodename='幻想混战'\n        group by vplayerid\n\n        union all\n        select '荒野传说', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',6)\n        and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n        group by vplayerid\n\n        union all\n        select '策略载具', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',6)\n        and modename='休闲模式' and submodename like '%策略载具%'\n        group by vplayerid\n\n        union all\n        select '炎夏混战', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',6)\n        and modename='创意创作间' and submodename like '%炎夏混战%'\n        group by vplayerid\n\n        union all\n        select '单人装备', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',6)\n        and modename='组队竞技' and submodename like '%单人装备%'\n        group by vplayerid\n\n        union all\n        select '交叉堡垒', min(dtstatdate), vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',6)\n        and modename='组队竞技' and submodename like '%交叉堡垒%'\n        group by vplayerid\n    ) t\n    group by itype, vplayerid\n) a\nleft join (\n        select '广域战场' as itype, dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240723' and dtstatdate <= date_add('20240723',13)\n          and submodename = '广域战场模式'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '消灭战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20230804' and dtstatdate <= date_add('20230804',13)\n          and modename='组队竞技' and submodename like '%消灭战模式%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '幻想混战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241115' and dtstatdate <= date_add('20241115',13)\n          and modename='创意创作间' and submodename='幻想混战'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '荒野传说', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240903' and dtstatdate <= date_add('20240903',13)\n          and modename='休闲模式' and submodename in ('荒野传说','荒野沙漠')\n        group by dtstatdate, vplayerid\n\n        union all\n        select '策略载具', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20241010' and dtstatdate <= date_add('20241010',13)\n          and modename='休闲模式' and submodename like '%策略载具%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '炎夏混战', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240625' and dtstatdate <= date_add('20240625',13)\n          and modename='创意创作间' and submodename like '%炎夏混战%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '单人装备', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240517' and dtstatdate <= date_add('20240517',13)\n          and modename='组队竞技' and submodename like '%单人装备%'\n        group by dtstatdate, vplayerid\n\n        union all\n        select '交叉堡垒', dtstatdate, vplayerid\n        from dws_jordass_mode_roundrecord_di\n        where dtstatdate >= '20240412' and dtstatdate <= date_add('20240412',13)\n          and modename='组队竞技' and submodename like '%交叉堡垒%'\n        group by dtstatdate, vplayerid\n) b\n  on  a.itype      = b.itype\nand  a.vplayerid    = b.vplayerid\nwhere datediff(b.dtstatdate,a.dtstatdate) between 0 and 7\ngroup by a.itype, a.dtstatdate, datediff(b.dtstatdate,a.dtstatdate);\n",
  "sql2": "Q: \"统计2019.5.8至2025.3.30 分月的玩法主玩情况\n输出：月份(201905、201906、...、202503)、主玩玩法、主玩人数、总参与人数\"\nSchema_links: [dws_jordass_mode_roundrecord_di.dtstatdate,dws_jordass_mode_roundrecord_di.vplayerid,dws_jordass_mode_roundrecord_di.roundtime,dws_jordass_mode_roundrecord_di.roundcnt,dwd_jordass_playerexitgamerecord_hi.tdbank_imp_date,dwd_jordass_playerexitgamerecord_hi.mode]\nA: Let's think step by step. \"统计2019.5.8至2025.3.30 分月的玩法主玩情况\" can be solved by knowing the answer to the following sub-question \"对于每个玩家在每个月，计算他们在每个玩法的累计时长（或对局数）以确定该玩家的主玩玩法（累计时长最多者）\".\nThe SQL query for the sub-question \"对于每个玩家在每个月，计算他们在每个玩法的累计时长（或对局数）\" is:\n\nwith main_user as (\n    select substr(dtstatdate, 1, 6) mons,\n        case\n            when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿'\n            when modename = '传统模式' and mapname = '群屿' then '传统群屿'\n            when modename = '传统模式' and mapname = '假日群岛' then '假日群岛'\n            when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城'\n            when submodename = '广域战场模式' then '广域战场'\n            when submodename = '极能形态模式' then '极能形态'\n            when modename = '组队竞技' then '组竞'\n            when modename = '乐园' then '乐园'\n            when modename = '领地' then '领地'\n            when modename = '广阔天地' then '广阔天地'\n            else '其他模式'\n        end imodename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        sum(roundcnt) roundcnt\n   from dws_jordass_mode_roundrecord_di\n   where dtstatdate between '20190508' and '20250330'\n   group by vplayerid, substr(dtstatdate, 1, 6),\n        case\n            when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿'\n            when modename = '传统模式' and mapname = '群屿' then '传统群屿'\n            when modename = '传统模式' and mapname = '假日群岛' then '假日群岛'\n            when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城'\n            when submodename = '广域战场模式' then '广域战场'\n            when submodename = '极能形态模式' then '极能形态'\n            when modename = '组队竞技' then '组竞'\n            when modename = '乐园' then '乐园'\n            when modename = '领地' then '领地'\n            when modename = '广阔天地' then '广阔天地'\n            else '其他模式'\n        end\n\n   union all\n\n   select substr (tdbank_imp_date, 1, 6) mons,\n        '隧道' as modename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        count(distinct gameid) roundcnt\n   from dwd_jordass_playerexitgamerecord_hi\n   where tdbank_imp_date between '2024061800' and '2025033023'\n     and mode in (3001, 3002, 3003)\n   group by substr (tdbank_imp_date, 1, 6), vplayerid\n)\n\nSo, the answer to the question \"统计2019.5.8至2025.3.30 分月的玩法主玩情况\" is =\nIntermediate_representation: 用 CTE 汇总每月每玩家每玩法的累计时长 / 对局数，按每个月每玩家取 roundtime 最大的玩法为主玩，再统计主玩人数与总参与人数。\nSQL:\n\nwith main_user as (\n    select substr(dtstatdate, 1, 6) mons,\n        case\n            when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿'\n            when modename = '传统模式' and mapname = '群屿' then '传统群屿'\n            when modename = '传统模式' and mapname = '假日群岛' then '假日群岛'\n            when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城'\n            when submodename = '广域战场模式' then '广域战场'\n            when submodename = '极能形态模式' then '极能形态'\n            when modename = '组队竞技' then '组竞'\n            when modename = '乐园' then '乐园'\n            when modename = '领地' then '领地'\n            when modename = '广阔天地' then '广阔天地'\n            else '其他模式'\n        end imodename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        sum(roundcnt) roundcnt\n   from dws_jordass_mode_roundrecord_di\n   where dtstatdate between '20190508' and '20250330'\n   group by vplayerid, substr(dtstatdate, 1, 6),\n        case\n            when modename = '传统模式' and submodename like 'CG%' and mapname = '群屿' then '主题群屿'\n            when modename = '传统模式' and mapname = '群屿' then '传统群屿'\n            when modename = '传统模式' and mapname = '假日群岛' then '假日群岛'\n            when modename = '传统模式' and mapname = '荣耀之城' then '荣耀之城'\n            when submodename = '广域战场模式' then '广域战场'\n            when submodename = '极能形态模式' then '极能形态'\n            when modename = '组队竞技' then '组竞'\n            when modename = '乐园' then '乐园'\n            when modename = '领地' then '领地'\n            when modename = '广阔天地' then '广阔天地'\n            else '其他模式'\n        end\n\n   union all\n\n   select substr (tdbank_imp_date, 1, 6) mons,\n        '隧道' as modename,\n        vplayerid,\n        sum(roundtime) / 60 roundtime,\n        count(distinct gameid) roundcnt\n   from dwd_jordass_playerexitgamerecord_hi\n   where tdbank_imp_date between '2024061800' and '2025033023'\n     and mode in (3001, 3002, 3003)\n   group by substr (tdbank_imp_date, 1, 6), vplayerid\n)\n\nselect a.mons,\n       a.imodename,\n       a.iusernum,\n       b.iusernumall\nfrom (\n    select mons,\n          imodename,\n          count(vplayerid) iusernum\n    from (\n        select mons, vplayerid, imodename\n        from (\n            select mons,\n                vplayerid,\n                imodename,\n                roundtime,\n                row_number() over (partition by mons, vplayerid order by roundtime desc) as rn\n            from main_user\n        )ff1\n        where rn = 1\n    )f1\n   group by mons, imodename\n) a\nleft join (\n    select mons,\n        imodename,\n        count(vplayerid) iusernumall\n   from main_user\n   group by mons, imodename\n) b \non a.imodename = b.imodename and a.mons = b.mons\norder by a.mons, a.imodename\n;\n",
  "sql3": "Q: \"统计2024年12月14日-2024年12月20日参与建筑争夺玩法的玩家人数（去重）有多少，其中多少人是12月13日及以前有参与过建筑争夺的老玩家，有多少是新玩家\n输出: 玩家人数、老玩家人数、新玩家人数\"\nSchema_links: [dws_jordass_matchlog_stat_di.dtstatdate,dws_jordass_matchlog_stat_di.vplayerid,dws_jordass_playermatchrecord_stat_df.dtstatdate,dws_jordass_playermatchrecord_stat_df.vplayerid]\nA: Let's think step by step. \"统计2024年12月14日-2024年12月20日参与建筑争夺玩法的玩家人数...\" can be solved by knowing the answer to the following sub-question \"在 2024-12-14 到 2024-12-20 期间，哪些玩家参与了建筑争夺？\" 以及 \"在 2024-12-13（或更早）有哪些玩家曾参与建筑争夺？\"。\nThe SQL query for the sub-question \"在 2024-12-14 到 2024-12-20 期间，哪些玩家参与了建筑争夺？\" is:\n\nselect vplayerid\nfrom dws_jordass_matchlog_stat_di\nwhere dtstatdate between '20241214' and '20241220'\n  and imode = 1344338933661592832\n  and platid = 255\ngroup by vplayerid\n\n\nThe SQL query for the sub-question \"在 2024-12-13（或更早）有哪些玩家曾参与建筑争夺？\" is:\n\nselect vplayerid\nfrom dws_jordass_playermatchrecord_stat_df\nwhere dtstatdate = '20241213'\n  and imode = 1344338933661592832\n  and platid = 255\ngroup by vplayerid\n\n\nSo, the answer to the question \"统计2024年12月14日-2024年12月20日参与建筑争夺玩法的玩家人数...\" is =\nIntermediate_representation: select distinct players in target window left join players in prior-date window and count total / existing / new.\nSQL:\n\nselect\n    count(distinct a.vplayerid) as total_players,\n    count(distinct case when b.vplayerid is not null then a.vplayerid end) as existing_players,\n    count(distinct case when b.vplayerid is null then a.vplayerid end) as new_players\nfrom (\n    select vplayerid\n    from dws_jordass_matchlog_stat_di\n    where dtstatdate between '20241214' and '20241220'\n    and imode = 1344338933661592832\n    and platid = 255\n    group by vplayerid\n) a\nleft join (\n    select vplayerid\n    from dws_jordass_playermatchrecord_stat_df\n    where dtstatdate = '20241213'\n    and imode = 1344338933661592832\n    and platid = 255\n    group by vplayerid\n) b\non a.vplayerid = b.vplayerid\n;\n"
}