Starting processing sql sql_101...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dws_jordass_mode_roundrecord_di', 'Create Table': 'CREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` varchar(65533) NULL COMMENT "统计日期格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `mode` bigint(20) NULL COMMENT "模式ID",\n  `modename` varchar(65533) NULL COMMENT "模式名称",\n  `submode` bigint(20) NULL COMMENT "子模式ID",\n  `submodename` varchar(65533) NULL COMMENT "子模式名称",\n  `map` bigint(20) NULL COMMENT "地图ID",\n  `mapname` varchar(65533) NULL COMMENT "地图名称",\n  `seasonid` bigint(20) NULL COMMENT "赛季ID",\n  `seasonname` varchar(65533) NULL COMMENT "赛季名称",\n  `roundcnt` bigint(20) NULL COMMENT "当日对局数",\n  `roundtime` bigint(20) NULL COMMENT "当日对局时长(秒)",\n  `survivaltime` bigint(20) NULL COMMENT "当日存活时长(秒)",\n  `firstroundtime` varchar(65533) NULL COMMENT "当日首次对局时间",\n  `device_type` bigint(20) NULL COMMENT "设备类型"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dws_jordass_login_di', 'Create Table': 'CREATE TABLE `dws_jordass_login_di` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\t\'wx\' - 微信\t\'qq\' - 手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:所有平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `ionlinetime` bigint(20) NULL COMMENT "在线时长(秒)",\n  `ilogincount` bigint(20) NULL COMMENT "登录次数",\n  `friendcount` bigint(20) NULL COMMENT "好友数量",\n  `dtlogintime` varchar(65533) NULL COMMENT "当日最早登录时间,格式YYYY-MM-DDHH:MM:SS"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dwd_jordass_playerlogin_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_playerlogin_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "小时分区字段，格式YYYYMMDDHH",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "用户playerid号",\n  `uid` varchar(65533) NULL COMMENT "角色UID",\n  `level` bigint(20) NULL COMMENT "等级",\n  `playerfriendsnum` bigint(20) NULL COMMENT "玩家好友数量",\n  `clientversion` varchar(65533) NULL COMMENT "客户端版本",\n  `screenwidth` bigint(20) NULL COMMENT "显示屏宽度",\n  `screenhight` bigint(20) NULL COMMENT "显示屏高度",\n  `density` varchar(65533) NULL COMMENT "像素密度",\n  `loginchannel` bigint(20) NULL COMMENT "登录渠道",\n  `vroleid` varchar(65533) NULL COMMENT "玩家角色ID",\n  `vrolename` varchar(65533) NULL COMMENT "玩家角色名",\n  `deviceid` varchar(65533) NULL COMMENT "设备ID",\n  `device_type` bigint(20) NULL COMMENT "设备类型0为手机,1为模拟器, 2键鼠, 3手柄, 5是PC客户端,也是高清模拟器。",\n  `gender` bigint(20) NULL COMMENT "平台性别，1是男，2是女",\n  `emulatorname` varchar(65533) NULL COMMENT "模拟器名",\n  `warzoneid` bigint(20) NULL COMMENT "战区ID",\n  `devicename` varchar(65533) NULL COMMENT "客户端devicename",\n  `historymaxsegment` bigint(20) NULL COMMENT "历史最高段位",\n  `seasonmaxsegment` bigint(20) NULL COMMENT "本赛季最高段位",\n  `firstlogincg` bigint(20) NULL COMMENT "第一次登录CG游戏的时间，即CG注册时间，UNIX时间戳",\n  `lobbybgid` bigint(20) NULL COMMENT "当前设置的大厅背景resid",\n  `signature` varchar(65533) NULL COMMENT "个性签名",\n  `devicelevel` bigint(20) NULL COMMENT "机型档位",\n  `iswxrealname` bigint(20) NULL COMMENT "非微信平台或还没拉取数据填0，已微信实名填1，未实名填2",\n  `iswxlowlv` bigint(20) NULL COMMENT "非微信平台或还没拉取数据填0，是微信小号填1，不是微信小号填2",\n  `iszombie` bigint(20) NULL COMMENT "非微信平台或还没拉取数据填0，是微信僵尸号填1，不是微信僵尸号填2",\n  `topsegtimes` bigint(20) NULL COMMENT "王牌印记: -2 首次达到星钻 -1 首次达到王冠  0 无数据 >0 历史王牌次数",\n  `clanid1` bigint(20) NULL COMMENT "战队ID1",\n  `clanid2` bigint(20) NULL COMMENT "战队ID2",\n  `clanid3` bigint(20) NULL COMMENT "战队ID3",\n  `fpslevel` bigint(20) NULL COMMENT "帧率等级",\n  `renderqualityapply` bigint(20) NULL COMMENT "画质等级",\n  `devicetcqualitygrade` bigint(20) NULL COMMENT "机型等级",\n  `relogin` bigint(20) NULL COMMENT "是否是断线重连登录的,1为断线重连，0为从登录界面登录",\n  `gameid` varchar(65533) NULL COMMENT "当前正在游戏的对局id",\n  `startime` bigint(20) NULL COMMENT "当前正在游戏的对局id",\n  `rolesettingstr` varchar(65533) NULL COMMENT "RoleSetting设置, 当为空字符串时表示该字段获取异常,否则为以+分隔的rolesetting值，具体字段值咨询开发",\n  `creditscore` varchar(65533) NULL COMMENT "信誉分",\n  `usenewpickup` bigint(20) NULL COMMENT "是否使用新版拾取",\n  `isqrlogin` bigint(20) NULL COMMENT "是否为扫码登录的,1是扫码登录，0非扫描登录",\n  `is_gamematrix` bigint(20) NULL COMMENT "是否为先锋云游，1是，0不是",\n  `clientsceneversion` varchar(65533) NULL COMMENT "客户端场景版本",\n  `whitetype` bigint(20) NULL COMMENT "进入服务器的凭证类型",\n  `mobiletablettype` bigint(20) NULL COMMENT "平板识别结果：-1结果未出，0是非平板，1已验证是平板，2可能是平板",\n  `behaviorlevel` bigint(20) NULL COMMENT "行为分等级",\n  `clientostype` varchar(65533) NULL COMMENT "客户端系统类型：and ios win hm",\n  `pclogintype` bigint(20) NULL COMMENT "0=默认类型，1=PC新手玩家，2=PC回流玩家",\n  `escapecoincount` varchar(65533) NULL COMMENT "隧道收益(该字段原来搞错了, 之前以为是隧道币数量)",\n  `vsteamlevel` bigint(20) NULL COMMENT "组竞等级",\n  `connectidx` bigint(20) NULL COMMENT "连接序号",\n  `isinds` bigint(20) NULL COMMENT "当前登录是否在ds场景中重连"\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dws_jordass_login_di.dtstatdate, dwd_jordass_playerlogin_hi.seasonmaxsegment, dws_jordass_login_di.vplayerid, dws_jordass_mode_roundrecord_di.vplayerid, dws_jordass_login_di.vplayerid = dwd_jordass_playerlogin_hi.vplayerid, dws_jordass_login_di.vplayerid = dws_jordass_mode_roundrecord_di.vplayerid, 2024.9.2, 2024.9.3, 2025.9.8, 2025.9.9]
Selected goldensql references: [34, 35, 38]
classification_result: {'sub_questions': '哪些用户在指定日期是活跃的？","这些活跃用户的本赛季最高段位是什么？","这些活跃用户中有多少参与了主题群屿玩法？","如何计算参与率？', 'flag': 'NESTED'}
sql: 
select 
    a.dtstatdate,
    case 
        when substr(b.seasonmaxsegment, 1, 1) = '1' then '青铜'
        when substr(b.seasonmaxsegment, 1, 1) = '2' then '白银'
        when substr(b.seasonmaxsegment, 1, 1) = '3' then '黄金'
        when substr(b.seasonmaxsegment, 1, 1) = '4' then '铂金'
        when substr(b.seasonmaxsegment, 1, 1) = '5' then '星钻'
        when substr(b.seasonmaxsegment, 1, 1) = '6' then '王冠'
        when substr(b.seasonmaxsegment, 1, 1) >= '7' then '王牌'
        else '无段位'
    end as season_max_segment,
    count(distinct a.vplayerid) as active_users,
    count(distinct c.vplayerid) as theme_participants,
    count(distinct c.vplayerid) / count(distinct a.vplayerid) as participation_rate
from 
    dws_jordass_login_di a
left join 
    dwd_jordass_playerlogin_hi b on a.vplayerid = b.vplayerid
left join (
    select distinct dtstatdate, vplayerid 
    from dws_jordass_mode_roundrecord_di 
    where modename='传统模式' and submodename like 'CG%'
) c on a.dtstatdate = c.dtstatdate and a.vplayerid = c.vplayerid
where 
    a.dtstatdate in ('20240902', '20240903', '20250908', '20250909')
    and a.platid = 255
group by 
    a.dtstatdate,
    case 
        when substr(b.seasonmaxsegment, 1, 1) = '1' then '青铜'
        when substr(b.seasonmaxsegment, 1, 1) = '2' then '白银'
        when substr(b.seasonmaxsegment, 1, 1) = '3' then '黄金'
        when substr(b.seasonmaxsegment, 1, 1) = '4' then '铂金'
        when substr(b.seasonmaxsegment, 1, 1) = '5' then '星钻'
        when substr(b.seasonmaxsegment, 1, 1) = '6' then '王冠'
        when substr(b.seasonmaxsegment, 1, 1) >= '7' then '王牌'
        else '无段位'
    end
order by 
    a.dtstatdate, 
    case 
        when substr(b.seasonmaxsegment, 1, 1) = '1' then 1
        when substr(b.seasonmaxsegment, 1, 1) = '2' then 2
        when substr(b.seasonmaxsegment, 1, 1) = '3' then 3
        when substr(b.seasonmaxsegment, 1, 1) = '4' then 4
        when substr(b.seasonmaxsegment, 1, 1) = '5' then 5
        when substr(b.seasonmaxsegment, 1, 1) = '6' then 6
        when substr(b.seasonmaxsegment, 1, 1) >= '7' then 7
        else 8
    end;

Traceback (most recent call last):
  File "/home/idg/repos/tgac/code/utils.py", line 204, in execute_sql_with_pymysql
    cursor.execute(sql)
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "'CASE WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '1' THEN 1 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '2' THEN 2 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '3' THEN 3 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '4' THEN 4 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '5' THEN 5 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '6' THEN 6 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) >= '7' THEN 7 ELSE 8 END' must be an aggregate expression or appear in GROUP BY clause")
执行SQL语句时发生错误：(1064, "'CASE WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '1' THEN 1 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '2' THEN 2 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '3' THEN 3 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '4' THEN 4 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '5' THEN 5 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) = '6' THEN 6 WHEN substr(`tgac`.`b`.`seasonmaxsegment`, 1, 1) >= '7' THEN 7 ELSE 8 END' must be an aggregate expression or appear in GROUP BY clause")
None
Finished processing sql sql_101 in 48.43917536735535 seconds
{'sql_id': 'sql_101', 'sql': "\nselect \n    a.dtstatdate,\n    case \n        when substr(b.seasonmaxsegment, 1, 1) = '1' then '青铜'\n        when substr(b.seasonmaxsegment, 1, 1) = '2' then '白银'\n        when substr(b.seasonmaxsegment, 1, 1) = '3' then '黄金'\n        when substr(b.seasonmaxsegment, 1, 1) = '4' then '铂金'\n        when substr(b.seasonmaxsegment, 1, 1) = '5' then '星钻'\n        when substr(b.seasonmaxsegment, 1, 1) = '6' then '王冠'\n        when substr(b.seasonmaxsegment, 1, 1) >= '7' then '王牌'\n        else '无段位'\n    end as season_max_segment,\n    count(distinct a.vplayerid) as active_users,\n    count(distinct c.vplayerid) as theme_participants,\n    count(distinct c.vplayerid) / count(distinct a.vplayerid) as participation_rate\nfrom \n    dws_jordass_login_di a\nleft join \n    dwd_jordass_playerlogin_hi b on a.vplayerid = b.vplayerid\nleft join (\n    select distinct dtstatdate, vplayerid \n    from dws_jordass_mode_roundrecord_di \n    where modename='传统模式' and submodename like 'CG%'\n) c on a.dtstatdate = c.dtstatdate and a.vplayerid = c.vplayerid\nwhere \n    a.dtstatdate in ('20240902', '20240903', '20250908', '20250909')\n    and a.platid = 255\ngroup by \n    a.dtstatdate,\n    case \n        when substr(b.seasonmaxsegment, 1, 1) = '1' then '青铜'\n        when substr(b.seasonmaxsegment, 1, 1) = '2' then '白银'\n        when substr(b.seasonmaxsegment, 1, 1) = '3' then '黄金'\n        when substr(b.seasonmaxsegment, 1, 1) = '4' then '铂金'\n        when substr(b.seasonmaxsegment, 1, 1) = '5' then '星钻'\n        when substr(b.seasonmaxsegment, 1, 1) = '6' then '王冠'\n        when substr(b.seasonmaxsegment, 1, 1) >= '7' then '王牌'\n        else '无段位'\n    end\norder by \n    a.dtstatdate, \n    case \n        when substr(b.seasonmaxsegment, 1, 1) = '1' then 1\n        when substr(b.seasonmaxsegment, 1, 1) = '2' then 2\n        when substr(b.seasonmaxsegment, 1, 1) = '3' then 3\n        when substr(b.seasonmaxsegment, 1, 1) = '4' then 4\n        when substr(b.seasonmaxsegment, 1, 1) = '5' then 5\n        when substr(b.seasonmaxsegment, 1, 1) = '6' then 6\n        when substr(b.seasonmaxsegment, 1, 1) >= '7' then 7\n        else 8\n    end;\n", 'status': 'success', 'result': None}
Starting processing sql sql_103...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dws_jordass_login_df', 'Create Table': 'CREATE TABLE `dws_jordass_login_df` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:不区分平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `cbitmap` varchar(65533) NULL COMMENT "登录位图",\n  `dregdate` varchar(65533) NULL COMMENT "注册日期，格式YYYYMMDD",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `friendcount` bigint(20) NULL COMMENT "好友数量"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dwd_jordass_directpaycommflow_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_directpaycommflow_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "游戏APPID",\n  `platid` bigint(20) NULL COMMENT "ios 0/android 1",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "用户playerid号",\n  `uid` varchar(65533) NULL COMMENT "角色UID，操作人",\n  `orderid` varchar(65533) NULL COMMENT "订单号",\n  `productid` varchar(65533) NULL COMMENT "productid",\n  `goodsnum` bigint(20) NULL COMMENT "商品数量",\n  `money` bigint(20) NULL COMMENT "商品对应消耗货币数量",\n  `op` varchar(65533) NULL COMMENT "操作步骤",\n  `opres` varchar(65533) NULL COMMENT "操作步骤结果",\n  `midasbillno` varchar(65533) NULL COMMENT "midas订单号"\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dwd_jordass_directpaycommflow_hi.dteventtime,dwd_jordass_directpaycommflow_hi.productid,dwd_jordass_directpaycommflow_hi.vplayerid,dwd_jordass_directpaycommflow_hi.money,dwd_jordass_directpaycommflow_hi.goodsnum,dws_jordass_login_df.dregdate,dwd_jordass_directpaycommflow_hi.vplayerid = dws_jordass_login_df.vplayerid,2025-09-01,2025-09-10]
Selected goldensql references: [34, 56, 57]
classification_result: {'sub_questions': '2025.9.1-9.10期间每天的直购购买数据是什么？", "这些购买玩家的注册日期是什么？", "如何计算同一天注册的玩家数量？', 'flag': 'NESTED'}
sql: 
select
    substr(d.dteventtime, 1, 8) as stat_date,
    d.productid,
    count(distinct d.vplayerid) as buyer_count,
    sum(d.money) as total_amount,
    sum(d.goodsnum) as total_quantity,
    count(distinct case when l.dregdate = substr(d.dteventtime, 1, 8) then d.vplayerid end) as same_day_reg_count
from dwd_jordass_directpaycommflow_hi d
left join dws_jordass_login_df l on d.vplayerid = l.vplayerid
where substr(d.dteventtime, 1, 8) between '20250901' and '20250910'
  and d.op = 'take' 
  and d.opres = 'ok'
  and d.productid in ('package_6','package_18','outfit_pack','weapon_pack')
group by substr(d.dteventtime, 1, 8), d.productid
order by stat_date, d.productid;

[]
Finished processing sql sql_103 in 38.00843620300293 seconds
{'sql_id': 'sql_103', 'sql': "\nselect\n    substr(d.dteventtime, 1, 8) as stat_date,\n    d.productid,\n    count(distinct d.vplayerid) as buyer_count,\n    sum(d.money) as total_amount,\n    sum(d.goodsnum) as total_quantity,\n    count(distinct case when l.dregdate = substr(d.dteventtime, 1, 8) then d.vplayerid end) as same_day_reg_count\nfrom dwd_jordass_directpaycommflow_hi d\nleft join dws_jordass_login_df l on d.vplayerid = l.vplayerid\nwhere substr(d.dteventtime, 1, 8) between '20250901' and '20250910'\n  and d.op = 'take' \n  and d.opres = 'ok'\n  and d.productid in ('package_6','package_18','outfit_pack','weapon_pack')\ngroup by substr(d.dteventtime, 1, 8), d.productid\norder by stat_date, d.productid;\n", 'status': 'success', 'result': []}
Starting processing sql sql_105...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dws_jordass_water_di', 'Create Table': 'CREATE TABLE `dws_jordass_water_di` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区，付费日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android,255:所有平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `iamount` bigint(20) NULL COMMENT "代币金额(Q分)",\n  `itimes` bigint(20) NULL COMMENT "流水次数",\n  `imoney` double NULL COMMENT "除100为实际支付人民币金额"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dwd_jordass_currencylog_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_currencylog_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "小时分区字段，格式YYYYMMDDHH",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间,格式YY",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家id",\n  `uid` varchar(65533) NULL COMMENT "玩家UID",\n  `sequence` bigint(20) NULL COMMENT "用于关联一次动作产生多条不同类型的货币流动日志",\n  `level` bigint(20) NULL COMMENT "玩家等级",\n  `allianceforcetermoney` bigint(20) NULL COMMENT "动作后的金钱数",\n  `imoney` bigint(20) NULL COMMENT "动作涉及的金钱数",\n  `reason` bigint(20) NULL COMMENT "货币流动一级原因",\n  `subreason` bigint(20) NULL COMMENT "货币流动二级原因",\n  `addorreduce` bigint(20) NULL COMMENT "增加 0/减少 1",\n  `imoneytype` bigint(20) NULL COMMENT "枚举值(0:金币;1:点券;2:服饰币;4:物资币;6:荣耀勋章;1026:组竞币;1027:幸运币)",\n  `device_type` bigint(20) NULL COMMENT "设备类型0为手机,1为模拟器, 2键鼠, 3手柄, 5是PC客户端,也是高清模拟器。"\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dws_jordass_water_di.dtstatdate,dws_jordass_water_di.imoney,dwd_jordass_currencylog_hi.imoney,dws_jordass_water_di.platid,dwd_jordass_currencylog_hi.platid,20240101,20250601]
Selected goldensql references: [34, 56, 57]
classification_result: {'sub_questions': '20240101-20250601期间每天各平台充值金额是多少？", "20240101-20250601期间每天各平台金币消耗是多少？", "如何按日期关联这两个指标？', 'flag': 'NESTED'}
sql: 
select
    a.dtstatdate,
    a.recharge_amount,
    b.gold_consumed
from (
    -- 每天充值金额
    select
        dtstatdate,
        sum(imoney/100) as recharge_amount
    from dws_jordass_water_di
    where dtstatdate between '20240101' and '20250601'
      and platid = 255
    group by dtstatdate
) a
left join (
    -- 每天金币消耗
    select
        substr(dteventtime, 1, 8) as dtstatdate,
        sum(imoney) as gold_consumed
    from dwd_jordass_currencylog_hi
    where substr(dteventtime, 1, 8) between '20240101' and '20250601'
      and platid = 255
      and imoneytype = 0  -- 金币
      and addorreduce = 1 -- 消耗
    group by substr(dteventtime, 1, 8)
) b on a.dtstatdate = b.dtstatdate
order by a.dtstatdate;

[{'dtstatdate': '20240101', 'recharge_amount': 1229.3, 'gold_consumed': None}, {'dtstatdate': '20240102', 'recharge_amount': 247.3, 'gold_consumed': None}, {'dtstatdate': '20240103', 'recharge_amount': 14.3, 'gold_consumed': None}, {'dtstatdate': '20240104', 'recharge_amount': 297.3, 'gold_consumed': None}, {'dtstatdate': '20240105', 'recharge_amount': 283.3, 'gold_consumed': None}, {'dtstatdate': '20240106', 'recharge_amount': 1352.8, 'gold_consumed': None}, {'dtstatdate': '20240107', 'recharge_amount': 852.8, 'gold_consumed': None}, {'dtstatdate': '20240108', 'recharge_amount': 157.8, 'gold_consumed': None}, {'dtstatdate': '20240109', 'recharge_amount': 1885.8, 'gold_consumed': None}, {'dtstatdate': '20240110', 'recharge_amount': 184.3, 'gold_consumed': None}, {'dtstatdate': '20240111', 'recharge_amount': 176.3, 'gold_consumed': None}, {'dtstatdate': '20240112', 'recharge_amount': 281.8, 'gold_consumed': None}, {'dtstatdate': '20240113', 'recharge_amount': 722.8, 'gold_consumed': None}, {'dtstatdate': '20240114', 'recharge_amount': 45.8, 'gold_consumed': None}, {'dtstatdate': '20240115', 'recharge_amount': 65.8, 'gold_consumed': None}, {'dtstatdate': '20240116', 'recharge_amount': 194.8, 'gold_consumed': None}, {'dtstatdate': '20240117', 'recharge_amount': 1119.8, 'gold_consumed': None}, {'dtstatdate': '20240118', 'recharge_amount': 5118.8, 'gold_consumed': None}, {'dtstatdate': '20240119', 'recharge_amount': 4172.8, 'gold_consumed': None}, {'dtstatdate': '20240120', 'recharge_amount': 686.8, 'gold_consumed': None}, {'dtstatdate': '20240121', 'recharge_amount': 480, 'gold_consumed': None}, {'dtstatdate': '20240122', 'recharge_amount': 342, 'gold_consumed': None}, {'dtstatdate': '20240123', 'recharge_amount': 295, 'gold_consumed': None}, {'dtstatdate': '20240124', 'recharge_amount': 444, 'gold_consumed': None}, {'dtstatdate': '20240125', 'recharge_amount': 316, 'gold_consumed': None}, {'dtstatdate': '20240126', 'recharge_amount': 382, 'gold_consumed': None}, {'dtstatdate': '20240127', 'recharge_amount': 277, 'gold_consumed': None}, {'dtstatdate': '20240128', 'recharge_amount': 231, 'gold_consumed': None}, {'dtstatdate': '20240129', 'recharge_amount': 93, 'gold_consumed': None}, {'dtstatdate': '20240130', 'recharge_amount': 223, 'gold_consumed': None}, {'dtstatdate': '20240131', 'recharge_amount': 284, 'gold_consumed': None}, {'dtstatdate': '20240201', 'recharge_amount': 129, 'gold_consumed': None}, {'dtstatdate': '20240202', 'recharge_amount': 1518, 'gold_consumed': None}, {'dtstatdate': '20240203', 'recharge_amount': 161, 'gold_consumed': None}, {'dtstatdate': '20240204', 'recharge_amount': 145, 'gold_consumed': None}, {'dtstatdate': '20240205', 'recharge_amount': 128, 'gold_consumed': None}, {'dtstatdate': '20240206', 'recharge_amount': 237, 'gold_consumed': None}, {'dtstatdate': '20240207', 'recharge_amount': 637, 'gold_consumed': None}, {'dtstatdate': '20240208', 'recharge_amount': 452, 'gold_consumed': None}, {'dtstatdate': '20240209', 'recharge_amount': 5086, 'gold_consumed': None}, {'dtstatdate': '20240210', 'recharge_amount': 2156, 'gold_consumed': None}, {'dtstatdate': '20240211', 'recharge_amount': 6692, 'gold_consumed': None}, {'dtstatdate': '20240212', 'recharge_amount': 1137, 'gold_consumed': None}, {'dtstatdate': '20240213', 'recharge_amount': 1861, 'gold_consumed': None}, {'dtstatdate': '20240214', 'recharge_amount': 630, 'gold_consumed': None}, {'dtstatdate': '20240215', 'recharge_amount': 1828, 'gold_consumed': None}, {'dtstatdate': '20240216', 'recharge_amount': 2351, 'gold_consumed': None}, {'dtstatdate': '20240217', 'recharge_amount': 895, 'gold_consumed': None}, {'dtstatdate': '20240218', 'recharge_amount': 400, 'gold_consumed': None}, {'dtstatdate': '20240219', 'recharge_amount': 1494, 'gold_consumed': None}, {'dtstatdate': '20240220', 'recharge_amount': 296, 'gold_consumed': None}, {'dtstatdate': '20240221', 'recharge_amount': 1544, 'gold_consumed': None}, {'dtstatdate': '20240222', 'recharge_amount': 3283, 'gold_consumed': None}, {'dtstatdate': '20240223', 'recharge_amount': 2171, 'gold_consumed': None}, {'dtstatdate': '20240224', 'recharge_amount': 660, 'gold_consumed': None}, {'dtstatdate': '20240225', 'recharge_amount': 534, 'gold_consumed': None}, {'dtstatdate': '20240226', 'recharge_amount': 963, 'gold_consumed': None}, {'dtstatdate': '20240227', 'recharge_amount': 674, 'gold_consumed': None}, {'dtstatdate': '20240228', 'recharge_amount': 767, 'gold_consumed': None}, {'dtstatdate': '20240229', 'recharge_amount': 366, 'gold_consumed': None}, {'dtstatdate': '20240301', 'recharge_amount': 2257.5, 'gold_consumed': None}, {'dtstatdate': '20240302', 'recharge_amount': 2243, 'gold_consumed': None}, {'dtstatdate': '20240303', 'recharge_amount': 1392, 'gold_consumed': None}, {'dtstatdate': '20240304', 'recharge_amount': 513, 'gold_consumed': None}, {'dtstatdate': '20240305', 'recharge_amount': 2165, 'gold_consumed': None}, {'dtstatdate': '20240306', 'recharge_amount': 619, 'gold_consumed': None}, {'dtstatdate': '20240307', 'recharge_amount': 1516, 'gold_consumed': None}, {'dtstatdate': '20240308', 'recharge_amount': 1546, 'gold_consumed': None}, {'dtstatdate': '20240309', 'recharge_amount': 767.8, 'gold_consumed': None}, {'dtstatdate': '20240310', 'recharge_amount': 2507, 'gold_consumed': None}, {'dtstatdate': '20240311', 'recharge_amount': 643.8, 'gold_consumed': None}, {'dtstatdate': '20240312', 'recharge_amount': 541, 'gold_consumed': None}, {'dtstatdate': '20240313', 'recharge_amount': 796, 'gold_consumed': None}, {'dtstatdate': '20240314', 'recharge_amount': 432, 'gold_consumed': None}, {'dtstatdate': '20240315', 'recharge_amount': 446, 'gold_consumed': None}, {'dtstatdate': '20240316', 'recharge_amount': 4486, 'gold_consumed': None}, {'dtstatdate': '20240317', 'recharge_amount': 1055, 'gold_consumed': None}, {'dtstatdate': '20240318', 'recharge_amount': 1469, 'gold_consumed': None}, {'dtstatdate': '20240319', 'recharge_amount': 202, 'gold_consumed': None}, {'dtstatdate': '20240320', 'recharge_amount': 310, 'gold_consumed': None}, {'dtstatdate': '20240321', 'recharge_amount': 811, 'gold_consumed': None}, {'dtstatdate': '20240322', 'recharge_amount': 1790, 'gold_consumed': None}, {'dtstatdate': '20240323', 'recharge_amount': 2097, 'gold_consumed': None}, {'dtstatdate': '20240324', 'recharge_amount': 915, 'gold_consumed': None}, {'dtstatdate': '20240325', 'recharge_amount': 510, 'gold_consumed': None}, {'dtstatdate': '20240326', 'recharge_amount': 3072, 'gold_consumed': None}, {'dtstatdate': '20240327', 'recharge_amount': 1741, 'gold_consumed': None}, {'dtstatdate': '20240328', 'recharge_amount': 135, 'gold_consumed': None}, {'dtstatdate': '20240329', 'recharge_amount': 4976, 'gold_consumed': None}, {'dtstatdate': '20240330', 'recharge_amount': 2265, 'gold_consumed': None}, {'dtstatdate': '20240331', 'recharge_amount': 1716, 'gold_consumed': None}, {'dtstatdate': '20240401', 'recharge_amount': 283.5, 'gold_consumed': None}, {'dtstatdate': '20240402', 'recharge_amount': 569, 'gold_consumed': None}, {'dtstatdate': '20240403', 'recharge_amount': 2894, 'gold_consumed': None}, {'dtstatdate': '20240404', 'recharge_amount': 536, 'gold_consumed': None}, {'dtstatdate': '20240405', 'recharge_amount': 1003, 'gold_consumed': None}, {'dtstatdate': '20240406', 'recharge_amount': 612, 'gold_consumed': None}, {'dtstatdate': '20240407', 'recharge_amount': 282, 'gold_consumed': None}, {'dtstatdate': '20240408', 'recharge_amount': 279, 'gold_consumed': None}, {'dtstatdate': '20240409', 'recharge_amount': 296, 'gold_consumed': None}, {'dtstatdate': '20240410', 'recharge_amount': 1010, 'gold_consumed': None}, {'dtstatdate': '20240411', 'recharge_amount': 640, 'gold_consumed': None}, {'dtstatdate': '20240412', 'recharge_amount': 353, 'gold_consumed': None}, {'dtstatdate': '20240413', 'recharge_amount': 119, 'gold_consumed': None}, {'dtstatdate': '20240414', 'recharge_amount': 376, 'gold_consumed': None}, {'dtstatdate': '20240415', 'recharge_amount': 2675.5, 'gold_consumed': None}, {'dtstatdate': '20240416', 'recharge_amount': 2147, 'gold_consumed': None}, {'dtstatdate': '20240417', 'recharge_amount': 473, 'gold_consumed': None}, {'dtstatdate': '20240418', 'recharge_amount': 612, 'gold_consumed': None}, {'dtstatdate': '20240419', 'recharge_amount': 409, 'gold_consumed': None}, {'dtstatdate': '20240420', 'recharge_amount': 618, 'gold_consumed': None}, {'dtstatdate': '20240422', 'recharge_amount': 373, 'gold_consumed': None}, {'dtstatdate': '20240424', 'recharge_amount': 247, 'gold_consumed': None}, {'dtstatdate': '20240425', 'recharge_amount': 393, 'gold_consumed': None}, {'dtstatdate': '20240426', 'recharge_amount': 3190, 'gold_consumed': None}, {'dtstatdate': '20240427', 'recharge_amount': 949, 'gold_consumed': None}, {'dtstatdate': '20240428', 'recharge_amount': 424, 'gold_consumed': None}, {'dtstatdate': '20240429', 'recharge_amount': 374, 'gold_consumed': None}, {'dtstatdate': '20240430', 'recharge_amount': 2816, 'gold_consumed': None}, {'dtstatdate': '20240501', 'recharge_amount': 1700, 'gold_consumed': None}, {'dtstatdate': '20240502', 'recharge_amount': 1299, 'gold_consumed': None}, {'dtstatdate': '20240503', 'recharge_amount': 2323, 'gold_consumed': None}, {'dtstatdate': '20240504', 'recharge_amount': 429, 'gold_consumed': None}, {'dtstatdate': '20240505', 'recharge_amount': 361, 'gold_consumed': None}, {'dtstatdate': '20240506', 'recharge_amount': 1467, 'gold_consumed': None}, {'dtstatdate': '20240507', 'recharge_amount': 290, 'gold_consumed': None}, {'dtstatdate': '20240508', 'recharge_amount': 871, 'gold_consumed': None}, {'dtstatdate': '20240509', 'recharge_amount': 1490, 'gold_consumed': None}, {'dtstatdate': '20240510', 'recharge_amount': 488, 'gold_consumed': None}, {'dtstatdate': '20240511', 'recharge_amount': 715, 'gold_consumed': None}, {'dtstatdate': '20240512', 'recharge_amount': 421, 'gold_consumed': None}, {'dtstatdate': '20240513', 'recharge_amount': 586, 'gold_consumed': None}, {'dtstatdate': '20240514', 'recharge_amount': 960, 'gold_consumed': None}, {'dtstatdate': '20240515', 'recharge_amount': 50, 'gold_consumed': None}, {'dtstatdate': '20240516', 'recharge_amount': 3168, 'gold_consumed': None}, {'dtstatdate': '20240517', 'recharge_amount': 1578, 'gold_consumed': None}, {'dtstatdate': '20240518', 'recharge_amount': 1289, 'gold_consumed': None}, {'dtstatdate': '20240519', 'recharge_amount': 888, 'gold_consumed': None}, {'dtstatdate': '20240520', 'recharge_amount': 658, 'gold_consumed': None}, {'dtstatdate': '20240521', 'recharge_amount': 730, 'gold_consumed': None}, {'dtstatdate': '20240522', 'recharge_amount': 1313, 'gold_consumed': None}, {'dtstatdate': '20240523', 'recharge_amount': 314, 'gold_consumed': None}, {'dtstatdate': '20240524', 'recharge_amount': 677, 'gold_consumed': None}, {'dtstatdate': '20240525', 'recharge_amount': 375, 'gold_consumed': None}, {'dtstatdate': '20240526', 'recharge_amount': 278, 'gold_consumed': None}, {'dtstatdate': '20240527', 'recharge_amount': 148, 'gold_consumed': None}, {'dtstatdate': '20240528', 'recharge_amount': 830, 'gold_consumed': None}, {'dtstatdate': '20240529', 'recharge_amount': 1164, 'gold_consumed': None}, {'dtstatdate': '20240530', 'recharge_amount': 208.5, 'gold_consumed': None}, {'dtstatdate': '20240531', 'recharge_amount': 312.5, 'gold_consumed': None}, {'dtstatdate': '20240601', 'recharge_amount': 1092.5, 'gold_consumed': None}, {'dtstatdate': '20240602', 'recharge_amount': 225, 'gold_consumed': None}, {'dtstatdate': '20240603', 'recharge_amount': 1247, 'gold_consumed': None}, {'dtstatdate': '20240604', 'recharge_amount': 880, 'gold_consumed': None}, {'dtstatdate': '20240605', 'recharge_amount': 386, 'gold_consumed': None}, {'dtstatdate': '20240606', 'recharge_amount': 1276, 'gold_consumed': None}, {'dtstatdate': '20240607', 'recharge_amount': 3737, 'gold_consumed': None}, {'dtstatdate': '20240608', 'recharge_amount': 868, 'gold_consumed': None}, {'dtstatdate': '20240609', 'recharge_amount': 498, 'gold_consumed': None}, {'dtstatdate': '20240611', 'recharge_amount': 531, 'gold_consumed': None}, {'dtstatdate': '20240612', 'recharge_amount': 138, 'gold_consumed': None}, {'dtstatdate': '20240613', 'recharge_amount': 2238, 'gold_consumed': None}, {'dtstatdate': '20240614', 'recharge_amount': 499, 'gold_consumed': None}, {'dtstatdate': '20240615', 'recharge_amount': 2490, 'gold_consumed': None}, {'dtstatdate': '20240616', 'recharge_amount': 1143, 'gold_consumed': None}, {'dtstatdate': '20240617', 'recharge_amount': 620, 'gold_consumed': None}, {'dtstatdate': '20240618', 'recharge_amount': 479, 'gold_consumed': None}, {'dtstatdate': '20240619', 'recharge_amount': 672, 'gold_consumed': None}, {'dtstatdate': '20240620', 'recharge_amount': 1185, 'gold_consumed': None}, {'dtstatdate': '20240621', 'recharge_amount': 2621, 'gold_consumed': None}, {'dtstatdate': '20240622', 'recharge_amount': 782, 'gold_consumed': None}, {'dtstatdate': '20240623', 'recharge_amount': 2060, 'gold_consumed': None}, {'dtstatdate': '20240626', 'recharge_amount': 1907, 'gold_consumed': None}, {'dtstatdate': '20240627', 'recharge_amount': 493, 'gold_consumed': None}, {'dtstatdate': '20240628', 'recharge_amount': 486, 'gold_consumed': None}, {'dtstatdate': '20240629', 'recharge_amount': 1350, 'gold_consumed': None}, {'dtstatdate': '20240630', 'recharge_amount': 1173, 'gold_consumed': None}, {'dtstatdate': '20240701', 'recharge_amount': 4574, 'gold_consumed': None}, {'dtstatdate': '20240702', 'recharge_amount': 524, 'gold_consumed': None}, {'dtstatdate': '20240703', 'recharge_amount': 124, 'gold_consumed': None}, {'dtstatdate': '20240704', 'recharge_amount': 232, 'gold_consumed': None}, {'dtstatdate': '20240705', 'recharge_amount': 628, 'gold_consumed': None}, {'dtstatdate': '20240708', 'recharge_amount': 462, 'gold_consumed': None}, {'dtstatdate': '20240709', 'recharge_amount': 316, 'gold_consumed': None}, {'dtstatdate': '20240710', 'recharge_amount': 123, 'gold_consumed': None}, {'dtstatdate': '20240711', 'recharge_amount': 2281, 'gold_consumed': None}, {'dtstatdate': '20240712', 'recharge_amount': 2236, 'gold_consumed': None}, {'dtstatdate': '20240713', 'recharge_amount': 789, 'gold_consumed': None}, {'dtstatdate': '20240714', 'recharge_amount': 132, 'gold_consumed': None}, {'dtstatdate': '20240715', 'recharge_amount': 12376, 'gold_consumed': None}, {'dtstatdate': '20240716', 'recharge_amount': 499, 'gold_consumed': None}, {'dtstatdate': '20240717', 'recharge_amount': 79, 'gold_consumed': None}, {'dtstatdate': '20240718', 'recharge_amount': 53, 'gold_consumed': None}, {'dtstatdate': '20240719', 'recharge_amount': 3623.7, 'gold_consumed': None}, {'dtstatdate': '20240720', 'recharge_amount': 2288, 'gold_consumed': None}, {'dtstatdate': '20240721', 'recharge_amount': 480, 'gold_consumed': None}, {'dtstatdate': '20240722', 'recharge_amount': 12517, 'gold_consumed': None}, {'dtstatdate': '20240723', 'recharge_amount': 1433, 'gold_consumed': None}, {'dtstatdate': '20240725', 'recharge_amount': 841, 'gold_consumed': None}, {'dtstatdate': '20240726', 'recharge_amount': 1788, 'gold_consumed': None}, {'dtstatdate': '20240728', 'recharge_amount': 1002, 'gold_consumed': None}, {'dtstatdate': '20240731', 'recharge_amount': 1, 'gold_consumed': None}, {'dtstatdate': '20240801', 'recharge_amount': 50000, 'gold_consumed': None}, {'dtstatdate': '20240815', 'recharge_amount': 200000, 'gold_consumed': None}, {'dtstatdate': '20240901', 'recharge_amount': 800000, 'gold_consumed': None}, {'dtstatdate': '20240915', 'recharge_amount': 3500000, 'gold_consumed': None}, {'dtstatdate': '20241001', 'recharge_amount': 12000000, 'gold_consumed': None}, {'dtstatdate': '20241015', 'recharge_amount': 50000000, 'gold_consumed': None}, {'dtstatdate': '20241101', 'recharge_amount': 200000000, 'gold_consumed': None}, {'dtstatdate': '20241115', 'recharge_amount': 800000000, 'gold_consumed': None}, {'dtstatdate': '20241201', 'recharge_amount': 3500001200, 'gold_consumed': None}, {'dtstatdate': '20241205', 'recharge_amount': 0.6, 'gold_consumed': None}, {'dtstatdate': '20241210', 'recharge_amount': 0.8, 'gold_consumed': None}, {'dtstatdate': '20241215', 'recharge_amount': 12000000001, 'gold_consumed': None}, {'dtstatdate': '20241220', 'recharge_amount': 0.3, 'gold_consumed': None}, {'dtstatdate': '20241225', 'recharge_amount': 0.4, 'gold_consumed': None}, {'dtstatdate': '20241230', 'recharge_amount': 0.5, 'gold_consumed': None}, {'dtstatdate': '20241231', 'recharge_amount': 50000000000, 'gold_consumed': None}, {'dtstatdate': '20250115', 'recharge_amount': 6000, 'gold_consumed': None}, {'dtstatdate': '20250220', 'recharge_amount': 10000, 'gold_consumed': None}, {'dtstatdate': '20250225', 'recharge_amount': 20000, 'gold_consumed': None}]
Finished processing sql sql_105 in 33.38997745513916 seconds
{'sql_id': 'sql_105', 'sql': "\nselect\n    a.dtstatdate,\n    a.recharge_amount,\n    b.gold_consumed\nfrom (\n    -- 每天充值金额\n    select\n        dtstatdate,\n        sum(imoney/100) as recharge_amount\n    from dws_jordass_water_di\n    where dtstatdate between '20240101' and '20250601'\n      and platid = 255\n    group by dtstatdate\n) a\nleft join (\n    -- 每天金币消耗\n    select\n        substr(dteventtime, 1, 8) as dtstatdate,\n        sum(imoney) as gold_consumed\n    from dwd_jordass_currencylog_hi\n    where substr(dteventtime, 1, 8) between '20240101' and '20250601'\n      and platid = 255\n      and imoneytype = 0  -- 金币\n      and addorreduce = 1 -- 消耗\n    group by substr(dteventtime, 1, 8)\n) b on a.dtstatdate = b.dtstatdate\norder by a.dtstatdate;\n", 'status': 'success', 'result': [{'dtstatdate': '20240101', 'recharge_amount': 1229.3, 'gold_consumed': None}, {'dtstatdate': '20240102', 'recharge_amount': 247.3, 'gold_consumed': None}, {'dtstatdate': '20240103', 'recharge_amount': 14.3, 'gold_consumed': None}, {'dtstatdate': '20240104', 'recharge_amount': 297.3, 'gold_consumed': None}, {'dtstatdate': '20240105', 'recharge_amount': 283.3, 'gold_consumed': None}, {'dtstatdate': '20240106', 'recharge_amount': 1352.8, 'gold_consumed': None}, {'dtstatdate': '20240107', 'recharge_amount': 852.8, 'gold_consumed': None}, {'dtstatdate': '20240108', 'recharge_amount': 157.8, 'gold_consumed': None}, {'dtstatdate': '20240109', 'recharge_amount': 1885.8, 'gold_consumed': None}, {'dtstatdate': '20240110', 'recharge_amount': 184.3, 'gold_consumed': None}, {'dtstatdate': '20240111', 'recharge_amount': 176.3, 'gold_consumed': None}, {'dtstatdate': '20240112', 'recharge_amount': 281.8, 'gold_consumed': None}, {'dtstatdate': '20240113', 'recharge_amount': 722.8, 'gold_consumed': None}, {'dtstatdate': '20240114', 'recharge_amount': 45.8, 'gold_consumed': None}, {'dtstatdate': '20240115', 'recharge_amount': 65.8, 'gold_consumed': None}, {'dtstatdate': '20240116', 'recharge_amount': 194.8, 'gold_consumed': None}, {'dtstatdate': '20240117', 'recharge_amount': 1119.8, 'gold_consumed': None}, {'dtstatdate': '20240118', 'recharge_amount': 5118.8, 'gold_consumed': None}, {'dtstatdate': '20240119', 'recharge_amount': 4172.8, 'gold_consumed': None}, {'dtstatdate': '20240120', 'recharge_amount': 686.8, 'gold_consumed': None}, {'dtstatdate': '20240121', 'recharge_amount': 480, 'gold_consumed': None}, {'dtstatdate': '20240122', 'recharge_amount': 342, 'gold_consumed': None}, {'dtstatdate': '20240123', 'recharge_amount': 295, 'gold_consumed': None}, {'dtstatdate': '20240124', 'recharge_amount': 444, 'gold_consumed': None}, {'dtstatdate': '20240125', 'recharge_amount': 316, 'gold_consumed': None}, {'dtstatdate': '20240126', 'recharge_amount': 382, 'gold_consumed': None}, {'dtstatdate': '20240127', 'recharge_amount': 277, 'gold_consumed': None}, {'dtstatdate': '20240128', 'recharge_amount': 231, 'gold_consumed': None}, {'dtstatdate': '20240129', 'recharge_amount': 93, 'gold_consumed': None}, {'dtstatdate': '20240130', 'recharge_amount': 223, 'gold_consumed': None}, {'dtstatdate': '20240131', 'recharge_amount': 284, 'gold_consumed': None}, {'dtstatdate': '20240201', 'recharge_amount': 129, 'gold_consumed': None}, {'dtstatdate': '20240202', 'recharge_amount': 1518, 'gold_consumed': None}, {'dtstatdate': '20240203', 'recharge_amount': 161, 'gold_consumed': None}, {'dtstatdate': '20240204', 'recharge_amount': 145, 'gold_consumed': None}, {'dtstatdate': '20240205', 'recharge_amount': 128, 'gold_consumed': None}, {'dtstatdate': '20240206', 'recharge_amount': 237, 'gold_consumed': None}, {'dtstatdate': '20240207', 'recharge_amount': 637, 'gold_consumed': None}, {'dtstatdate': '20240208', 'recharge_amount': 452, 'gold_consumed': None}, {'dtstatdate': '20240209', 'recharge_amount': 5086, 'gold_consumed': None}, {'dtstatdate': '20240210', 'recharge_amount': 2156, 'gold_consumed': None}, {'dtstatdate': '20240211', 'recharge_amount': 6692, 'gold_consumed': None}, {'dtstatdate': '20240212', 'recharge_amount': 1137, 'gold_consumed': None}, {'dtstatdate': '20240213', 'recharge_amount': 1861, 'gold_consumed': None}, {'dtstatdate': '20240214', 'recharge_amount': 630, 'gold_consumed': None}, {'dtstatdate': '20240215', 'recharge_amount': 1828, 'gold_consumed': None}, {'dtstatdate': '20240216', 'recharge_amount': 2351, 'gold_consumed': None}, {'dtstatdate': '20240217', 'recharge_amount': 895, 'gold_consumed': None}, {'dtstatdate': '20240218', 'recharge_amount': 400, 'gold_consumed': None}, {'dtstatdate': '20240219', 'recharge_amount': 1494, 'gold_consumed': None}, {'dtstatdate': '20240220', 'recharge_amount': 296, 'gold_consumed': None}, {'dtstatdate': '20240221', 'recharge_amount': 1544, 'gold_consumed': None}, {'dtstatdate': '20240222', 'recharge_amount': 3283, 'gold_consumed': None}, {'dtstatdate': '20240223', 'recharge_amount': 2171, 'gold_consumed': None}, {'dtstatdate': '20240224', 'recharge_amount': 660, 'gold_consumed': None}, {'dtstatdate': '20240225', 'recharge_amount': 534, 'gold_consumed': None}, {'dtstatdate': '20240226', 'recharge_amount': 963, 'gold_consumed': None}, {'dtstatdate': '20240227', 'recharge_amount': 674, 'gold_consumed': None}, {'dtstatdate': '20240228', 'recharge_amount': 767, 'gold_consumed': None}, {'dtstatdate': '20240229', 'recharge_amount': 366, 'gold_consumed': None}, {'dtstatdate': '20240301', 'recharge_amount': 2257.5, 'gold_consumed': None}, {'dtstatdate': '20240302', 'recharge_amount': 2243, 'gold_consumed': None}, {'dtstatdate': '20240303', 'recharge_amount': 1392, 'gold_consumed': None}, {'dtstatdate': '20240304', 'recharge_amount': 513, 'gold_consumed': None}, {'dtstatdate': '20240305', 'recharge_amount': 2165, 'gold_consumed': None}, {'dtstatdate': '20240306', 'recharge_amount': 619, 'gold_consumed': None}, {'dtstatdate': '20240307', 'recharge_amount': 1516, 'gold_consumed': None}, {'dtstatdate': '20240308', 'recharge_amount': 1546, 'gold_consumed': None}, {'dtstatdate': '20240309', 'recharge_amount': 767.8, 'gold_consumed': None}, {'dtstatdate': '20240310', 'recharge_amount': 2507, 'gold_consumed': None}, {'dtstatdate': '20240311', 'recharge_amount': 643.8, 'gold_consumed': None}, {'dtstatdate': '20240312', 'recharge_amount': 541, 'gold_consumed': None}, {'dtstatdate': '20240313', 'recharge_amount': 796, 'gold_consumed': None}, {'dtstatdate': '20240314', 'recharge_amount': 432, 'gold_consumed': None}, {'dtstatdate': '20240315', 'recharge_amount': 446, 'gold_consumed': None}, {'dtstatdate': '20240316', 'recharge_amount': 4486, 'gold_consumed': None}, {'dtstatdate': '20240317', 'recharge_amount': 1055, 'gold_consumed': None}, {'dtstatdate': '20240318', 'recharge_amount': 1469, 'gold_consumed': None}, {'dtstatdate': '20240319', 'recharge_amount': 202, 'gold_consumed': None}, {'dtstatdate': '20240320', 'recharge_amount': 310, 'gold_consumed': None}, {'dtstatdate': '20240321', 'recharge_amount': 811, 'gold_consumed': None}, {'dtstatdate': '20240322', 'recharge_amount': 1790, 'gold_consumed': None}, {'dtstatdate': '20240323', 'recharge_amount': 2097, 'gold_consumed': None}, {'dtstatdate': '20240324', 'recharge_amount': 915, 'gold_consumed': None}, {'dtstatdate': '20240325', 'recharge_amount': 510, 'gold_consumed': None}, {'dtstatdate': '20240326', 'recharge_amount': 3072, 'gold_consumed': None}, {'dtstatdate': '20240327', 'recharge_amount': 1741, 'gold_consumed': None}, {'dtstatdate': '20240328', 'recharge_amount': 135, 'gold_consumed': None}, {'dtstatdate': '20240329', 'recharge_amount': 4976, 'gold_consumed': None}, {'dtstatdate': '20240330', 'recharge_amount': 2265, 'gold_consumed': None}, {'dtstatdate': '20240331', 'recharge_amount': 1716, 'gold_consumed': None}, {'dtstatdate': '20240401', 'recharge_amount': 283.5, 'gold_consumed': None}, {'dtstatdate': '20240402', 'recharge_amount': 569, 'gold_consumed': None}, {'dtstatdate': '20240403', 'recharge_amount': 2894, 'gold_consumed': None}, {'dtstatdate': '20240404', 'recharge_amount': 536, 'gold_consumed': None}, {'dtstatdate': '20240405', 'recharge_amount': 1003, 'gold_consumed': None}, {'dtstatdate': '20240406', 'recharge_amount': 612, 'gold_consumed': None}, {'dtstatdate': '20240407', 'recharge_amount': 282, 'gold_consumed': None}, {'dtstatdate': '20240408', 'recharge_amount': 279, 'gold_consumed': None}, {'dtstatdate': '20240409', 'recharge_amount': 296, 'gold_consumed': None}, {'dtstatdate': '20240410', 'recharge_amount': 1010, 'gold_consumed': None}, {'dtstatdate': '20240411', 'recharge_amount': 640, 'gold_consumed': None}, {'dtstatdate': '20240412', 'recharge_amount': 353, 'gold_consumed': None}, {'dtstatdate': '20240413', 'recharge_amount': 119, 'gold_consumed': None}, {'dtstatdate': '20240414', 'recharge_amount': 376, 'gold_consumed': None}, {'dtstatdate': '20240415', 'recharge_amount': 2675.5, 'gold_consumed': None}, {'dtstatdate': '20240416', 'recharge_amount': 2147, 'gold_consumed': None}, {'dtstatdate': '20240417', 'recharge_amount': 473, 'gold_consumed': None}, {'dtstatdate': '20240418', 'recharge_amount': 612, 'gold_consumed': None}, {'dtstatdate': '20240419', 'recharge_amount': 409, 'gold_consumed': None}, {'dtstatdate': '20240420', 'recharge_amount': 618, 'gold_consumed': None}, {'dtstatdate': '20240422', 'recharge_amount': 373, 'gold_consumed': None}, {'dtstatdate': '20240424', 'recharge_amount': 247, 'gold_consumed': None}, {'dtstatdate': '20240425', 'recharge_amount': 393, 'gold_consumed': None}, {'dtstatdate': '20240426', 'recharge_amount': 3190, 'gold_consumed': None}, {'dtstatdate': '20240427', 'recharge_amount': 949, 'gold_consumed': None}, {'dtstatdate': '20240428', 'recharge_amount': 424, 'gold_consumed': None}, {'dtstatdate': '20240429', 'recharge_amount': 374, 'gold_consumed': None}, {'dtstatdate': '20240430', 'recharge_amount': 2816, 'gold_consumed': None}, {'dtstatdate': '20240501', 'recharge_amount': 1700, 'gold_consumed': None}, {'dtstatdate': '20240502', 'recharge_amount': 1299, 'gold_consumed': None}, {'dtstatdate': '20240503', 'recharge_amount': 2323, 'gold_consumed': None}, {'dtstatdate': '20240504', 'recharge_amount': 429, 'gold_consumed': None}, {'dtstatdate': '20240505', 'recharge_amount': 361, 'gold_consumed': None}, {'dtstatdate': '20240506', 'recharge_amount': 1467, 'gold_consumed': None}, {'dtstatdate': '20240507', 'recharge_amount': 290, 'gold_consumed': None}, {'dtstatdate': '20240508', 'recharge_amount': 871, 'gold_consumed': None}, {'dtstatdate': '20240509', 'recharge_amount': 1490, 'gold_consumed': None}, {'dtstatdate': '20240510', 'recharge_amount': 488, 'gold_consumed': None}, {'dtstatdate': '20240511', 'recharge_amount': 715, 'gold_consumed': None}, {'dtstatdate': '20240512', 'recharge_amount': 421, 'gold_consumed': None}, {'dtstatdate': '20240513', 'recharge_amount': 586, 'gold_consumed': None}, {'dtstatdate': '20240514', 'recharge_amount': 960, 'gold_consumed': None}, {'dtstatdate': '20240515', 'recharge_amount': 50, 'gold_consumed': None}, {'dtstatdate': '20240516', 'recharge_amount': 3168, 'gold_consumed': None}, {'dtstatdate': '20240517', 'recharge_amount': 1578, 'gold_consumed': None}, {'dtstatdate': '20240518', 'recharge_amount': 1289, 'gold_consumed': None}, {'dtstatdate': '20240519', 'recharge_amount': 888, 'gold_consumed': None}, {'dtstatdate': '20240520', 'recharge_amount': 658, 'gold_consumed': None}, {'dtstatdate': '20240521', 'recharge_amount': 730, 'gold_consumed': None}, {'dtstatdate': '20240522', 'recharge_amount': 1313, 'gold_consumed': None}, {'dtstatdate': '20240523', 'recharge_amount': 314, 'gold_consumed': None}, {'dtstatdate': '20240524', 'recharge_amount': 677, 'gold_consumed': None}, {'dtstatdate': '20240525', 'recharge_amount': 375, 'gold_consumed': None}, {'dtstatdate': '20240526', 'recharge_amount': 278, 'gold_consumed': None}, {'dtstatdate': '20240527', 'recharge_amount': 148, 'gold_consumed': None}, {'dtstatdate': '20240528', 'recharge_amount': 830, 'gold_consumed': None}, {'dtstatdate': '20240529', 'recharge_amount': 1164, 'gold_consumed': None}, {'dtstatdate': '20240530', 'recharge_amount': 208.5, 'gold_consumed': None}, {'dtstatdate': '20240531', 'recharge_amount': 312.5, 'gold_consumed': None}, {'dtstatdate': '20240601', 'recharge_amount': 1092.5, 'gold_consumed': None}, {'dtstatdate': '20240602', 'recharge_amount': 225, 'gold_consumed': None}, {'dtstatdate': '20240603', 'recharge_amount': 1247, 'gold_consumed': None}, {'dtstatdate': '20240604', 'recharge_amount': 880, 'gold_consumed': None}, {'dtstatdate': '20240605', 'recharge_amount': 386, 'gold_consumed': None}, {'dtstatdate': '20240606', 'recharge_amount': 1276, 'gold_consumed': None}, {'dtstatdate': '20240607', 'recharge_amount': 3737, 'gold_consumed': None}, {'dtstatdate': '20240608', 'recharge_amount': 868, 'gold_consumed': None}, {'dtstatdate': '20240609', 'recharge_amount': 498, 'gold_consumed': None}, {'dtstatdate': '20240611', 'recharge_amount': 531, 'gold_consumed': None}, {'dtstatdate': '20240612', 'recharge_amount': 138, 'gold_consumed': None}, {'dtstatdate': '20240613', 'recharge_amount': 2238, 'gold_consumed': None}, {'dtstatdate': '20240614', 'recharge_amount': 499, 'gold_consumed': None}, {'dtstatdate': '20240615', 'recharge_amount': 2490, 'gold_consumed': None}, {'dtstatdate': '20240616', 'recharge_amount': 1143, 'gold_consumed': None}, {'dtstatdate': '20240617', 'recharge_amount': 620, 'gold_consumed': None}, {'dtstatdate': '20240618', 'recharge_amount': 479, 'gold_consumed': None}, {'dtstatdate': '20240619', 'recharge_amount': 672, 'gold_consumed': None}, {'dtstatdate': '20240620', 'recharge_amount': 1185, 'gold_consumed': None}, {'dtstatdate': '20240621', 'recharge_amount': 2621, 'gold_consumed': None}, {'dtstatdate': '20240622', 'recharge_amount': 782, 'gold_consumed': None}, {'dtstatdate': '20240623', 'recharge_amount': 2060, 'gold_consumed': None}, {'dtstatdate': '20240626', 'recharge_amount': 1907, 'gold_consumed': None}, {'dtstatdate': '20240627', 'recharge_amount': 493, 'gold_consumed': None}, {'dtstatdate': '20240628', 'recharge_amount': 486, 'gold_consumed': None}, {'dtstatdate': '20240629', 'recharge_amount': 1350, 'gold_consumed': None}, {'dtstatdate': '20240630', 'recharge_amount': 1173, 'gold_consumed': None}, {'dtstatdate': '20240701', 'recharge_amount': 4574, 'gold_consumed': None}, {'dtstatdate': '20240702', 'recharge_amount': 524, 'gold_consumed': None}, {'dtstatdate': '20240703', 'recharge_amount': 124, 'gold_consumed': None}, {'dtstatdate': '20240704', 'recharge_amount': 232, 'gold_consumed': None}, {'dtstatdate': '20240705', 'recharge_amount': 628, 'gold_consumed': None}, {'dtstatdate': '20240708', 'recharge_amount': 462, 'gold_consumed': None}, {'dtstatdate': '20240709', 'recharge_amount': 316, 'gold_consumed': None}, {'dtstatdate': '20240710', 'recharge_amount': 123, 'gold_consumed': None}, {'dtstatdate': '20240711', 'recharge_amount': 2281, 'gold_consumed': None}, {'dtstatdate': '20240712', 'recharge_amount': 2236, 'gold_consumed': None}, {'dtstatdate': '20240713', 'recharge_amount': 789, 'gold_consumed': None}, {'dtstatdate': '20240714', 'recharge_amount': 132, 'gold_consumed': None}, {'dtstatdate': '20240715', 'recharge_amount': 12376, 'gold_consumed': None}, {'dtstatdate': '20240716', 'recharge_amount': 499, 'gold_consumed': None}, {'dtstatdate': '20240717', 'recharge_amount': 79, 'gold_consumed': None}, {'dtstatdate': '20240718', 'recharge_amount': 53, 'gold_consumed': None}, {'dtstatdate': '20240719', 'recharge_amount': 3623.7, 'gold_consumed': None}, {'dtstatdate': '20240720', 'recharge_amount': 2288, 'gold_consumed': None}, {'dtstatdate': '20240721', 'recharge_amount': 480, 'gold_consumed': None}, {'dtstatdate': '20240722', 'recharge_amount': 12517, 'gold_consumed': None}, {'dtstatdate': '20240723', 'recharge_amount': 1433, 'gold_consumed': None}, {'dtstatdate': '20240725', 'recharge_amount': 841, 'gold_consumed': None}, {'dtstatdate': '20240726', 'recharge_amount': 1788, 'gold_consumed': None}, {'dtstatdate': '20240728', 'recharge_amount': 1002, 'gold_consumed': None}, {'dtstatdate': '20240731', 'recharge_amount': 1, 'gold_consumed': None}, {'dtstatdate': '20240801', 'recharge_amount': 50000, 'gold_consumed': None}, {'dtstatdate': '20240815', 'recharge_amount': 200000, 'gold_consumed': None}, {'dtstatdate': '20240901', 'recharge_amount': 800000, 'gold_consumed': None}, {'dtstatdate': '20240915', 'recharge_amount': 3500000, 'gold_consumed': None}, {'dtstatdate': '20241001', 'recharge_amount': 12000000, 'gold_consumed': None}, {'dtstatdate': '20241015', 'recharge_amount': 50000000, 'gold_consumed': None}, {'dtstatdate': '20241101', 'recharge_amount': 200000000, 'gold_consumed': None}, {'dtstatdate': '20241115', 'recharge_amount': 800000000, 'gold_consumed': None}, {'dtstatdate': '20241201', 'recharge_amount': 3500001200, 'gold_consumed': None}, {'dtstatdate': '20241205', 'recharge_amount': 0.6, 'gold_consumed': None}, {'dtstatdate': '20241210', 'recharge_amount': 0.8, 'gold_consumed': None}, {'dtstatdate': '20241215', 'recharge_amount': 12000000001, 'gold_consumed': None}, {'dtstatdate': '20241220', 'recharge_amount': 0.3, 'gold_consumed': None}, {'dtstatdate': '20241225', 'recharge_amount': 0.4, 'gold_consumed': None}, {'dtstatdate': '20241230', 'recharge_amount': 0.5, 'gold_consumed': None}, {'dtstatdate': '20241231', 'recharge_amount': 50000000000, 'gold_consumed': None}, {'dtstatdate': '20250115', 'recharge_amount': 6000, 'gold_consumed': None}, {'dtstatdate': '20250220', 'recharge_amount': 10000, 'gold_consumed': None}, {'dtstatdate': '20250225', 'recharge_amount': 20000, 'gold_consumed': None}]}
Starting processing sql sql_107...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dwd_jordass_activitypress_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_activitypress_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "小时分区字段，格式YYYYMMDDHH",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间,格式YYYY-MM-DDHH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家",\n  `uid` varchar(65533) NULL COMMENT "角色UID",\n  `buttontype` bigint(20) NULL COMMENT "按钮代号,找客户端开发问下定义",\n  `ireason` bigint(20) NULL COMMENT "活动id",\n  `extarg1` bigint(20) NULL COMMENT "附加参数1,客户端负责传过来",\n  `extarg2` varchar(65533) NULL COMMENT "附加参数2,客户端负责传过来",\n  `extarg3` bigint(20) NULL COMMENT "附加参数3,客户端负责传过来",\n  `devicetype` bigint(20) NULL COMMENT "DeviceType "\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dwd_jordass_activitypress_hi.vplayerid,dwd_jordass_activitypress_hi.dteventtime,dwd_jordass_activitypress_hi.buttontype,dwd_jordass_activitypress_hi.ireason,2022.1.18-1.24,2021.10.19-12.20,99123,3]
Selected goldensql references: [33, 45, 59]
classification_result: {'sub_questions': '在2022-01-18到2022-01-24期间，哪些玩家满足 buttontype=99123 且 ireason=3？", "在2021-10-19到2021-12-20期间，哪些玩家满足 buttontype=99123 且 ireason=3？", "哪些玩家同时满足上述两个条件？', 'flag': 'NESTED'}
sql: 
select
    count(distinct case when a.dteventtime between '2022-01-18' and '2022-01-24' then a.vplayerid end) as period1_count,
    count(distinct case when a.dteventtime between '2021-10-19' and '2021-12-20' then a.vplayerid end) as period2_count,
    count(distinct case when b.vplayerid is not null and c.vplayerid is not null then b.vplayerid end) as overlap_count
from dwd_jordass_activitypress_hi a
left join (
    select distinct vplayerid
    from dwd_jordass_activitypress_hi
    where dteventtime between '2022-01-18' and '2022-01-24'
    and buttontype = 99123
    and ireason = 3
) b on a.vplayerid = b.vplayerid
left join (
    select distinct vplayerid
    from dwd_jordass_activitypress_hi
    where dteventtime between '2021-10-19' and '2021-12-20'
    and buttontype = 99123
    and ireason = 3
) c on a.vplayerid = c.vplayerid
where a.buttontype = 99123
and a.ireason = 3;

[{'period1_count': 8, 'period2_count': 7, 'overlap_count': 3}]
Finished processing sql sql_107 in 39.89827108383179 seconds
{'sql_id': 'sql_107', 'sql': "\nselect\n    count(distinct case when a.dteventtime between '2022-01-18' and '2022-01-24' then a.vplayerid end) as period1_count,\n    count(distinct case when a.dteventtime between '2021-10-19' and '2021-12-20' then a.vplayerid end) as period2_count,\n    count(distinct case when b.vplayerid is not null and c.vplayerid is not null then b.vplayerid end) as overlap_count\nfrom dwd_jordass_activitypress_hi a\nleft join (\n    select distinct vplayerid\n    from dwd_jordass_activitypress_hi\n    where dteventtime between '2022-01-18' and '2022-01-24'\n    and buttontype = 99123\n    and ireason = 3\n) b on a.vplayerid = b.vplayerid\nleft join (\n    select distinct vplayerid\n    from dwd_jordass_activitypress_hi\n    where dteventtime between '2021-10-19' and '2021-12-20'\n    and buttontype = 99123\n    and ireason = 3\n) c on a.vplayerid = c.vplayerid\nwhere a.buttontype = 99123\nand a.ireason = 3;\n", 'status': 'success', 'result': [{'period1_count': 8, 'period2_count': 7, 'overlap_count': 3}]}
Starting processing sql sql_108...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dws_jordass_login_df', 'Create Table': 'CREATE TABLE `dws_jordass_login_df` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:不区分平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `cbitmap` varchar(65533) NULL COMMENT "登录位图",\n  `dregdate` varchar(65533) NULL COMMENT "注册日期，格式YYYYMMDD",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `friendcount` bigint(20) NULL COMMENT "好友数量"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dws_jordass_login_di', 'Create Table': 'CREATE TABLE `dws_jordass_login_di` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\t\'wx\' - 微信\t\'qq\' - 手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:所有平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `ionlinetime` bigint(20) NULL COMMENT "在线时长(秒)",\n  `ilogincount` bigint(20) NULL COMMENT "登录次数",\n  `friendcount` bigint(20) NULL COMMENT "好友数量",\n  `dtlogintime` varchar(65533) NULL COMMENT "当日最早登录时间,格式YYYY-MM-DDHH:MM:SS"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dim_mgamejp_tbplayerid2qq_nf', 'Create Table': 'CREATE TABLE `dim_mgamejp_tbplayerid2qq_nf` (\n  `dtstatdate` bigint(20) NULL COMMENT "统计日期YYYYMMDD",\n  `sappid` varchar(65533) NULL COMMENT "游戏id",\n  `splayerid` varchar(65533) NULL COMMENT "playerid",\n  `iqq` bigint(20) NULL COMMENT "QQ帐号"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dws_jordass_login_di.dtstatdate,dws_jordass_login_di.ilogincount,dim_mgamejp_tbplayerid2qq_nf.iqq,dws_jordass_login_di.vplayerid = dim_mgamejp_tbplayerid2qq_nf.splayerid,20250424,3]
Selected goldensql references: [48, 37, 38]
classification_result: {'sub_questions': '如何识别周流失用户？", "如何识别双周流失用户？", "如何识别月流失用户？", "如何识别近30天登录小于3天的低活跃用户？", "如何将玩家ID映射为QQ号？', 'flag': 'NESTED'}
sql: 
select 
    'iweek' as type,
    qq.iqq as qq_number
from dws_jordass_login_di login
join dim_mgamejp_tbplayerid2qq_nf qq on login.vplayerid = qq.splayerid
where login.dtstatdate = '20250424'
  and login.platid = 255
  and login.ilogincount = 0
  and datediff('20250424', login.dtstatdate) <= 7

union all

select 
    'doubleiweek' as type,
    qq.iqq as qq_number
from dws_jordass_login_di login
join dim_mgamejp_tbplayerid2qq_nf qq on login.vplayerid = qq.splayerid
where login.dtstatdate = '20250424'
  and login.platid = 255
  and login.ilogincount = 0
  and datediff('20250424', login.dtstatdate) <= 14

union all

select 
    'imonth' as type,
    qq.iqq as qq_number
from dws_jordass_login_di login
join dim_mgamejp_tbplayerid2qq_nf qq on login.vplayerid = qq.splayerid
where login.dtstatdate = '20250424'
  and login.platid = 255
  and login.ilogincount = 0
  and datediff('20250424', login.dtstatdate) <= 30

union all

select 
    '30dayxioayu3day' as type,
    qq.iqq as qq_number
from dws_jordass_login_di login
join dim_mgamejp_tbplayerid2qq_nf qq on login.vplayerid = qq.splayerid
where login.dtstatdate = '20250424'
  and login.platid = 255
  and (
      select count(distinct dtstatdate) 
      from dws_jordass_login_di 
      where vplayerid = login.vplayerid 
        and dtstatdate between date_sub('20250424', 29) and '20250424'
  ) < 3;

[]
Finished processing sql sql_108 in 47.050668478012085 seconds
{'sql_id': 'sql_108', 'sql': "\nselect \n    'iweek' as type,\n    qq.iqq as qq_number\nfrom dws_jordass_login_di login\njoin dim_mgamejp_tbplayerid2qq_nf qq on login.vplayerid = qq.splayerid\nwhere login.dtstatdate = '20250424'\n  and login.platid = 255\n  and login.ilogincount = 0\n  and datediff('20250424', login.dtstatdate) <= 7\n\nunion all\n\nselect \n    'doubleiweek' as type,\n    qq.iqq as qq_number\nfrom dws_jordass_login_di login\njoin dim_mgamejp_tbplayerid2qq_nf qq on login.vplayerid = qq.splayerid\nwhere login.dtstatdate = '20250424'\n  and login.platid = 255\n  and login.ilogincount = 0\n  and datediff('20250424', login.dtstatdate) <= 14\n\nunion all\n\nselect \n    'imonth' as type,\n    qq.iqq as qq_number\nfrom dws_jordass_login_di login\njoin dim_mgamejp_tbplayerid2qq_nf qq on login.vplayerid = qq.splayerid\nwhere login.dtstatdate = '20250424'\n  and login.platid = 255\n  and login.ilogincount = 0\n  and datediff('20250424', login.dtstatdate) <= 30\n\nunion all\n\nselect \n    '30dayxioayu3day' as type,\n    qq.iqq as qq_number\nfrom dws_jordass_login_di login\njoin dim_mgamejp_tbplayerid2qq_nf qq on login.vplayerid = qq.splayerid\nwhere login.dtstatdate = '20250424'\n  and login.platid = 255\n  and (\n      select count(distinct dtstatdate) \n      from dws_jordass_login_di \n      where vplayerid = login.vplayerid \n        and dtstatdate between date_sub('20250424', 29) and '20250424'\n  ) < 3;\n", 'status': 'success', 'result': []}
Starting processing sql sql_109...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dwd_jordass_roundlog_funnymode_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_roundlog_funnymode_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "游戏APPID",\n  `platid` bigint(20) NULL COMMENT "ios 0/android 1",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家",\n  `uid` varchar(65533) NULL COMMENT "玩家UID",\n  `battleid` varchar(65533) NULL COMMENT "对局ID",\n  `mode` bigint(20) NULL COMMENT "模式",\n  `submode` bigint(20) NULL COMMENT "子模式",\n  `startime` bigint(20) NULL COMMENT "开局时刻",\n  `escapecheckup` bigint(20) NULL COMMENT "是否逃跑",\n  `currentroundrank` bigint(20) NULL COMMENT "当局名次,广域战场模式是本阵营中的排名",\n  `sumscore` bigint(20) NULL COMMENT "流水总评分",\n  `titleidlist` varchar(65533) NULL COMMENT "当局获得的称号Id",\n  `teamrank` bigint(20) NULL COMMENT "队伍名次",\n  `teamid` bigint(20) NULL COMMENT "小队ID",\n  `flowratinglevel` varchar(65533) NULL COMMENT "当局游戏的评价等级，前面有个Int类型的，但是非要求加一个字符串类型的",\n  `roundtime` bigint(20) NULL COMMENT "对局时长(秒)",\n  `gold` bigint(20) NULL COMMENT "金钱变化值",\n  `level` bigint(20) NULL COMMENT "等级变化值",\n  `map` bigint(20) NULL COMMENT "地图",\n  `playernumber` bigint(20) NULL COMMENT "玩家数",\n  `realplayernumber` bigint(20) NULL COMMENT "真人玩家数",\n  `teamnumber` bigint(20) NULL COMMENT "小队数",\n  `teammemberlist` varchar(65533) NULL COMMENT "队友List",\n  `killingcount` bigint(20) NULL COMMENT "击杀",\n  `assistcount` bigint(20) NULL COMMENT "助攻次数",\n  `survivaltime` bigint(20) NULL COMMENT "存活总时间",\n  `damageamount` bigint(20) NULL COMMENT "总伤害量,浮点数，乘以100存入",\n  `healtimes` bigint(20) NULL COMMENT "救人次数",\n  `healamount` bigint(20) NULL COMMENT "治疗量，浮点数，乘以100存入",\n  `movingdistance` bigint(20) NULL COMMENT "前进距离",\n  `deadflow` varchar(65533) NULL COMMENT "死亡流水 死亡坐标/死亡类型/死亡时间",\n  `headshotcounts` bigint(20) NULL COMMENT "爆头数",\n  `vehicledestoryedtimes` bigint(20) NULL COMMENT "摧毁载具次数",\n  `killingflow` varchar(65533) NULL COMMENT "击杀流水 :击杀目标ID\t击杀类型\t是否爆头\t击杀距离\t使用的武器ID\t击杀者（角色自己）位置  新增：\t被击杀者位置\t击杀时间（从进入小岛开始到击杀时的毫秒数）\t造成伤害量\t是否移动\t击杀区域ID(-1表示区域表中不记录)\t状态(1:卧倒)\t被击倒的武器id\t击杀圈数\t被击杀者名字\t是否灭队\t是否为ai\tAI的类型\t击倒者uid\t击杀者uid",\n  `walkingdistance` bigint(20) NULL COMMENT "步行距离",\n  `collectindex` bigint(20) NULL COMMENT "物资指数，浮点数，乘以100存入",\n  `survivalindex` bigint(20) NULL COMMENT "生存指数，浮点数，乘以100存入",\n  `damageindex` bigint(20) NULL COMMENT "伤害指数，浮点数，乘以100存入",\n  `healindex` bigint(20) NULL COMMENT "支援指数，浮点数，乘以100存入",\n  `assaultindex` bigint(20) NULL COMMENT "战斗指数，浮点数，乘以100存入",\n  `gunhittimes` bigint(20) NULL COMMENT "枪械命中次数",\n  `gunshottimes` bigint(20) NULL COMMENT "枪械射击次数",\n  `curecount` bigint(20) NULL COMMENT "治疗次数",\n  `landlocation` varchar(65533) NULL COMMENT "落地点坐标,有效字段",\n  `oweruid` varchar(65533) NULL COMMENT "房主uid",\n  `ismvp` bigint(20) NULL COMMENT "不是mvp 0/是mvp 1",\n  `pronetime` bigint(20) NULL COMMENT "趴地时间",\n  `drivingdistance` bigint(20) NULL COMMENT "行驶距离",\n  `obtianedairdroptimes` bigint(20) NULL COMMENT "获得空投次数",\n  `killeruid` varchar(65533) NULL COMMENT "击杀者UID",\n  `giveboxnum` bigint(20) NULL COMMENT "年兽模式给宝箱个数,ug字段，兼容保留",\n  `deadnum` bigint(20) NULL COMMENT "年兽模式死亡次数,ug字段，兼容保留",\n  `result` varchar(65533) NULL COMMENT "Reason字段，广域战场模式：胜利Win，失败Fail。年兽模式：击败年兽win 全部人员死亡dead 打年兽超时timeout,ug字段，兼容保留",\n  `lobbyteamid` varchar(65533) NULL COMMENT "大厅队伍id",\n  `topxtipsresponse` bigint(20) NULL COMMENT "未进入前5:-1;不点击:0;继续战斗:1;退出竞赛:2",\n  `signalhealamount` bigint(20) NULL COMMENT "信号治疗量",\n  `monsterkilltotalnum` bigint(20) NULL COMMENT "总击杀僵尸数量",\n  `zombiekillingflow` varchar(65533) NULL COMMENT "僵尸击杀流水 僵尸id\t击杀数量\t是否爆头击杀\t击杀类型\t击杀武器id",\n  `monsterdamageamount` bigint(20) NULL COMMENT "总对僵尸伤害",\n  `drivinghelicoptertime` bigint(20) NULL COMMENT "驾驶直升飞机时间",\n  `inhelicoptertime` bigint(20) NULL COMMENT "乘坐直升飞机时间",\n  `makefiresnum` bigint(20) NULL COMMENT "生火成功次数,极寒模式",\n  `friendcount` bigint(20) NULL COMMENT "队友中的好友数量",\n  `teammemberrelalist` varchar(65533) NULL COMMENT "与TeamMemberList相对应，与其他队员之间的好友关系（0非好友，1平台好友，2为游戏好友）拼接，多个好友之间用+拼接。例如1+2+2",\n  `teammembersexlist` varchar(65533) NULL COMMENT "与TeamMemberList相对应，其他队员的性别拼接（1表示男，2表示女），多个好友之间用+拼接。例如1+2+2",\n  `maxhurtweaponid` bigint(20) NULL COMMENT "最大伤害的武器ID",\n  `maxdamage` bigint(20) NULL COMMENT "武器的最大伤害",\n  `pointsurvivalseconds` bigint(20) NULL COMMENT "据点内存活时间",\n  `useweaponlist` varchar(65533) NULL COMMENT "击杀所用武器的列表, 用,拼接。例如1,2,2",\n  `teammembertmrelalist` varchar(65533) NULL COMMENT "与TeamMemberList相对应，与其他队员之间的默契好友关系（1是0非）拼接，多个好友之间用+拼接。例如1+0+1",\n  `playid` bigint(20) NULL COMMENT "限时模式的玩法id,非限时模式则为0",\n  `campid` bigint(20) NULL COMMENT "广域战场阵营id，进攻方1，防守方2",\n  `score` bigint(20) NULL COMMENT "广域战场获得积分",\n  `professioncareerinfo` varchar(65533) NULL COMMENT "广域战场每个职业的总积分/总时间及经验获取list 职业id:获得积分,使用时间,获得经验 + 职业id:获得积分,使用时间,获得经验",\n  `device_type` bigint(20) NULL COMMENT "设备类型0为手机 1为模拟器 2 键鼠 3 手柄",\n  `deploymaxkills` bigint(20) NULL COMMENT "广域战场单局单次部署最大击杀",\n  `gamenum` bigint(20) NULL COMMENT "广域战场模式对局数",\n  `bigwarrating` bigint(20) NULL COMMENT "广域战场模式积分,这局前",\n  `bigwarchangerating` bigint(20) NULL COMMENT "广域战场模式积分这局的变化值",\n  `destroyvehicleweaponlist` varchar(65533) NULL COMMENT "摧毁载具武器列表，载具ID:武器ID+载具ID:武器ID"\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dwd_jordass_roundflow_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_roundflow_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "小时分区字段，格式YYYYMMDDHH",\n  `gamesvrid` varchar(65533) NULL COMMENT "登录的游戏服务器编号",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家",\n  `uid` varchar(65533) NULL COMMENT "玩家UID",\n  `battleid` varchar(65533) NULL COMMENT "对局ID",\n  `battletype` bigint(20) NULL COMMENT "战斗类型对应BATTLETYPE,其它说明参考FAQ文档",\n  `roundscore` bigint(20) NULL COMMENT "本局分数,无得分的填0",\n  `roundtime` bigint(20) NULL COMMENT "对局时长(秒)",\n  `result` bigint(20) NULL COMMENT "单局结果，参考 Result",\n  `gold` bigint(20) NULL COMMENT "金钱变化值",\n  `level` bigint(20) NULL COMMENT "等级变化值",\n  `seasonid` bigint(20) NULL COMMENT "所属赛季ID",\n  `mode` bigint(20) NULL COMMENT "101：传统模式第三人称单排\t102：传统模式第三人称双排\t103：传统模式第三人称四排\t401：传统模式第一人称单排\t402：传统模式第一人称双排\t403：传统模式第一人称四排\t603：创意创作间计分模式第三人称四排(含极能形态模式、极限追猎、特种作战等子模式)",\n  `submode` bigint(20) NULL COMMENT "子模式",\n  `map` bigint(20) NULL COMMENT "地图",\n  `weather` bigint(20) NULL COMMENT "天气",\n  `startime` bigint(20) NULL COMMENT "开局时刻",\n  `endtime` bigint(20) NULL COMMENT "结束时刻",\n  `playernumber` bigint(20) NULL COMMENT "玩家数",\n  `realplayernumber` bigint(20) NULL COMMENT "真人玩家数",\n  `teamnumber` bigint(20) NULL COMMENT "小队数",\n  `teammemberlist` varchar(65533) NULL COMMENT "队友id解析字段teammemberlist步骤：\t使用lateral VIEW explode(split(teammemberlist,\'\\\\+\')) adTable AS buttontype 函数通过 \\\\+截取进行行转列进行计算。",\n  `escapecheckup` bigint(20) NULL COMMENT "是否逃跑",\n  `totalchangedpointvalue` bigint(20) NULL COMMENT "综合积分变化值",\n  `changedratingvalue` bigint(20) NULL COMMENT "rating分变化值",\n  `ratingvalueallianceforceterchanged` bigint(20) NULL COMMENT "rating分变化后的值",\n  `changedkillratingvalue` bigint(20) NULL COMMENT "kill rating分变化值",\n  `killratingvalueallianceforceterchanged` bigint(20) NULL COMMENT "kill rating分变化后的值",\n  `changedwinratingvalue` bigint(20) NULL COMMENT "win rating分变化值",\n  `winratingvalueallianceforceterchanged` bigint(20) NULL COMMENT "win rating分变化后的值",\n  `playergetexperience` bigint(20) NULL COMMENT "玩家获得的经验值",\n  `currentroundrank` bigint(20) NULL COMMENT "当局名次",\n  `killingcount` bigint(20) NULL COMMENT "击杀",\n  `assistcount` bigint(20) NULL COMMENT "助攻次数",\n  `survivaltime` bigint(20) NULL COMMENT "存活总时间(秒)",\n  `damageamount` bigint(20) NULL COMMENT "总伤害量,浮点数，乘以100存入",\n  `healtimes` bigint(20) NULL COMMENT "救人次数",\n  `healamount` bigint(20) NULL COMMENT "治疗量，浮点数，乘以100存入",\n  `movingdistance` bigint(20) NULL COMMENT "前进距离，单位米",\n  `dyingflow` varchar(65533) NULL COMMENT "濒死流水，暂无",\n  `deadflow` varchar(65533) NULL COMMENT "死亡流水 死亡坐标/死亡类型/死亡时间",\n  `headshotcounts` bigint(20) NULL COMMENT "爆头数",\n  `gunkillingtimes` bigint(20) NULL COMMENT "枪械击杀数，暂无",\n  `meleekilltimes` bigint(20) NULL COMMENT "近战击杀数，暂无",\n  `rangeddamagedamount` bigint(20) NULL COMMENT "远程武器伤害量，暂无",\n  `meleedamageamount` bigint(20) NULL COMMENT "近战伤害量，暂无",\n  `obtianeditemflow` bigint(20) NULL COMMENT "获得的物品流水，暂无",\n  `obtianedairdroptimes` bigint(20) NULL COMMENT "获得空投次数",\n  `vehicledestoryedtimes` bigint(20) NULL COMMENT "摧毁载具次数",\n  `landingcoordinate` bigint(20) NULL COMMENT "落地点坐标,弃用，之前定义的类型是int，应该是字符串",\n  `killingflow` varchar(65533) NULL COMMENT "击杀流水 :击杀目标ID\t击杀类型\t是否爆头\t击杀距离\t使用的武器ID\t击杀者（角色自己）位置  新增：\t被击杀者位置\t击杀时间（从进入小岛开始到击杀时的毫秒数）\t造成伤害量\t是否移动\t击杀区域ID(-1表示区域表中不记录)\t状态(1:卧倒)\t被击倒的武器id\t击杀圈数\t被击杀者名字\t是否灭队\t是否为ai\tAI的类型\t击倒者uid\t击杀者uid",\n  `creepingtime` bigint(20) NULL COMMENT "匍匐时间",\n  `swimmingtime` bigint(20) NULL COMMENT "游泳时间，暂无",\n  `divingtime` bigint(20) NULL COMMENT "潜水时间，暂无",\n  `drivingtime` bigint(20) NULL COMMENT "驾驶载具时间",\n  `ridingtime` bigint(20) NULL COMMENT "乘坐载具时间，暂无",\n  `walkingdistance` bigint(20) NULL COMMENT "步行距离，单位米",\n  `staytimeinpoisonedarea` bigint(20) NULL COMMENT "吃毒时间",\n  `damageindex` bigint(20) NULL COMMENT "击杀指数,乘100后四舍五入",\n  `luckyindex` bigint(20) NULL COMMENT "幸运指数，弃用无效",\n  `collectindex` bigint(20) NULL COMMENT "物资指数,乘100后四舍五入",\n  `survivalindex` bigint(20) NULL COMMENT "生存指数,乘100后四舍五入",\n  `movingindex` bigint(20) NULL COMMENT "前进指数，弃用无效",\n  `creepindex` bigint(20) NULL COMMENT "伏地指数，弃用无效",\n  `accuracyindex` bigint(20) NULL COMMENT "精准指数，弃用无效",\n  `deliveryindex` bigint(20) NULL COMMENT "快递指数，弃用无效",\n  `sneakattackindex` bigint(20) NULL COMMENT "偷袭指数，弃用无效",\n  `healindex` bigint(20) NULL COMMENT "支援指数,乘100后四舍五入",\n  `boxindex` bigint(20) NULL COMMENT "盒子指数，弃用无效",\n  `assaultindex` bigint(20) NULL COMMENT "伤害指数,乘100后四舍五入",\n  `totalpoint` bigint(20) NULL COMMENT "综合积分变化后的值",\n  `ratinglevel` bigint(20) NULL COMMENT "流水评价等级",\n  `titleidlist` varchar(65533) NULL COMMENT "当局获得的称号Id",\n  `itemuseflow` varchar(65533) NULL COMMENT "装备的物品流水",\n  `medicineuseflow` varchar(65533) NULL COMMENT "使用的药品流水",\n  `gunhittimes` bigint(20) NULL COMMENT "枪械命中次数",\n  `gunshottimes` bigint(20) NULL COMMENT "枪械射击次数",\n  `teamrank` bigint(20) NULL COMMENT "队伍名次",\n  `curecount` bigint(20) NULL COMMENT "治疗次数",\n  `drivingdistance` bigint(20) NULL COMMENT "行驶距离，单位米",\n  `totalscorerank` bigint(20) NULL COMMENT "综合评分排名，弃用无效",\n  `rating` bigint(20) NULL COMMENT "鸡分",\n  `killrating` bigint(20) NULL COMMENT "消灭鸡分",\n  `winrating` bigint(20) NULL COMMENT "排名鸡分",\n  `ratingrank` bigint(20) NULL COMMENT "鸡分排名，弃用无效",\n  `killingratingrank` bigint(20) NULL COMMENT "消灭鸡分排名，弃用无效",\n  `winratingrank` bigint(20) NULL COMMENT "排名鸡分排名，弃用无效",\n  `totalround` bigint(20) NULL COMMENT "赛季分人称几排总场数",\n  `totalkill` bigint(20) NULL COMMENT "赛季分人称几排总杀敌数",\n  `totalwin` bigint(20) NULL COMMENT "赛季分人称几排总胜利数",\n  `top10times` bigint(20) NULL COMMENT "前十数",\n  `totalheadshotrate` bigint(20) NULL COMMENT "赛季分人称几排总爆头率",\n  `averagesurvivaltimeperround` bigint(20) NULL COMMENT "场均存活时间",\n  `healfriendtimes` bigint(20) NULL COMMENT "救助队友次数",\n  `averagemovedistanceperround` bigint(20) NULL COMMENT "场均移动距离",\n  `maxdamageinoneround` bigint(20) NULL COMMENT "单局最高伤害",\n  `maxkillinginoneround` bigint(20) NULL COMMENT "单局最高击杀",\n  `maxsurvivaltime` bigint(20) NULL COMMENT "最长存活时间",\n  `maxmovingdistance` bigint(20) NULL COMMENT "最长移动距离",\n  `contributionrankrating` bigint(20) NULL COMMENT "单排总积分贡献分",\n  `contributionkillrating` bigint(20) NULL COMMENT "单排击败积分贡献分",\n  `contributionwinrating` bigint(20) NULL COMMENT "单排生存积分贡献分",\n  `oldsegmentlevel` bigint(20) NULL COMMENT "旧段位",\n  `newsegmentlevel` bigint(20) NULL COMMENT "新段位",\n  `teamid` bigint(20) NULL COMMENT "小队ID",\n  `landlocation` varchar(65533) NULL COMMENT "落地点坐标,有效字段,单位cm",\n  `totaldeadtimes` bigint(20) NULL COMMENT "赛季分人称几排总死亡数",\n  `sumscore` bigint(20) NULL COMMENT "流水总评分，乘以100后存入",\n  `seasonsurvivalindex` bigint(20) NULL COMMENT "赛季参赛指数",\n  `seasontop1index` bigint(20) NULL COMMENT "赛季获胜率指数",\n  `seasonratingindex` bigint(20) NULL COMMENT "赛季总积分指数",\n  `seasonassaultindex` bigint(20) NULL COMMENT "赛季竞赛指数",\n  `seasonhealindex` bigint(20) NULL COMMENT "赛季支援指数",\n  `seasonmovingindex` bigint(20) NULL COMMENT "赛季前进指数",\n  `seasonsumscore` bigint(20) NULL COMMENT "赛季总评分，乘以100后存入",\n  `seasonratinglevel` bigint(20) NULL COMMENT "赛季评价等级",\n  `modesurvivalindex` bigint(20) NULL COMMENT "当前模式参赛指数",\n  `modetop1index` bigint(20) NULL COMMENT "当前模式获胜率指数",\n  `moderatingindex` bigint(20) NULL COMMENT "当前模式总积分指数",\n  `modeassaultindex` bigint(20) NULL COMMENT "当前模式竞赛指数",\n  `modehealindex` bigint(20) NULL COMMENT "当前模式支援指数",\n  `modemovingindex` bigint(20) NULL COMMENT "当前模式前进指数",\n  `modesumscore` bigint(20) NULL COMMENT "当前模式总评分，乘以100后存入",\n  `moderatinglevel` bigint(20) NULL COMMENT "当前模式评价等级",\n  `flowratinglevel` varchar(65533) NULL COMMENT "当局游戏的评价等级，前面有个Int类型的，但是非要求加一个字符串类型的",\n  `rolename` varchar(65533) NULL COMMENT "玩家角色名",\n  `totaldamage` bigint(20) NULL COMMENT "赛季分人称几排总伤害量",\n  `totalheal` bigint(20) NULL COMMENT "赛季分人称几排总治疗量",\n  `matchtype` bigint(20) NULL COMMENT "匹配模式0：手机 1模拟器 8小黑屋 9新手局",\n  `duocontributionrankrating` bigint(20) NULL COMMENT "双人总积分贡献分",\n  `duocontributionkillrating` bigint(20) NULL COMMENT "双人击败积分贡献分",\n  `duocontributionwinrating` bigint(20) NULL COMMENT "双人生存积分贡献分",\n  `squadcontributionrankrating` bigint(20) NULL COMMENT "四人总积分贡献分",\n  `squadcontributionkillrating` bigint(20) NULL COMMENT "四人击败积分贡献分",\n  `squadcontributionwinrating` bigint(20) NULL COMMENT "四人生存积分贡献分",\n  `famousid` bigint(20) NULL COMMENT "名人名言tips ID",\n  `dsendtime` varchar(65533) NULL COMMENT "新结束时间字段，ds传过来的字符串",\n  `equipmentinfo` varchar(65533) NULL COMMENT "装备信息:头盔ID\t防弹衣ID\t背包ID\t主武器1ID\t主武器1配件ID列表(以,分隔)\t主武器2ID\t主武器2配件ID列表(以,分隔)\t副武器ID\t副武器配件ID列表(以,分隔)\t近战武器ID\t投掷武器ID\t是否佩戴吉利服",\n  `segmentprotect` bigint(20) NULL COMMENT "段位保护标记，1为触发了该段位的段位保护，0为没有触发",\n  `ismvp` bigint(20) NULL COMMENT "不是mvp 0/是mvp 1",\n  `pronetime` bigint(20) NULL COMMENT "趴地时间",\n  `followstate` bigint(20) NULL COMMENT "跳伞跟随  0不跟随，也不被跟随；1是被跟随；2是跟随",\n  `touchdownareaid` bigint(20) NULL COMMENT "降落地点类型, 参见赛季任务降落地点类型表",\n  `getpropsnumfromteammates` bigint(20) NULL COMMENT "接受队友道具数",\n  `sendpropsnumtoteammates` bigint(20) NULL COMMENT "赠送队友道具数",\n  `starttorescuetimes` bigint(20) NULL COMMENT "开始救援次数",\n  `avatargamegender` bigint(20) NULL COMMENT "Avatar性别",\n  `avatarhairid` bigint(20) NULL COMMENT "Avatar发型",\n  `avatarheadid` bigint(20) NULL COMMENT "Avatar脸型",\n  `avatarfeaturenum` bigint(20) NULL COMMENT "Avatar时装个数",\n  `avatarfeaturelist_1` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_2` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_3` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_4` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_5` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_6` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_7` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_8` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_9` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_10` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarweaponid` bigint(20) NULL COMMENT "Avatar枪械",\n  `avatarweaponskinid` bigint(20) NULL COMMENT "Avatar枪械皮肤",\n  `killeruid` varchar(65533) NULL COMMENT "击杀者UID",\n  `killerweaponid` bigint(20) NULL COMMENT "击杀者使用武器ID",\n  `killerdistance` bigint(20) NULL COMMENT "击杀者距离",\n  `lobbyteamid` varchar(65533) NULL COMMENT "大厅队伍id,ug字段，兼容保留",\n  `makefiresnum` bigint(20) NULL COMMENT "生火成功次数,极寒模式",\n  `isregress` bigint(20) NULL COMMENT "是否回流",\n  `topxtipsresponse` bigint(20) NULL COMMENT "未进入前5:-1;不点击:0;继续战斗:1;退出竞赛:2",\n  `signalhealamount` bigint(20) NULL COMMENT "信号治疗量",\n  `drivinghelicoptertime` bigint(20) NULL COMMENT "驾驶直升飞机时间",\n  `inhelicoptertime` bigint(20) NULL COMMENT "乘坐直升飞机时间",\n  `noreductratingscore` bigint(20) NULL COMMENT "是否触发了不掉分活动",\n  `changedtrueratingvalue` bigint(20) NULL COMMENT "true rating分变化值",\n  `trueratingvalueallianceforceterchanged` bigint(20) NULL COMMENT "true rating分变化后的值",\n  `teammemberrelalist` varchar(65533) NULL COMMENT "与TeamMemberList相对应，与其他队员之间的好友关系（0非好友，1平台好友，2为游戏好友）拼接，多个好友之间用+拼接。例如1+2+2",\n  `teammembersexlist` varchar(65533) NULL COMMENT "与TeamMemberList相对应，其他队员的性别拼接（1表示男，2表示女），多个好友之间用+拼接。例如1+2+2",\n  `friendcount` bigint(20) NULL COMMENT "队友中的好友数量",\n  `maxhurtweaponid` bigint(20) NULL COMMENT "最大伤害的武器ID",\n  `maxdamage` bigint(20) NULL COMMENT "武器的最大伤害",\n  `allianceforceterlevel` bigint(20) NULL COMMENT "结算后等级",\n  `isobexit` bigint(20) NULL COMMENT "是否观战退出",\n  `noreductrating` bigint(20) NULL COMMENT "是否触发不掉分活动",\n  `extraaddrating` bigint(20) NULL COMMENT "是否触发首战加分活动",\n  `protectrating` bigint(20) NULL COMMENT "是否触发保分机制",\n  `doublescore` bigint(20) NULL COMMENT "是否触发双倍上分活动",\n  `fateaddscore` bigint(20) NULL COMMENT "是否触发缘分队友加分活动",\n  `isnewaistrategy` bigint(20) NULL COMMENT "是否新的AI策略",\n  `lobbymemberlist` varchar(65533) NULL COMMENT "大厅组队队友列表",\n  `ratingtype` bigint(20) NULL COMMENT "计算的排位积分类型",\n  `killername` varchar(65533) NULL COMMENT "击杀我的人的名字",\n  `changekd` bigint(20) NULL COMMENT "当局结算引起的KD变化值，乘100后存入",\n  `friendteamaddscore` bigint(20) NULL COMMENT "是否触发好友四排组队加分活动",\n  `xuanwunoreductrating` bigint(20) NULL COMMENT "是否触发玄武不掉分活动",\n  `gunmateriallist` varchar(65533) NULL COMMENT "枪匠模式对局带出的改装件",\n  `bountynum` bigint(20) NULL COMMENT "枪匠模式的赏金数量",\n  `evacuatetype` bigint(20) NULL COMMENT "枪匠模式的逃脱类型。0 没有逃脱，1 直升机， 2 地堡， 3 的士",\n  `triggerrepeatkilllimit` bigint(20) NULL COMMENT "触发重复击杀限制",\n  `doublescoretimes` bigint(20) NULL COMMENT "是否触发双倍上分次数活动",\n  `teammembertmrelalist` varchar(65533) NULL COMMENT "Avatar时装",\n  `device_type` bigint(20) NULL COMMENT "设备类型0为手机 1为模拟器 2 键鼠 3 手柄"\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dwd_jordass_roundflow_hi.dteventtime,dwd_jordass_roundflow_hi.result,dwd_jordass_roundflow_hi.totalwin,20250424,20250508,1,2-10,11-20,21-50,51-80,81-100,101-200,201-500,501]
Selected goldensql references: [30, 35, 49]
classification_result: {'sub_questions': 'How many victories does each player have in the date range?", "Which victory count range does each player fall into?", "How many players are in each victory count range?', 'flag': 'NESTED'}
sql: 
with victory_counts as (
    select 
        vplayerid,
        sum(case when result = 1 then 1 else 0 end) as total_wins
    from dwd_jordass_roundflow_hi
    where dteventtime between '20250424' and '20250508'
      and mode in (101,102,103,401,402,403,201,202,203,601,602,603)
    group by vplayerid
)

select 
    case 
        when total_wins = 1 then '1'
        when total_wins between 2 and 10 then '2-10'
        when total_wins between 11 and 20 then '11-20'
        when total_wins between 21 and 50 then '21-50'
        when total_wins between 51 and 80 then '51-80'
        when total_wins between 81 and 100 then '81-100'
        when total_wins between 101 and 200 then '101-200'
        when total_wins between 201 and 500 then '201-500'
        when total_wins > 500 then '501以上'
    end as victory_range,
    count(distinct vplayerid) as player_count
from victory_counts
group by 
    case 
        when total_wins = 1 then '1'
        when total_wins between 2 and 10 then '2-10'
        when total_wins between 11 and 20 then '11-20'
        when total_wins between 21 and 50 then '21-50'
        when total_wins between 51 and 80 then '51-80'
        when total_wins between 81 and 100 then '81-100'
        when total_wins between 101 and 200 then '101-200'
        when total_wins between 201 and 500 then '201-500'
        when total_wins > 500 then '501以上'
    end
order by victory_range;

[]
Finished processing sql sql_109 in 43.490575313568115 seconds
{'sql_id': 'sql_109', 'sql': "\nwith victory_counts as (\n    select \n        vplayerid,\n        sum(case when result = 1 then 1 else 0 end) as total_wins\n    from dwd_jordass_roundflow_hi\n    where dteventtime between '20250424' and '20250508'\n      and mode in (101,102,103,401,402,403,201,202,203,601,602,603)\n    group by vplayerid\n)\n\nselect \n    case \n        when total_wins = 1 then '1'\n        when total_wins between 2 and 10 then '2-10'\n        when total_wins between 11 and 20 then '11-20'\n        when total_wins between 21 and 50 then '21-50'\n        when total_wins between 51 and 80 then '51-80'\n        when total_wins between 81 and 100 then '81-100'\n        when total_wins between 101 and 200 then '101-200'\n        when total_wins between 201 and 500 then '201-500'\n        when total_wins > 500 then '501以上'\n    end as victory_range,\n    count(distinct vplayerid) as player_count\nfrom victory_counts\ngroup by \n    case \n        when total_wins = 1 then '1'\n        when total_wins between 2 and 10 then '2-10'\n        when total_wins between 11 and 20 then '11-20'\n        when total_wins between 21 and 50 then '21-50'\n        when total_wins between 51 and 80 then '51-80'\n        when total_wins between 81 and 100 then '81-100'\n        when total_wins between 101 and 200 then '101-200'\n        when total_wins between 201 and 500 then '201-500'\n        when total_wins > 500 then '501以上'\n    end\norder by victory_range;\n", 'status': 'success', 'result': []}
Starting processing sql sql_110...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dws_jordass_login_di', 'Create Table': 'CREATE TABLE `dws_jordass_login_di` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\t\'wx\' - 微信\t\'qq\' - 手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:所有平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `ionlinetime` bigint(20) NULL COMMENT "在线时长(秒)",\n  `ilogincount` bigint(20) NULL COMMENT "登录次数",\n  `friendcount` bigint(20) NULL COMMENT "好友数量",\n  `dtlogintime` varchar(65533) NULL COMMENT "当日最早登录时间,格式YYYY-MM-DDHH:MM:SS"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dwd_jordass_activity_rewardrecord_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_activity_rewardrecord_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "小时分区字段，格式YYYYMMDDHH",\n  `gamesvrid` varchar(65533) NULL COMMENT "登录的游戏服务器编号",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "用户playerid号",\n  `uid` varchar(65533) NULL COMMENT "角色UID",\n  `actid` bigint(20) NULL COMMENT "\t\t活动id",\n  `acttype` bigint(20) NULL COMMENT "活动类型",\n  `awardidx` bigint(20) NULL COMMENT "第几挡奖励",\n  `awardcnt` bigint(20) NULL COMMENT "兑换几次 默认1次",\n  `value` bigint(20) NULL COMMENT "扩展字段(不同业务解释)",\n  `reissueflag` bigint(20) NULL COMMENT "活动补发字段，默认为0不补发，1为补发",\n  `cond1` bigint(20) NULL COMMENT "条件1值，任务大类型",\n  `cond2` bigint(20) NULL COMMENT "条件2值，任务子类型",\n  `cond3` bigint(20) NULL COMMENT "条件3值，任务条件值",\n  `device_type` bigint(20) NULL COMMENT "设备类型0为手机,1为模拟器, 2键鼠, 3手柄, 5是PC客户端,也是高清模拟器。"\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dws_jordass_login_di.dtstatdate,dwd_jordass_activity_rewardrecord_hi.vplayerid,dws_jordass_login_di.vplayerid,20220413,20220421]
Selected goldensql references: [37, 35, 49]
classification_result: {'sub_questions': '如何从登录表里取出20220413-20220421的活跃用户 cohort？","如何从登录表里取出20220413-20220428的登录行为？","如何从活动表里取出20220413-20220428的活动行为？","如何按统计日期聚合登录次留/3留/7留？","如何按统计日期聚合活动次留/3留/7留？', 'flag': 'NESTED'}
sql: 
with login_cohort as (
    select 
        dtstatdate as ds,
        vplayerid
    from dws_jordass_login_di
    where dtstatdate between '20220413' and '20220421'
    and platid = 255
    group by dtstatdate, vplayerid
),

login_behavior as (
    select 
        dtstatdate as ds,
        vplayerid
    from dws_jordass_login_di
    where dtstatdate between '20220413' and '20220428'
    and platid = 255
    group by dtstatdate, vplayerid
),

activity_behavior as (
    select 
        substr(dteventtime, 1, 8) as ds,
        vplayerid
    from dwd_jordass_activity_rewardrecord_hi
    where substr(dteventtime, 1, 8) between '20220413' and '20220428'
    and actid = 2201123904
    group by substr(dteventtime, 1, 8), vplayerid
)

select 
    lc.ds as stat_date,
    count(distinct ac.vplayerid) as activity_user_count,
    count(distinct case when lb1.ds = date_add(lc.ds, 1) then lc.vplayerid end) as login_next_day_retention,
    count(distinct case when lb1.ds = date_add(lc.ds, 2) then lc.vplayerid end) as login_three_day_retention,
    count(distinct case when lb1.ds = date_add(lc.ds, 6) then lc.vplayerid end) as login_seven_day_retention,
    count(distinct case when ab1.ds = date_add(lc.ds, 1) then lc.vplayerid end) as activity_next_day_retention,
    count(distinct case when ab1.ds = date_add(lc.ds, 2) then lc.vplayerid end) as activity_three_day_retention,
    count(distinct case when ab1.ds = date_add(lc.ds, 6) then lc.vplayerid end) as activity_seven_day_retention
from login_cohort lc
left join login_behavior lb1 on lc.vplayerid = lb1.vplayerid
left join activity_behavior ab1 on lc.vplayerid = ab1.vplayerid
group by lc.ds
order by lc.ds;

Traceback (most recent call last):
  File "/home/idg/repos/tgac/code/utils.py", line 204, in execute_sql_with_pymysql
    cursor.execute(sql)
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "Column '`ac`.`vplayerid`' cannot be resolved")
执行SQL语句时发生错误：(1064, "Column '`ac`.`vplayerid`' cannot be resolved")
None
Finished processing sql sql_110 in 48.14965105056763 seconds
{'sql_id': 'sql_110', 'sql': "\nwith login_cohort as (\n    select \n        dtstatdate as ds,\n        vplayerid\n    from dws_jordass_login_di\n    where dtstatdate between '20220413' and '20220421'\n    and platid = 255\n    group by dtstatdate, vplayerid\n),\n\nlogin_behavior as (\n    select \n        dtstatdate as ds,\n        vplayerid\n    from dws_jordass_login_di\n    where dtstatdate between '20220413' and '20220428'\n    and platid = 255\n    group by dtstatdate, vplayerid\n),\n\nactivity_behavior as (\n    select \n        substr(dteventtime, 1, 8) as ds,\n        vplayerid\n    from dwd_jordass_activity_rewardrecord_hi\n    where substr(dteventtime, 1, 8) between '20220413' and '20220428'\n    and actid = 2201123904\n    group by substr(dteventtime, 1, 8), vplayerid\n)\n\nselect \n    lc.ds as stat_date,\n    count(distinct ac.vplayerid) as activity_user_count,\n    count(distinct case when lb1.ds = date_add(lc.ds, 1) then lc.vplayerid end) as login_next_day_retention,\n    count(distinct case when lb1.ds = date_add(lc.ds, 2) then lc.vplayerid end) as login_three_day_retention,\n    count(distinct case when lb1.ds = date_add(lc.ds, 6) then lc.vplayerid end) as login_seven_day_retention,\n    count(distinct case when ab1.ds = date_add(lc.ds, 1) then lc.vplayerid end) as activity_next_day_retention,\n    count(distinct case when ab1.ds = date_add(lc.ds, 2) then lc.vplayerid end) as activity_three_day_retention,\n    count(distinct case when ab1.ds = date_add(lc.ds, 6) then lc.vplayerid end) as activity_seven_day_retention\nfrom login_cohort lc\nleft join login_behavior lb1 on lc.vplayerid = lb1.vplayerid\nleft join activity_behavior ab1 on lc.vplayerid = ab1.vplayerid\ngroup by lc.ds\norder by lc.ds;\n", 'status': 'success', 'result': None}
Starting processing sql sql_111...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dwd_jordass_vsteaminfectlog_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_vsteaminfectlog_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "游戏APPID",\n  `platid` bigint(20) NULL COMMENT "ios 0/android 1",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "用户playerid号",\n  `uid` varchar(65533) NULL COMMENT "角色UID",\n  `battleid` varchar(65533) NULL COMMENT "对局ID",\n  `roundid` bigint(20) NULL COMMENT "回合数",\n  `isescape` bigint(20) NULL COMMENT "是否逃跑",\n  `infectionscore` bigint(20) NULL COMMENT "回合总积分",\n  `infectionscoreasinfected` bigint(20) NULL COMMENT "突变者阵营积分",\n  `infectionscoreashuman` bigint(20) NULL COMMENT "人类阵营积分",\n  `infectlevelupbyitemtimes` bigint(20) NULL COMMENT "突变者强化升级次数",\n  `infectlevelupbykilltimes` bigint(20) NULL COMMENT "突变者淘汰升级次数",\n  `infecttimes` bigint(20) NULL COMMENT "回合感染人类数量",\n  `killsupermantimes` bigint(20) NULL COMMENT "回合击杀超级英雄数量",\n  `isadvancedinfected` bigint(20) NULL COMMENT "是否超级突变者（0，为成为超级突变者、1初始超级突变者、2进化为超级突变者）",\n  `revivaltimes` bigint(20) NULL COMMENT "复活次数",\n  `beensuperman` bigint(20) NULL COMMENT "是否升级为超级英雄（0，未成为超级英雄，1升级为超级突变者）",\n  `supermanleveluptimes` bigint(20) NULL COMMENT "超级战士升级次数",\n  `usesupplytimes` bigint(20) NULL COMMENT "弹药补给次数",\n  `damageoninfect` bigint(20) NULL COMMENT "回合对突变者造成伤害数",\n  `killadvancedinfectedtimes` bigint(20) NULL COMMENT "回合淘汰超级突变者数量",\n  `killinfectedtimes` bigint(20) NULL COMMENT "淘汰突变者次数",\n  `assisttimes` bigint(20) NULL COMMENT "助攻次数",\n  `killwithshootingtimes` bigint(20) NULL COMMENT "枪械击杀数",\n  `killwithmeleetimes` bigint(20) NULL COMMENT "近战击杀数",\n  `headshottimes` bigint(20) NULL COMMENT "爆头数",\n  `wincamp` bigint(20) NULL COMMENT "人类获胜：1，突变者胜利：2",\n  `usefortifiertimes` bigint(20) NULL COMMENT "回合拾取强化剂次数",\n  `changeposxhero` varchar(65533) NULL COMMENT "回合升级为超级英雄的X坐标",\n  `changeposyhero` varchar(65533) NULL COMMENT "回合升级为超级英雄的Y坐标",\n  `changeposzhero` varchar(65533) NULL COMMENT "回合升级为超级英雄的Z坐标",\n  `changetimehero` varchar(65533) NULL COMMENT "回合升级为超级英雄的时间点",\n  `changetypehero` bigint(20) NULL COMMENT "回合升级为超级英雄的类型",\n  `changeposxinfectman` varchar(65533) NULL COMMENT "回合变异为突变者的X坐标",\n  `changeposyinfectman` varchar(65533) NULL COMMENT "回合变异为突变者的Y坐标",\n  `changeposzinfectman` varchar(65533) NULL COMMENT "回合变异为突变者的Z坐标",\n  `changetimeinfectman` varchar(65533) NULL COMMENT "回合变异为突变者的时间点",\n  `changetypeinfectman` bigint(20) NULL COMMENT "回合变异为突变者的类型",\n  `changeposxsuperinfectman` varchar(65533) NULL COMMENT "回合变异为超级突变者的X坐标",\n  `changeposysuperinfectman` varchar(65533) NULL COMMENT "回合变异为超级突变者的Y坐标",\n  `changeposzsuperinfectman` varchar(65533) NULL COMMENT "回合变异为超级突变者的Z坐标",\n  `changetimesuperinfectman` varchar(65533) NULL COMMENT "回合变异为超级突变者的时间点",\n  `changetypesuperinfectman` bigint(20) NULL COMMENT "回合变异为超级突变者的类型",\n  `totalragehuman` bigint(20) NULL COMMENT "本回合获取怒气值总值（人类）",\n  `totalragesuperman` bigint(20) NULL COMMENT "本回合获取怒气值总值（强能猎手）",\n  `totalrageinfectedman` bigint(20) NULL COMMENT "本回合获取怒气值总值（普通突变者）",\n  `totalrageadvinfectedman` bigint(20) NULL COMMENT "本回合获取怒气值总值（高级突变者）",\n  `totalinfect02passiveskill` bigint(20) NULL COMMENT "本回合小紫皮—疾行技能使用次数",\n  `totalinfect01passiveskill` bigint(20) NULL COMMENT "本回合大紫皮—护盾技能使用次数",\n  `totalinfect01passiveskillcaldamage` varchar(65533) NULL COMMENT "本回合大紫皮—护盾技能吸收伤害总值",\n  `totalhookskilluse` bigint(20) NULL COMMENT "本回合狂爪——钩爪技能使用次数",\n  `totalhookcapture` bigint(20) NULL COMMENT "本回合狂爪——钩爪技能命中次数",\n  `totalhooktakedamage` varchar(65533) NULL COMMENT "本回合狂爪——本回合钩爪损失血量总值",\n  `totalhookbroken` bigint(20) NULL COMMENT "本回合狂爪——本回合钩爪被打坏次数",\n  `totalinvisibleskilluse` bigint(20) NULL COMMENT "本回合魅影——隐身技能使用次数",\n  `totalvisibletakedamage` varchar(65533) NULL COMMENT "本回合本回合魅影——本回合非隐身状态损失总血量",\n  `totalvisibletime` bigint(20) NULL COMMENT "本回合魅影——本回合非隐身状态身总时长",\n  `totalinvisibletakedamage` varchar(65533) NULL COMMENT "本回合魅影——本回合隐身状态损失总血量",\n  `totalinvisibletime` bigint(20) NULL COMMENT "本回合魅影——本回合隐身状态总时长",\n  `totalfrozengrenadeskilluse` bigint(20) NULL COMMENT "本回合冰霜领主——冰霜炸弹使用次数",\n  `totalfronzengrenadeattackcount` bigint(20) NULL COMMENT "本回合冰霜领主——冰霜炸弹命中次数",\n  `totalfrozenplayercount` bigint(20) NULL COMMENT "本回合冰霜领主——冰霜炸弹冰冻玩家次数",\n  `totaldragonbreathskilluse` bigint(20) NULL COMMENT "本回合龙焰猎手——龙息弹使用次数",\n  `totaldragonbreathattackcount` bigint(20) NULL COMMENT "本回合龙焰猎手——龙息弹命中次数",\n  `totaldmghuman` varchar(65533) NULL COMMENT "本回合普通人类造成伤害总值",\n  `totaldmgdragonsuperman` varchar(65533) NULL COMMENT "本回合龙焰猎手造成伤害总值",\n  `totaldmgpowersuperman` varchar(65533) NULL COMMENT "本回合强能猎手造成伤害总值",\n  `totaldmgspeedinfected` varchar(65533) NULL COMMENT "本回合速行战士造成伤害总值--疾行",\n  `totaldmginvisinfected` varchar(65533) NULL COMMENT "本回合隐形战士造成伤害总值--魅影",\n  `totaldmghookinfected` varchar(65533) NULL COMMENT "本回合钩链战士造成伤害总值--狂爪",\n  `totaldmgpoweradvinfected` varchar(65533) NULL COMMENT "本回合强化战士造成伤害总值--强化",\n  `totaldmgfrozenadvinfected` varchar(65533) NULL COMMENT "本回合冰霜领主造成伤害总值--冰霜领主",\n  `swiftmorphinfo` varchar(65533) NULL COMMENT "变身速行战士：变身时间+变身类型+坐标x+坐标y+坐标z",\n  `stealthmorphinfo` varchar(65533) NULL COMMENT "变身隐形战士：变身时间+变身类型+坐标x+坐标y+坐标z",\n  `grapplemorphinfo` varchar(65533) NULL COMMENT "变身钩链战士：变身时间+变身类型+坐标x+坐标y+坐标z",\n  `poweradvmorphinfo` varchar(65533) NULL COMMENT "变身强化战士（原大胖子）：变身时间+变身类型+坐标x+坐标y+坐标z",\n  `iceadvmorphinfo` varchar(65533) NULL COMMENT "变身冰霜领主：变身时间+变身类型+坐标x+坐标y+坐标z",\n  `heromorphinfo` varchar(65533) NULL COMMENT "变身强能猎手：变身时间+变身类型+坐标x+坐标y+坐标z",\n  `dragonheromorphinfo` varchar(65533) NULL COMMENT "变身龙焰猎手：变身时间+变身类型+坐标x+坐标y+坐标z",\n  `fakerinfectedchangeinfo` varchar(65533) NULL COMMENT "FakerInfectedChangeInfo ",\n  `forgingironinfectedchangeinfo` varchar(65533) NULL COMMENT "ForgingIronInfectedChangeInfo ",\n  `enchantingbutterflyinfectedchangeinfo` varchar(65533) NULL COMMENT "EnchantingButterflyInfectedChangeInfo ",\n  `ironfistinfectedchangeinfo` varchar(65533) NULL COMMENT "IronFistInfectedChangeInfo ",\n  `phoenixsupermanchangeinfo` varchar(65533) NULL COMMENT "PhoenixSupermanChangeInfo ",\n  `titansupermanchangeinfo` varchar(65533) NULL COMMENT "TitanSupermanChangeInfo ",\n  `humanadditionevolution` varchar(65533) NULL COMMENT "HumanAdditionEvolution ",\n  `supermanadditionevolution` varchar(65533) NULL COMMENT "SupermanAdditionEvolution ",\n  `infectedmanadditionevolution` varchar(65533) NULL COMMENT "InfectedManAdditionEvolution ",\n  `humanadditionevolutionbyitemtimes` varchar(65533) NULL COMMENT "HumanAdditionEvolutionByItemTimes ",\n  `usehumanfortifiertimes` bigint(20) NULL COMMENT "UseHumanFortifierTimes ",\n  `totalfibuildboxcount` bigint(20) NULL COMMENT "TotalFIBuildBoxCount ",\n  `totalfiboxdestroyedcount` bigint(20) NULL COMMENT "TotalFIBoxDestroyedCount ",\n  `totalfakerdisguiseusecount` bigint(20) NULL COMMENT "TotalFakerDisguiseUseCount ",\n  `totalfakerdeadinhumanstate` bigint(20) NULL COMMENT "TotalFakerDeadInHumanState ",\n  `totalfakerdeadinmonsterstate` bigint(20) NULL COMMENT "TotalFakerDeadInMonsterState ",\n  `totalpowersupermanskilluse` bigint(20) NULL COMMENT "TotalPowerSupermanSkillUse ",\n  `totalpowersupermanhitcount` bigint(20) NULL COMMENT "TotalPowerSupermanHitCount ",\n  `totalpowersupermandamage` varchar(65533) NULL COMMENT "TotalPowerSupermanDamage ",\n  `totalphoenixfireringusecount` bigint(20) NULL COMMENT "TotalPhoenixFireRingUseCount ",\n  `totalphoenixfireringdamage` varchar(65533) NULL COMMENT "TotalPhoenixFireRingDamage ",\n  `totalphoenixfireringhealth` varchar(65533) NULL COMMENT "TotalPhoenixFireRingHealth ",\n  `totaltitanjumpsmathusecount` bigint(20) NULL COMMENT "TotalTitanJumpSmathUseCount ",\n  `totaltitanjumpsmathhitcount` bigint(20) NULL COMMENT "TotalTitanJumpSmathHitCount ",\n  `totaltitanjumpsmathdamage` varchar(65533) NULL COMMENT "TotalTitanJumpSmathDamage ",\n  `totalebskilluse` bigint(20) NULL COMMENT "TotalEBSkillUse ",\n  `totalebhitcount` bigint(20) NULL COMMENT "TotalEBHitCount ",\n  `totalebinfectcount` bigint(20) NULL COMMENT "TotalEBInfectCount ",\n  `totalironfistchargeusecount` bigint(20) NULL COMMENT "TotalIronFistChargeUseCount ",\n  `totalironfistchargedamagereduce` varchar(65533) NULL COMMENT "TotalIronFistChargeDamageReduce ",\n  `totalironfistchargehitcount` bigint(20) NULL COMMENT "TotalIronFistChargeHitCount ",\n  `totalironfistchargedamage` varchar(65533) NULL COMMENT "TotalIronFistChargeDamage ",\n  `totaldmgforgingironinfected` varchar(65533) NULL COMMENT "TotalDMGForgingIronInfected ",\n  `totaldmgfakerinfected` varchar(65533) NULL COMMENT "TotalDMGFakerInfected ",\n  `totaldmgphoenixsuperman` varchar(65533) NULL COMMENT "TotalDMGPhoenixSuperman ",\n  `totaldmgtitansuperman` varchar(65533) NULL COMMENT "TotalDMGTitanSuperman ",\n  `totaldmgenchantingbutterflyinfected` varchar(65533) NULL COMMENT "TotalDMGEnchantingButterflyInfected ",\n  `totaldmgironfistinfected` varchar(65533) NULL COMMENT "TotalDMGIronFistInfected ",\n  `roundusedcountforgingironinfected` bigint(20) NULL COMMENT "RoundUsedCountForgingIronInfected ",\n  `roundusedcountfakerinfected` bigint(20) NULL COMMENT "RoundUsedCountFakerInfected ",\n  `roundusedcountphoenixsuperman` bigint(20) NULL COMMENT "RoundUsedCountPhoenixSuperman ",\n  `roundusedcounttitansuperman` bigint(20) NULL COMMENT "RoundUsedCountTitanSuperman ",\n  `roundusedcountenchantingbutterflyinfected` bigint(20) NULL COMMENT "RoundUsedCountEnchantingButterflyInfected ",\n  `roundusedcountironfistinfected` bigint(20) NULL COMMENT "RoundUsedCountIronFistInfected ",\n  `roundusedcountspeedinfected` bigint(20) NULL COMMENT "RoundUsedCountSpeedInfected ",\n  `roundusedcounthookinfected` bigint(20) NULL COMMENT "RoundUsedCountHookInfected ",\n  `roundusedcountinvisinfected` bigint(20) NULL COMMENT "RoundUsedCountInvisInfected ",\n  `roundusedcountpoweradvinfected` bigint(20) NULL COMMENT "RoundUsedCountPowerAdvInfected ",\n  `roundusedcountfrozenadvinfected` bigint(20) NULL COMMENT "RoundUsedCountFrozenAdvInfected ",\n  `roundusedcountpowersuperman` bigint(20) NULL COMMENT "RoundUsedCountPowerSuperman ",\n  `roundusedcountdragonsuperman` bigint(20) NULL COMMENT "RoundUsedCountDragonSuperman ",\n  `roundselectcamptype` bigint(20) NULL COMMENT "RoundSelectCampType ",\n  `roundrandomcamptype` bigint(20) NULL COMMENT "RoundRandomCampType ",\n  `roundendcamptype` bigint(20) NULL COMMENT "RoundEndCampType ",\n  `roundwinstate` bigint(20) NULL COMMENT "RoundWinState "\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dwd_jordass_vsteaminfectlog_hi.tdbank_imp_date, dwd_jordass_vsteaminfectlog_hi.swiftmorphinfo, dwd_jordass_vsteaminfectlog_hi.stealthmorphinfo, dwd_jordass_vsteaminfectlog_hi.grapplemorphinfo, dwd_jordass_vsteaminfectlog_hi.heromorphinfo, dwd_jordass_vsteaminfectlog_hi.iceadvmorphinfo, dwd_jordass_vsteaminfectlog_hi.poweradvmorphinfo, dwd_jordass_vsteaminfectlog_hi.dragonheromorphinfo, dwd_jordass_vsteaminfectlog_hi.changeposxhero, dwd_jordass_vsteaminfectlog_hi.changeposyhero, dwd_jordass_vsteaminfectlog_hi.changeposzhero, 20220425]
Selected goldensql references: [35, 28, 34]
classification_result: {'sub_questions': '对于变身速行战士，如何解析坐标并统计次数？", "对于变身隐形战士，如何解析坐标并统计次数？", "对于变身钩链战士，如何解析坐标并统计次数？", "对于变身强能猎手，如何解析坐标并统计次数？", "对于变身冰霜领主，如何解析坐标并统计次数？", "对于变身强化战士，如何解析坐标并统计次数？", "对于变身龙焰猎手，如何解析坐标并统计次数？', 'flag': 'NESTED'}
sql: 
SELECT 
    tdbank_imp_date AS stat_date,
    '变身速行战士' AS type,
    ROUND(CAST(SPLIT_PART(swiftmorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,
    ROUND(CAST(SPLIT_PART(swiftmorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,
    ROUND(CAST(SPLIT_PART(swiftmorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,
    COUNT(*) AS count
FROM dwd_jordass_vsteaminfectlog_hi
WHERE tdbank_imp_date = '20220425' AND swiftmorphinfo IS NOT NULL
GROUP BY tdbank_imp_date, x, y, z

UNION ALL

SELECT 
    tdbank_imp_date AS stat_date,
    '变身隐形战士' AS type,
    ROUND(CAST(SPLIT_PART(stealthmorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,
    ROUND(CAST(SPLIT_PART(stealthmorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,
    ROUND(CAST(SPLIT_PART(stealthmorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,
    COUNT(*) AS count
FROM dwd_jordass_vsteaminfectlog_hi
WHERE tdbank_imp_date = '20220425' AND stealthmorphinfo IS NOT NULL
GROUP BY tdbank_imp_date, x, y, z

UNION ALL

SELECT 
    tdbank_imp_date AS stat_date,
    '变身钩链战士' AS type,
    ROUND(CAST(SPLIT_PART(grapplemorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,
    ROUND(CAST(SPLIT_PART(grapplemorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,
    ROUND(CAST(SPLIT_PART(grapplemorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,
    COUNT(*) AS count
FROM dwd_jordass_vsteaminfectlog_hi
WHERE tdbank_imp_date = '20220425' AND grapplemorphinfo IS NOT NULL
GROUP BY tdbank_imp_date, x, y, z

UNION ALL

SELECT 
    tdbank_imp_date AS stat_date,
    '变身强能猎手' AS type,
    ROUND(CAST(changeposxhero AS DECIMAL(10,1)), 1) AS x,
    ROUND(CAST(changeposyhero AS DECIMAL(10,1)), 1) AS y,
    ROUND(CAST(changeposzhero AS DECIMAL(10,1)), 1) AS z,
    COUNT(*) AS count
FROM dwd_jordass_vsteaminfectlog_hi
WHERE tdbank_imp_date = '20220425' AND heromorphinfo IS NOT NULL
GROUP BY tdbank_imp_date, x, y, z

UNION ALL

SELECT 
    tdbank_imp_date AS stat_date,
    '变身冰霜领主' AS type,
    ROUND(CAST(SPLIT_PART(iceadvmorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,
    ROUND(CAST(SPLIT_PART(iceadvmorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,
    ROUND(CAST(SPLIT_PART(iceadvmorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,
    COUNT(*) AS count
FROM dwd_jordass_vsteaminfectlog_hi
WHERE tdbank_imp_date = '20220425' AND iceadvmorphinfo IS NOT NULL
GROUP BY tdbank_imp_date, x, y, z

UNION ALL

SELECT 
    tdbank_imp_date AS stat_date,
    '变身强化战士' AS type,
    ROUND(CAST(SPLIT_PART(poweradvmorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,
    ROUND(CAST(SPLIT_PART(poweradvmorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,
    ROUND(CAST(SPLIT_PART(poweradvmorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,
    COUNT(*) AS count
FROM dwd_jordass_vsteaminfectlog_hi
WHERE tdbank_imp_date = '20220425' AND poweradvmorphinfo IS NOT NULL
GROUP BY tdbank_imp_date, x, y, z

UNION ALL

SELECT 
    tdbank_imp_date AS stat_date,
    '变身龙焰猎手' AS type,
    ROUND(CAST(SPLIT_PART(dragonheromorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,
    ROUND(CAST(SPLIT_PART(dragonheromorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,
    ROUND(CAST(SPLIT_PART(dragonheromorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,
    COUNT(*) AS count
FROM dwd_jordass_vsteaminfectlog_hi
WHERE tdbank_imp_date = '20220425' AND dragonheromorphinfo IS NOT NULL
GROUP BY tdbank_imp_date, x, y, z;

[]
Finished processing sql sql_111 in 75.15204787254333 seconds
{'sql_id': 'sql_111', 'sql': "\nSELECT \n    tdbank_imp_date AS stat_date,\n    '变身速行战士' AS type,\n    ROUND(CAST(SPLIT_PART(swiftmorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,\n    ROUND(CAST(SPLIT_PART(swiftmorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,\n    ROUND(CAST(SPLIT_PART(swiftmorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,\n    COUNT(*) AS count\nFROM dwd_jordass_vsteaminfectlog_hi\nWHERE tdbank_imp_date = '20220425' AND swiftmorphinfo IS NOT NULL\nGROUP BY tdbank_imp_date, x, y, z\n\nUNION ALL\n\nSELECT \n    tdbank_imp_date AS stat_date,\n    '变身隐形战士' AS type,\n    ROUND(CAST(SPLIT_PART(stealthmorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,\n    ROUND(CAST(SPLIT_PART(stealthmorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,\n    ROUND(CAST(SPLIT_PART(stealthmorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,\n    COUNT(*) AS count\nFROM dwd_jordass_vsteaminfectlog_hi\nWHERE tdbank_imp_date = '20220425' AND stealthmorphinfo IS NOT NULL\nGROUP BY tdbank_imp_date, x, y, z\n\nUNION ALL\n\nSELECT \n    tdbank_imp_date AS stat_date,\n    '变身钩链战士' AS type,\n    ROUND(CAST(SPLIT_PART(grapplemorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,\n    ROUND(CAST(SPLIT_PART(grapplemorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,\n    ROUND(CAST(SPLIT_PART(grapplemorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,\n    COUNT(*) AS count\nFROM dwd_jordass_vsteaminfectlog_hi\nWHERE tdbank_imp_date = '20220425' AND grapplemorphinfo IS NOT NULL\nGROUP BY tdbank_imp_date, x, y, z\n\nUNION ALL\n\nSELECT \n    tdbank_imp_date AS stat_date,\n    '变身强能猎手' AS type,\n    ROUND(CAST(changeposxhero AS DECIMAL(10,1)), 1) AS x,\n    ROUND(CAST(changeposyhero AS DECIMAL(10,1)), 1) AS y,\n    ROUND(CAST(changeposzhero AS DECIMAL(10,1)), 1) AS z,\n    COUNT(*) AS count\nFROM dwd_jordass_vsteaminfectlog_hi\nWHERE tdbank_imp_date = '20220425' AND heromorphinfo IS NOT NULL\nGROUP BY tdbank_imp_date, x, y, z\n\nUNION ALL\n\nSELECT \n    tdbank_imp_date AS stat_date,\n    '变身冰霜领主' AS type,\n    ROUND(CAST(SPLIT_PART(iceadvmorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,\n    ROUND(CAST(SPLIT_PART(iceadvmorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,\n    ROUND(CAST(SPLIT_PART(iceadvmorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,\n    COUNT(*) AS count\nFROM dwd_jordass_vsteaminfectlog_hi\nWHERE tdbank_imp_date = '20220425' AND iceadvmorphinfo IS NOT NULL\nGROUP BY tdbank_imp_date, x, y, z\n\nUNION ALL\n\nSELECT \n    tdbank_imp_date AS stat_date,\n    '变身强化战士' AS type,\n    ROUND(CAST(SPLIT_PART(poweradvmorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,\n    ROUND(CAST(SPLIT_PART(poweradvmorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,\n    ROUND(CAST(SPLIT_PART(poweradvmorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,\n    COUNT(*) AS count\nFROM dwd_jordass_vsteaminfectlog_hi\nWHERE tdbank_imp_date = '20220425' AND poweradvmorphinfo IS NOT NULL\nGROUP BY tdbank_imp_date, x, y, z\n\nUNION ALL\n\nSELECT \n    tdbank_imp_date AS stat_date,\n    '变身龙焰猎手' AS type,\n    ROUND(CAST(SPLIT_PART(dragonheromorphinfo, '+', 4) AS DECIMAL(10,1)), 1) AS x,\n    ROUND(CAST(SPLIT_PART(dragonheromorphinfo, '+', 5) AS DECIMAL(10,1)), 1) AS y,\n    ROUND(CAST(SPLIT_PART(dragonheromorphinfo, '+', 6) AS DECIMAL(10,1)), 1) AS z,\n    COUNT(*) AS count\nFROM dwd_jordass_vsteaminfectlog_hi\nWHERE tdbank_imp_date = '20220425' AND dragonheromorphinfo IS NOT NULL\nGROUP BY tdbank_imp_date, x, y, z;\n", 'status': 'success', 'result': []}
Starting processing sql sql_112...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dwd_jordass_roundflow_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_roundflow_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "小时分区字段，格式YYYYMMDDHH",\n  `gamesvrid` varchar(65533) NULL COMMENT "登录的游戏服务器编号",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家",\n  `uid` varchar(65533) NULL COMMENT "玩家UID",\n  `battleid` varchar(65533) NULL COMMENT "对局ID",\n  `battletype` bigint(20) NULL COMMENT "战斗类型对应BATTLETYPE,其它说明参考FAQ文档",\n  `roundscore` bigint(20) NULL COMMENT "本局分数,无得分的填0",\n  `roundtime` bigint(20) NULL COMMENT "对局时长(秒)",\n  `result` bigint(20) NULL COMMENT "单局结果，参考 Result",\n  `gold` bigint(20) NULL COMMENT "金钱变化值",\n  `level` bigint(20) NULL COMMENT "等级变化值",\n  `seasonid` bigint(20) NULL COMMENT "所属赛季ID",\n  `mode` bigint(20) NULL COMMENT "101：传统模式第三人称单排\t102：传统模式第三人称双排\t103：传统模式第三人称四排\t401：传统模式第一人称单排\t402：传统模式第一人称双排\t403：传统模式第一人称四排\t603：创意创作间计分模式第三人称四排(含极能形态模式、极限追猎、特种作战等子模式)",\n  `submode` bigint(20) NULL COMMENT "子模式",\n  `map` bigint(20) NULL COMMENT "地图",\n  `weather` bigint(20) NULL COMMENT "天气",\n  `startime` bigint(20) NULL COMMENT "开局时刻",\n  `endtime` bigint(20) NULL COMMENT "结束时刻",\n  `playernumber` bigint(20) NULL COMMENT "玩家数",\n  `realplayernumber` bigint(20) NULL COMMENT "真人玩家数",\n  `teamnumber` bigint(20) NULL COMMENT "小队数",\n  `teammemberlist` varchar(65533) NULL COMMENT "队友id解析字段teammemberlist步骤：\t使用lateral VIEW explode(split(teammemberlist,\'\\\\+\')) adTable AS buttontype 函数通过 \\\\+截取进行行转列进行计算。",\n  `escapecheckup` bigint(20) NULL COMMENT "是否逃跑",\n  `totalchangedpointvalue` bigint(20) NULL COMMENT "综合积分变化值",\n  `changedratingvalue` bigint(20) NULL COMMENT "rating分变化值",\n  `ratingvalueallianceforceterchanged` bigint(20) NULL COMMENT "rating分变化后的值",\n  `changedkillratingvalue` bigint(20) NULL COMMENT "kill rating分变化值",\n  `killratingvalueallianceforceterchanged` bigint(20) NULL COMMENT "kill rating分变化后的值",\n  `changedwinratingvalue` bigint(20) NULL COMMENT "win rating分变化值",\n  `winratingvalueallianceforceterchanged` bigint(20) NULL COMMENT "win rating分变化后的值",\n  `playergetexperience` bigint(20) NULL COMMENT "玩家获得的经验值",\n  `currentroundrank` bigint(20) NULL COMMENT "当局名次",\n  `killingcount` bigint(20) NULL COMMENT "击杀",\n  `assistcount` bigint(20) NULL COMMENT "助攻次数",\n  `survivaltime` bigint(20) NULL COMMENT "存活总时间(秒)",\n  `damageamount` bigint(20) NULL COMMENT "总伤害量,浮点数，乘以100存入",\n  `healtimes` bigint(20) NULL COMMENT "救人次数",\n  `healamount` bigint(20) NULL COMMENT "治疗量，浮点数，乘以100存入",\n  `movingdistance` bigint(20) NULL COMMENT "前进距离，单位米",\n  `dyingflow` varchar(65533) NULL COMMENT "濒死流水，暂无",\n  `deadflow` varchar(65533) NULL COMMENT "死亡流水 死亡坐标/死亡类型/死亡时间",\n  `headshotcounts` bigint(20) NULL COMMENT "爆头数",\n  `gunkillingtimes` bigint(20) NULL COMMENT "枪械击杀数，暂无",\n  `meleekilltimes` bigint(20) NULL COMMENT "近战击杀数，暂无",\n  `rangeddamagedamount` bigint(20) NULL COMMENT "远程武器伤害量，暂无",\n  `meleedamageamount` bigint(20) NULL COMMENT "近战伤害量，暂无",\n  `obtianeditemflow` bigint(20) NULL COMMENT "获得的物品流水，暂无",\n  `obtianedairdroptimes` bigint(20) NULL COMMENT "获得空投次数",\n  `vehicledestoryedtimes` bigint(20) NULL COMMENT "摧毁载具次数",\n  `landingcoordinate` bigint(20) NULL COMMENT "落地点坐标,弃用，之前定义的类型是int，应该是字符串",\n  `killingflow` varchar(65533) NULL COMMENT "击杀流水 :击杀目标ID\t击杀类型\t是否爆头\t击杀距离\t使用的武器ID\t击杀者（角色自己）位置  新增：\t被击杀者位置\t击杀时间（从进入小岛开始到击杀时的毫秒数）\t造成伤害量\t是否移动\t击杀区域ID(-1表示区域表中不记录)\t状态(1:卧倒)\t被击倒的武器id\t击杀圈数\t被击杀者名字\t是否灭队\t是否为ai\tAI的类型\t击倒者uid\t击杀者uid",\n  `creepingtime` bigint(20) NULL COMMENT "匍匐时间",\n  `swimmingtime` bigint(20) NULL COMMENT "游泳时间，暂无",\n  `divingtime` bigint(20) NULL COMMENT "潜水时间，暂无",\n  `drivingtime` bigint(20) NULL COMMENT "驾驶载具时间",\n  `ridingtime` bigint(20) NULL COMMENT "乘坐载具时间，暂无",\n  `walkingdistance` bigint(20) NULL COMMENT "步行距离，单位米",\n  `staytimeinpoisonedarea` bigint(20) NULL COMMENT "吃毒时间",\n  `damageindex` bigint(20) NULL COMMENT "击杀指数,乘100后四舍五入",\n  `luckyindex` bigint(20) NULL COMMENT "幸运指数，弃用无效",\n  `collectindex` bigint(20) NULL COMMENT "物资指数,乘100后四舍五入",\n  `survivalindex` bigint(20) NULL COMMENT "生存指数,乘100后四舍五入",\n  `movingindex` bigint(20) NULL COMMENT "前进指数，弃用无效",\n  `creepindex` bigint(20) NULL COMMENT "伏地指数，弃用无效",\n  `accuracyindex` bigint(20) NULL COMMENT "精准指数，弃用无效",\n  `deliveryindex` bigint(20) NULL COMMENT "快递指数，弃用无效",\n  `sneakattackindex` bigint(20) NULL COMMENT "偷袭指数，弃用无效",\n  `healindex` bigint(20) NULL COMMENT "支援指数,乘100后四舍五入",\n  `boxindex` bigint(20) NULL COMMENT "盒子指数，弃用无效",\n  `assaultindex` bigint(20) NULL COMMENT "伤害指数,乘100后四舍五入",\n  `totalpoint` bigint(20) NULL COMMENT "综合积分变化后的值",\n  `ratinglevel` bigint(20) NULL COMMENT "流水评价等级",\n  `titleidlist` varchar(65533) NULL COMMENT "当局获得的称号Id",\n  `itemuseflow` varchar(65533) NULL COMMENT "装备的物品流水",\n  `medicineuseflow` varchar(65533) NULL COMMENT "使用的药品流水",\n  `gunhittimes` bigint(20) NULL COMMENT "枪械命中次数",\n  `gunshottimes` bigint(20) NULL COMMENT "枪械射击次数",\n  `teamrank` bigint(20) NULL COMMENT "队伍名次",\n  `curecount` bigint(20) NULL COMMENT "治疗次数",\n  `drivingdistance` bigint(20) NULL COMMENT "行驶距离，单位米",\n  `totalscorerank` bigint(20) NULL COMMENT "综合评分排名，弃用无效",\n  `rating` bigint(20) NULL COMMENT "鸡分",\n  `killrating` bigint(20) NULL COMMENT "消灭鸡分",\n  `winrating` bigint(20) NULL COMMENT "排名鸡分",\n  `ratingrank` bigint(20) NULL COMMENT "鸡分排名，弃用无效",\n  `killingratingrank` bigint(20) NULL COMMENT "消灭鸡分排名，弃用无效",\n  `winratingrank` bigint(20) NULL COMMENT "排名鸡分排名，弃用无效",\n  `totalround` bigint(20) NULL COMMENT "赛季分人称几排总场数",\n  `totalkill` bigint(20) NULL COMMENT "赛季分人称几排总杀敌数",\n  `totalwin` bigint(20) NULL COMMENT "赛季分人称几排总胜利数",\n  `top10times` bigint(20) NULL COMMENT "前十数",\n  `totalheadshotrate` bigint(20) NULL COMMENT "赛季分人称几排总爆头率",\n  `averagesurvivaltimeperround` bigint(20) NULL COMMENT "场均存活时间",\n  `healfriendtimes` bigint(20) NULL COMMENT "救助队友次数",\n  `averagemovedistanceperround` bigint(20) NULL COMMENT "场均移动距离",\n  `maxdamageinoneround` bigint(20) NULL COMMENT "单局最高伤害",\n  `maxkillinginoneround` bigint(20) NULL COMMENT "单局最高击杀",\n  `maxsurvivaltime` bigint(20) NULL COMMENT "最长存活时间",\n  `maxmovingdistance` bigint(20) NULL COMMENT "最长移动距离",\n  `contributionrankrating` bigint(20) NULL COMMENT "单排总积分贡献分",\n  `contributionkillrating` bigint(20) NULL COMMENT "单排击败积分贡献分",\n  `contributionwinrating` bigint(20) NULL COMMENT "单排生存积分贡献分",\n  `oldsegmentlevel` bigint(20) NULL COMMENT "旧段位",\n  `newsegmentlevel` bigint(20) NULL COMMENT "新段位",\n  `teamid` bigint(20) NULL COMMENT "小队ID",\n  `landlocation` varchar(65533) NULL COMMENT "落地点坐标,有效字段,单位cm",\n  `totaldeadtimes` bigint(20) NULL COMMENT "赛季分人称几排总死亡数",\n  `sumscore` bigint(20) NULL COMMENT "流水总评分，乘以100后存入",\n  `seasonsurvivalindex` bigint(20) NULL COMMENT "赛季参赛指数",\n  `seasontop1index` bigint(20) NULL COMMENT "赛季获胜率指数",\n  `seasonratingindex` bigint(20) NULL COMMENT "赛季总积分指数",\n  `seasonassaultindex` bigint(20) NULL COMMENT "赛季竞赛指数",\n  `seasonhealindex` bigint(20) NULL COMMENT "赛季支援指数",\n  `seasonmovingindex` bigint(20) NULL COMMENT "赛季前进指数",\n  `seasonsumscore` bigint(20) NULL COMMENT "赛季总评分，乘以100后存入",\n  `seasonratinglevel` bigint(20) NULL COMMENT "赛季评价等级",\n  `modesurvivalindex` bigint(20) NULL COMMENT "当前模式参赛指数",\n  `modetop1index` bigint(20) NULL COMMENT "当前模式获胜率指数",\n  `moderatingindex` bigint(20) NULL COMMENT "当前模式总积分指数",\n  `modeassaultindex` bigint(20) NULL COMMENT "当前模式竞赛指数",\n  `modehealindex` bigint(20) NULL COMMENT "当前模式支援指数",\n  `modemovingindex` bigint(20) NULL COMMENT "当前模式前进指数",\n  `modesumscore` bigint(20) NULL COMMENT "当前模式总评分，乘以100后存入",\n  `moderatinglevel` bigint(20) NULL COMMENT "当前模式评价等级",\n  `flowratinglevel` varchar(65533) NULL COMMENT "当局游戏的评价等级，前面有个Int类型的，但是非要求加一个字符串类型的",\n  `rolename` varchar(65533) NULL COMMENT "玩家角色名",\n  `totaldamage` bigint(20) NULL COMMENT "赛季分人称几排总伤害量",\n  `totalheal` bigint(20) NULL COMMENT "赛季分人称几排总治疗量",\n  `matchtype` bigint(20) NULL COMMENT "匹配模式0：手机 1模拟器 8小黑屋 9新手局",\n  `duocontributionrankrating` bigint(20) NULL COMMENT "双人总积分贡献分",\n  `duocontributionkillrating` bigint(20) NULL COMMENT "双人击败积分贡献分",\n  `duocontributionwinrating` bigint(20) NULL COMMENT "双人生存积分贡献分",\n  `squadcontributionrankrating` bigint(20) NULL COMMENT "四人总积分贡献分",\n  `squadcontributionkillrating` bigint(20) NULL COMMENT "四人击败积分贡献分",\n  `squadcontributionwinrating` bigint(20) NULL COMMENT "四人生存积分贡献分",\n  `famousid` bigint(20) NULL COMMENT "名人名言tips ID",\n  `dsendtime` varchar(65533) NULL COMMENT "新结束时间字段，ds传过来的字符串",\n  `equipmentinfo` varchar(65533) NULL COMMENT "装备信息:头盔ID\t防弹衣ID\t背包ID\t主武器1ID\t主武器1配件ID列表(以,分隔)\t主武器2ID\t主武器2配件ID列表(以,分隔)\t副武器ID\t副武器配件ID列表(以,分隔)\t近战武器ID\t投掷武器ID\t是否佩戴吉利服",\n  `segmentprotect` bigint(20) NULL COMMENT "段位保护标记，1为触发了该段位的段位保护，0为没有触发",\n  `ismvp` bigint(20) NULL COMMENT "不是mvp 0/是mvp 1",\n  `pronetime` bigint(20) NULL COMMENT "趴地时间",\n  `followstate` bigint(20) NULL COMMENT "跳伞跟随  0不跟随，也不被跟随；1是被跟随；2是跟随",\n  `touchdownareaid` bigint(20) NULL COMMENT "降落地点类型, 参见赛季任务降落地点类型表",\n  `getpropsnumfromteammates` bigint(20) NULL COMMENT "接受队友道具数",\n  `sendpropsnumtoteammates` bigint(20) NULL COMMENT "赠送队友道具数",\n  `starttorescuetimes` bigint(20) NULL COMMENT "开始救援次数",\n  `avatargamegender` bigint(20) NULL COMMENT "Avatar性别",\n  `avatarhairid` bigint(20) NULL COMMENT "Avatar发型",\n  `avatarheadid` bigint(20) NULL COMMENT "Avatar脸型",\n  `avatarfeaturenum` bigint(20) NULL COMMENT "Avatar时装个数",\n  `avatarfeaturelist_1` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_2` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_3` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_4` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_5` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_6` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_7` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_8` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_9` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarfeaturelist_10` bigint(20) NULL COMMENT "Avatar时装",\n  `avatarweaponid` bigint(20) NULL COMMENT "Avatar枪械",\n  `avatarweaponskinid` bigint(20) NULL COMMENT "Avatar枪械皮肤",\n  `killeruid` varchar(65533) NULL COMMENT "击杀者UID",\n  `killerweaponid` bigint(20) NULL COMMENT "击杀者使用武器ID",\n  `killerdistance` bigint(20) NULL COMMENT "击杀者距离",\n  `lobbyteamid` varchar(65533) NULL COMMENT "大厅队伍id,ug字段，兼容保留",\n  `makefiresnum` bigint(20) NULL COMMENT "生火成功次数,极寒模式",\n  `isregress` bigint(20) NULL COMMENT "是否回流",\n  `topxtipsresponse` bigint(20) NULL COMMENT "未进入前5:-1;不点击:0;继续战斗:1;退出竞赛:2",\n  `signalhealamount` bigint(20) NULL COMMENT "信号治疗量",\n  `drivinghelicoptertime` bigint(20) NULL COMMENT "驾驶直升飞机时间",\n  `inhelicoptertime` bigint(20) NULL COMMENT "乘坐直升飞机时间",\n  `noreductratingscore` bigint(20) NULL COMMENT "是否触发了不掉分活动",\n  `changedtrueratingvalue` bigint(20) NULL COMMENT "true rating分变化值",\n  `trueratingvalueallianceforceterchanged` bigint(20) NULL COMMENT "true rating分变化后的值",\n  `teammemberrelalist` varchar(65533) NULL COMMENT "与TeamMemberList相对应，与其他队员之间的好友关系（0非好友，1平台好友，2为游戏好友）拼接，多个好友之间用+拼接。例如1+2+2",\n  `teammembersexlist` varchar(65533) NULL COMMENT "与TeamMemberList相对应，其他队员的性别拼接（1表示男，2表示女），多个好友之间用+拼接。例如1+2+2",\n  `friendcount` bigint(20) NULL COMMENT "队友中的好友数量",\n  `maxhurtweaponid` bigint(20) NULL COMMENT "最大伤害的武器ID",\n  `maxdamage` bigint(20) NULL COMMENT "武器的最大伤害",\n  `allianceforceterlevel` bigint(20) NULL COMMENT "结算后等级",\n  `isobexit` bigint(20) NULL COMMENT "是否观战退出",\n  `noreductrating` bigint(20) NULL COMMENT "是否触发不掉分活动",\n  `extraaddrating` bigint(20) NULL COMMENT "是否触发首战加分活动",\n  `protectrating` bigint(20) NULL COMMENT "是否触发保分机制",\n  `doublescore` bigint(20) NULL COMMENT "是否触发双倍上分活动",\n  `fateaddscore` bigint(20) NULL COMMENT "是否触发缘分队友加分活动",\n  `isnewaistrategy` bigint(20) NULL COMMENT "是否新的AI策略",\n  `lobbymemberlist` varchar(65533) NULL COMMENT "大厅组队队友列表",\n  `ratingtype` bigint(20) NULL COMMENT "计算的排位积分类型",\n  `killername` varchar(65533) NULL COMMENT "击杀我的人的名字",\n  `changekd` bigint(20) NULL COMMENT "当局结算引起的KD变化值，乘100后存入",\n  `friendteamaddscore` bigint(20) NULL COMMENT "是否触发好友四排组队加分活动",\n  `xuanwunoreductrating` bigint(20) NULL COMMENT "是否触发玄武不掉分活动",\n  `gunmateriallist` varchar(65533) NULL COMMENT "枪匠模式对局带出的改装件",\n  `bountynum` bigint(20) NULL COMMENT "枪匠模式的赏金数量",\n  `evacuatetype` bigint(20) NULL COMMENT "枪匠模式的逃脱类型。0 没有逃脱，1 直升机， 2 地堡， 3 的士",\n  `triggerrepeatkilllimit` bigint(20) NULL COMMENT "触发重复击杀限制",\n  `doublescoretimes` bigint(20) NULL COMMENT "是否触发双倍上分次数活动",\n  `teammembertmrelalist` varchar(65533) NULL COMMENT "Avatar时装",\n  `device_type` bigint(20) NULL COMMENT "设备类型0为手机 1为模拟器 2 键鼠 3 手柄"\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dwd_jordass_roundflow_hi.dteventtime, dwd_jordass_roundflow_hi.survivaltime, dwd_jordass_roundflow_hi.mode, 2022.04.23, 2022.04.30, 2022.05.01, 2022.05.08, 90, 101, 102, 103, 401, 402, 403]
Selected goldensql references: [34, 35, 33]
classification_result: {'sub_questions': '哪些玩家在2022-04-23到2022-04-30期间存活时长≥90分钟？","哪些玩家在2022-05-01到2022-05-08期间存活时长≥90分钟？', 'flag': 'NESTED'}
sql: 
select 
    substr(dteventtime, 1, 10) as stat_date,
    count(distinct vplayerid) as player_count
from dwd_jordass_roundflow_hi
where (
    (dteventtime between '2022-04-23' and '2022-04-30 23:59:59') 
    or 
    (dteventtime between '2022-05-01' and '2022-05-08 23:59:59')
)
and mode in (101, 102, 103, 401, 402, 403)
and survivaltime >= 5400  -- 90分钟=5400秒
group by substr(dteventtime, 1, 10)
order by stat_date;

[]
Finished processing sql sql_112 in 33.17425847053528 seconds
{'sql_id': 'sql_112', 'sql': "\nselect \n    substr(dteventtime, 1, 10) as stat_date,\n    count(distinct vplayerid) as player_count\nfrom dwd_jordass_roundflow_hi\nwhere (\n    (dteventtime between '2022-04-23' and '2022-04-30 23:59:59') \n    or \n    (dteventtime between '2022-05-01' and '2022-05-08 23:59:59')\n)\nand mode in (101, 102, 103, 401, 402, 403)\nand survivaltime >= 5400  -- 90分钟=5400秒\ngroup by substr(dteventtime, 1, 10)\norder by stat_date;\n", 'status': 'success', 'result': []}
Starting processing sql sql_113...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dwd_jordass_vsteamshoplog_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_vsteamshoplog_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "游戏APPID",\n  `platid` bigint(20) NULL COMMENT "ios 0/android 1",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家",\n  `uid` varchar(65533) NULL COMMENT "(可填)角色UID",\n  `shopid` bigint(20) NULL COMMENT "购买id",\n  `count` bigint(20) NULL COMMENT "购买数量"\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dwd_jordass_vsteamshoplog_hi.dteventtime,dwd_jordass_vsteamshoplog_hi.shopid,dwd_jordass_vsteamshoplog_hi.vplayerid,dwd_jordass_vsteamshoplog_hi.count,20220425,20220508]
Selected goldensql references: [34, 35, 57]
classification_result: {'sub_questions': '20220425-20220508期间每天每个商店的购买人数是多少？", "20220425-20220508期间每天每个商店的购买次数是多少？', 'flag': 'NESTED'}
sql: 
select
    substr(dteventtime, 1, 10) as dtstatdate,
    shopid,
    count(distinct vplayerid) as user_cnt,
    sum(count) as purchase_cnt
from dwd_jordass_vsteamshoplog_hi
where substr(dteventtime, 1, 10) between '2022-04-25' and '2022-05-08'
group by substr(dteventtime, 1, 10), shopid
order by dtstatdate, shopid;

[{'dtstatdate': '2022-04-25', 'shopid': 37, 'user_cnt': 2, 'purchase_cnt': 4}, {'dtstatdate': '2022-04-26', 'shopid': 38, 'user_cnt': 2, 'purchase_cnt': 4}, {'dtstatdate': '2022-04-27', 'shopid': 39, 'user_cnt': 1, 'purchase_cnt': 3}, {'dtstatdate': '2022-05-01', 'shopid': 40, 'user_cnt': 1, 'purchase_cnt': 4}, {'dtstatdate': '2022-05-02', 'shopid': 41, 'user_cnt': 1, 'purchase_cnt': 1}, {'dtstatdate': '2022-05-08', 'shopid': 42, 'user_cnt': 1, 'purchase_cnt': 2}]
Finished processing sql sql_113 in 27.125808477401733 seconds
{'sql_id': 'sql_113', 'sql': "\nselect\n    substr(dteventtime, 1, 10) as dtstatdate,\n    shopid,\n    count(distinct vplayerid) as user_cnt,\n    sum(count) as purchase_cnt\nfrom dwd_jordass_vsteamshoplog_hi\nwhere substr(dteventtime, 1, 10) between '2022-04-25' and '2022-05-08'\ngroup by substr(dteventtime, 1, 10), shopid\norder by dtstatdate, shopid;\n", 'status': 'success', 'result': [{'dtstatdate': '2022-04-25', 'shopid': 37, 'user_cnt': 2, 'purchase_cnt': 4}, {'dtstatdate': '2022-04-26', 'shopid': 38, 'user_cnt': 2, 'purchase_cnt': 4}, {'dtstatdate': '2022-04-27', 'shopid': 39, 'user_cnt': 1, 'purchase_cnt': 3}, {'dtstatdate': '2022-05-01', 'shopid': 40, 'user_cnt': 1, 'purchase_cnt': 4}, {'dtstatdate': '2022-05-02', 'shopid': 41, 'user_cnt': 1, 'purchase_cnt': 1}, {'dtstatdate': '2022-05-08', 'shopid': 42, 'user_cnt': 1, 'purchase_cnt': 2}]}
Starting processing sql sql_115...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dwd_jordass_player_matchrecord_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_player_matchrecord_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "分区字段，小时分区，格式YYYYMMDDHH",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "用户playerid号",\n  `uid` varchar(65533) NULL COMMENT "角色UID",\n  `matchtime` bigint(20) NULL COMMENT "匹配时长（秒）",\n  `matchresult` varchar(65533) NULL COMMENT "匹配结果",\n  `matchmode` bigint(20) NULL COMMENT "匹配模式",\n  `isaotufill` bigint(20) NULL COMMENT "是否自动填充",\n  `gameid` varchar(65533) NULL COMMENT "匹配成功为当前的battleid失败为0",\n  `submodes` varchar(65533) NULL COMMENT "选择的子模式列表，只有队长才有",\n  `isleader` bigint(20) NULL COMMENT "1表示队长0非队长",\n  `teamnum` varchar(65533) NULL COMMENT "组队人数",\n  `teammembers` varchar(65533) NULL COMMENT "组队队伍",\n  `matchteammembers` varchar(65533) NULL COMMENT "最终匹配的队伍",\n  `matchlabel` bigint(20) NULL COMMENT "匹配标签",\n  `corpsid` bigint(20) NULL COMMENT "联盟id",\n  `teamid` varchar(65533) NULL COMMENT "队伍ID",\n  `teamwaittime` bigint(20) NULL COMMENT "队伍首次组队到匹配等待时间",\n  `finalbucketidx` bigint(20) NULL COMMENT "匹配成功首队伍所在匹配区间idx",\n  `playermoderating` bigint(20) NULL COMMENT "玩家该模式下rating分(段位分)",\n  `playerlevel` bigint(20) NULL COMMENT "玩家等级",\n  `regresss` bigint(20) NULL COMMENT "是否回流玩家",\n  `matchsubmodegroup` bigint(20) NULL COMMENT "最终随机到的submodegroup",\n  `matchrating` bigint(20) NULL COMMENT "当前玩家所在队伍匹配积分",\n  `bucketidx` bigint(20) NULL COMMENT "当前玩家所在队伍匹配积分所在区间idx",\n  `device_type` bigint(20) NULL COMMENT "设备类型0为手机 1为模拟器 2 键鼠 3 手柄 5 PC高清模拟器",\n  `strategys` varchar(65533) NULL COMMENT "分队策略",\n  `match_client_type` bigint(20) NULL COMMENT "匹配池渠道0为手机 1为模拟器 2外部模拟器 8为小黑屋 9为新手局",\n  `pandoralost` bigint(20) NULL COMMENT "潘多拉预流失标记 1预流失 0非预流失",\n  `teamjoinsource` bigint(20) NULL COMMENT "组队加入来源",\n  `regressvalue` bigint(20) NULL COMMENT "玩家当前的回流值",\n  `strategy_type` bigint(20) NULL COMMENT "策略类型，-1表示服务器保底二次分队, 0表示004的潘多拉策略, 1表示005的潘多拉单局最优策略, 2表示015的技术中心优化分队策略, 3表示技术中心向量化二次分队方案, 4表示内部推荐二次分队方案",\n  `playersign` bigint(20) NULL COMMENT "玩家分级标签，1为白，2为红，3为灰, 4为深灰",\n  `livetype` bigint(20) NULL COMMENT "直播类型: 2 围观 4 视频号",\n  `liveid` varchar(65533) NULL COMMENT "直播ID",\n  `matchscene` bigint(20) NULL COMMENT "匹配成功时玩家所在场景，0为大厅，1为聚乐园",\n  `issilentmode` bigint(20) NULL COMMENT "是否是免耳麦模式，0为非免耳麦，1为免耳麦",\n  `ismatchlbs` bigint(20) NULL COMMENT "是否是lbs匹配，0为非lbs匹配，1为lbs匹配",\n  `strategy_index` bigint(20) NULL COMMENT "二次分队策略采用的weight数组的下标",\n  `xid` varchar(65533) NULL COMMENT "Xid",\n  `isanchor` bigint(20) NULL COMMENT "是否是主播，0为非主播，1为主播",\n  `isanchorgame` bigint(20) NULL COMMENT "是否匹配到主播局，0为非主播局，1为主播局",\n  `tournamentid` bigint(20) NULL COMMENT "微赛事ID",\n  `expandupsection` bigint(20) NULL COMMENT "最大向上扩段数",\n  `expanddownsection` bigint(20) NULL COMMENT "最大向下扩段数",\n  `expandupclass` bigint(20) NULL COMMENT "最大向上扩载数",\n  `expanddownclass` bigint(20) NULL COMMENT "最大向下扩载数",\n  `isfullbucket` bigint(20) NULL COMMENT "是否优先遍历满载队",\n  `timingmatchtime` bigint(20) NULL COMMENT "定时匹配真实匹配时长（秒）",\n  `tournamentstage` bigint(20) NULL COMMENT "微赛事阶段ID",\n  `tournamentclubid` varchar(65533) NULL COMMENT "微赛事战队ID",\n  `promotionmatchstatus` bigint(20) NULL COMMENT "参与晋级赛的状态, -1没勾选，0成功参与，1模式不对，2时间不对，3配置不对，4自身段位不对，5队友段位不对",\n  `ugcisgray` bigint(20) NULL COMMENT "是否为ugc灰度玩法。默认为0：非灰度；1：灰度",\n  `promotiontaskid` bigint(20) NULL COMMENT "晋级赛任务ID",\n  `strategyabtest` varchar(65533) NULL COMMENT "未命中模式为空，对照组记 0:ID，实验组记 1:ID",\n  `accompanytype` bigint(20) NULL COMMENT "陪玩标签值 0 ：没有打标签，1：陪玩，2：老板",\n  `minusteamnum` bigint(20) NULL COMMENT "匹配成功后踢回匹配池的队伍数",\n  `mobiletabletmatchlabel` bigint(20) NULL COMMENT "匹配队伍平板比例标签(非手机=0，纯手机=1，25%平板=2，50%平板=3，75%平板=4，100%平板=5)",\n  `ratingtype` bigint(20) NULL COMMENT "积分类型",\n  `idcname` varchar(65533) NULL COMMENT "IDC集群名字",\n  `strategyextendinfo` varchar(65533) NULL COMMENT "推荐侧二次分队返回的信息",\n  `playerabtest` varchar(65533) NULL COMMENT "个人匹配abtest",\n  `gameabtest` varchar(65533) NULL COMMENT "匹配对局的abtest,没有则为空字符串",\n  `matchtype` bigint(20) NULL COMMENT "1表示匹配成局，2表示补人",\n  `matchisolatetype` bigint(20) NULL COMMENT "玩家匹配隔离标记, 0不隔离，2所有模式隔离，3积分模式隔离，4E玩法模式隔离",\n  `predictmatchtime` bigint(20) NULL COMMENT "预估匹配时长",\n  `expandspeed` bigint(20) NULL COMMENT "匹配单阶段扩段时长",\n  `escapehardid` bigint(20) NULL COMMENT "E玩法难度ID",\n  `gameplayernum` bigint(20) NULL COMMENT "开局人数",\n  `gameaistrategy` bigint(20) NULL COMMENT "AI投放策略类型",\n  `isfixmatchlabel` bigint(20) NULL COMMENT "是否触发了标签修正",\n  `realmatchsubmodes` varchar(65533) NULL COMMENT "实际匹配的模式组列表",\n  `aitype` bigint(20) NULL COMMENT "投放的AI類型",\n  `decratingtype` bigint(20) NULL COMMENT "降段类型，0=未触发降段，1=pc新手标签降段，2=未成年标签降段，3=回流标签降段，4=情绪值降段",\n  `forcematchtype` bigint(20) NULL COMMENT "记录本次匹配是否触发了强制开局，0=未触发，1=通用强制开局，2=PC新手强制开局",\n  `ispcaigame` bigint(20) NULL COMMENT "是否触发了PC首局AI局",\n  `matchsubclienttype` bigint(20) NULL COMMENT "匹配子池：0非子池, 2外设键鼠,3外设手柄,4主播,5PC新手,6PC-AI局 7BR温暖局，8隧道AI局",\n  `heroexcludetype` bigint(20) NULL COMMENT "是否触发了英雄互斥匹配，1采用了互斥匹配, 2没命中灰度 3超时，0其他情况",\n  `natalhero` bigint(20) NULL COMMENT "本命英雄ID",\n  `iswarmescapegame` bigint(20) NULL COMMENT "是否是E玩法温暖局",\n  `cancrossdevicematch` bigint(20) NULL COMMENT "是否可已手机非手机混匹, 1可以，0不可以",\n  `aiteamatetype` bigint(20) NULL COMMENT "AI队友类型",\n  `isfirstteam` bigint(20) NULL COMMENT "是否是首队",\n  `firstteamwaittime` bigint(20) NULL COMMENT "首队的匹配等待时间",\n  `firstteamrankbucket` bigint(20) NULL COMMENT "首队段位分段",\n  `matchprocessinfo` varchar(65533) NULL COMMENT "匹配扩展信息 辅助查询匹配问题",\n  `isabtwarmgame` bigint(20) NULL COMMENT "是否触发了温暖局",\n  `warmplayertype` bigint(20) NULL COMMENT "温暖局玩家身份, 3=挫败（未来），2=回流，1=低活，0=未触发或无标签",\n  `escapeplayertype` varchar(65533) NULL COMMENT "隧道玩家身份类型, 空字符串表示默认类型，1回流标签有限期内,2积分移动新手(隐藏分专用),3积分非移动新手(隐藏分专用),4积分回流(隐藏分专用),5全局新手(AI局专用),6PC新手(AI局专用),7非PC温暖(AI局专用),8PC温暖(AI局专用),9回流(AI局专用), 以+分割",\n  `secondarydecratingtype` bigint(20) NULL COMMENT "二维匹配分降段类型，0=未触发降段，1=隧道回流降分匹配",\n  `finalsecondarybucketidx` bigint(20) NULL COMMENT "匹配成功首队所在二维匹配积分区间",\n  `playersecondarymoderating` bigint(20) NULL COMMENT "玩家该模式下二维匹配积分",\n  `secondarymatchrating` bigint(20) NULL COMMENT "当前玩家所在队伍二维匹配积分",\n  `secondarybucketidx` bigint(20) NULL COMMENT "当前玩家所在队伍二维匹配积分所在区间",\n  `escapeasset` varchar(65533) NULL COMMENT "隧道玩法资产",\n  `escapewarmscore` varchar(65533) NULL COMMENT "隧道温暖值",\n  `pvethemeid` bigint(20) NULL COMMENT "PVE挑战事件ID",\n  `escapelesspeoplegamenum` bigint(20) NULL COMMENT "隧道每周已触发低真人局次数",\n  `garybucketgroup` bigint(20) NULL COMMENT "灰度分桶",\n  `matchsubclienttypebefore` bigint(20) NULL COMMENT "发起匹配时的匹配子池：0非子池, 2外设键鼠,3外设手柄,4主播,5PC新手,6PC-AI局, 7BR温暖局，8隧道AI局",\n  `frustratiggerlevel` bigint(20) NULL COMMENT "FrustraTiggerLevel ",\n  `frustramanualscore` varchar(65533) NULL COMMENT "FrustraManualScore ",\n  `frustramodelscore` varchar(65533) NULL COMMENT "FrustraModelScore ",\n  `frustragroup` varchar(65533) NULL COMMENT "FrustraGroup ",\n  `frustrathreshold` varchar(65533) NULL COMMENT "FrustraThreshold ",\n  `recomtraceid` varchar(65533) NULL COMMENT "RecomTraceID "\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dwd_jordass_player_matchrecord_hi.vplayerid,dwd_jordass_player_matchrecord_hi.matchmode,dwd_jordass_player_matchrecord_hi.dteventtime,1503,1603,20240202-20240204,20240209-20240211,20231208-20231210,20231215-20231217,20231006-20231008,20230929-20231001,20230922-20230924,20230721-20230723,20230728-20230730,20230519-20230611,20230616-20230625,20230505-20230507,20230512-20230514,20230121-20230127,20221125-20221127,20221202-20221204,20220819-20220821,20220826-20220828,20220722-20220724,20220729-20220731,20220506-20220508,20220513-20220515,20220520-20220522]
Selected goldensql references: [33, 34, 35]
classification_result: {'sub_questions': '哪些玩家在20240202-20240204期间参与了matchmode为1503或1603的对局？", "哪些玩家在20240209-20240211期间参与了matchmode为1503或1603的对局？", ..., "哪些玩家在20220520-20220522期间参与了matchmode为1503或1603的对局？', 'flag': 'NESTED'}
sql: 
select 
    vplayerid,
    count(distinct case 
        when dteventtime between '20240202' and '20240204' then '新年竞赛杯1'
        when dteventtime between '20240209' and '20240211' then '新年竞赛杯2'
        when dteventtime between '20231208' and '20231210' then '明星竞赛杯1'
        when dteventtime between '20231215' and '20231217' then '明星竞赛杯2'
        when dteventtime between '20231006' and '20231008' then '众竞赛道1'
        when dteventtime between '20230929' and '20231001' then '众竞赛道2'
        when dteventtime between '20230922' and '20230924' then '众竞赛道3'
        when dteventtime between '20230721' and '20230723' then '珍禽竞赛杯1'
        when dteventtime between '20230728' and '20230730' then '珍禽竞赛杯2'
        when dteventtime between '20230519' and '20230611' then '都会竞速1'
        when dteventtime between '20230616' and '20230625' then '都会竞速2'
        when dteventtime between '20230505' and '20230507' then '寒域竞赛杯1'
        when dteventtime between '20230512' and '20230514' then '寒域竞赛杯2'
        when dteventtime between '20230121' and '20230127' then '飞跃竞赛杯'
        when dteventtime between '20221125' and '20221127' then '联队竞赛杯1'
        when dteventtime between '20221202' and '20221204' then '联队竞赛杯2'
        when dteventtime between '20220819' and '20220821' then '职赛杯1'
        when dteventtime between '20220826' and '20220828' then '职赛杯2'
        when dteventtime between '20220722' and '20220724' then '夏日假期竞赛杯1'
        when dteventtime between '20220729' and '20220731' then '夏日假期竞赛杯2'
        when dteventtime between '20220506' and '20220508' then '众投竞赛1'
        when dteventtime between '20220513' and '20220515' then '众投竞赛2'
        when dteventtime between '20220520' and '20220522' then '众投竞赛3'
    end) as competition_count
from dwd_jordass_player_matchrecord_hi
where matchmode in (1503, 1603)
and (
    (dteventtime between '20240202' and '20240204') or
    (dteventtime between '20240209' and '20240211') or
    (dteventtime between '20231208' and '20231210') or
    (dteventtime between '20231215' and '20231217') or
    (dteventtime between '20231006' and '20231008') or
    (dteventtime between '20230929' and '20231001') or
    (dteventtime between '20230922' and '20230924') or
    (dteventtime between '20230721' and '20230723') or
    (dteventtime between '20230728' and '20230730') or
    (dteventtime between '20230519' and '20230611') or
    (dteventtime between '20230616' and '20230625') or
    (dteventtime between '20230505' and '20230507') or
    (dteventtime between '20230512' and '20230514') or
    (dteventtime between '20230121' and '20230127') or
    (dteventtime between '20221125' and '20221127') or
    (dteventtime between '20221202' and '20221204') or
    (dteventtime between '20220819' and '20220821') or
    (dteventtime between '20220826' and '20220828') or
    (dteventtime between '20220722' and '20220724') or
    (dteventtime between '20220729' and '20220731') or
    (dteventtime between '20220506' and '20220508') or
    (dteventtime between '20220513' and '20220515') or
    (dteventtime between '20220520' and '20220522')
)
group by vplayerid

[]
Finished processing sql sql_115 in 79.30818724632263 seconds
{'sql_id': 'sql_115', 'sql': "\nselect \n    vplayerid,\n    count(distinct case \n        when dteventtime between '20240202' and '20240204' then '新年竞赛杯1'\n        when dteventtime between '20240209' and '20240211' then '新年竞赛杯2'\n        when dteventtime between '20231208' and '20231210' then '明星竞赛杯1'\n        when dteventtime between '20231215' and '20231217' then '明星竞赛杯2'\n        when dteventtime between '20231006' and '20231008' then '众竞赛道1'\n        when dteventtime between '20230929' and '20231001' then '众竞赛道2'\n        when dteventtime between '20230922' and '20230924' then '众竞赛道3'\n        when dteventtime between '20230721' and '20230723' then '珍禽竞赛杯1'\n        when dteventtime between '20230728' and '20230730' then '珍禽竞赛杯2'\n        when dteventtime between '20230519' and '20230611' then '都会竞速1'\n        when dteventtime between '20230616' and '20230625' then '都会竞速2'\n        when dteventtime between '20230505' and '20230507' then '寒域竞赛杯1'\n        when dteventtime between '20230512' and '20230514' then '寒域竞赛杯2'\n        when dteventtime between '20230121' and '20230127' then '飞跃竞赛杯'\n        when dteventtime between '20221125' and '20221127' then '联队竞赛杯1'\n        when dteventtime between '20221202' and '20221204' then '联队竞赛杯2'\n        when dteventtime between '20220819' and '20220821' then '职赛杯1'\n        when dteventtime between '20220826' and '20220828' then '职赛杯2'\n        when dteventtime between '20220722' and '20220724' then '夏日假期竞赛杯1'\n        when dteventtime between '20220729' and '20220731' then '夏日假期竞赛杯2'\n        when dteventtime between '20220506' and '20220508' then '众投竞赛1'\n        when dteventtime between '20220513' and '20220515' then '众投竞赛2'\n        when dteventtime between '20220520' and '20220522' then '众投竞赛3'\n    end) as competition_count\nfrom dwd_jordass_player_matchrecord_hi\nwhere matchmode in (1503, 1603)\nand (\n    (dteventtime between '20240202' and '20240204') or\n    (dteventtime between '20240209' and '20240211') or\n    (dteventtime between '20231208' and '20231210') or\n    (dteventtime between '20231215' and '20231217') or\n    (dteventtime between '20231006' and '20231008') or\n    (dteventtime between '20230929' and '20231001') or\n    (dteventtime between '20230922' and '20230924') or\n    (dteventtime between '20230721' and '20230723') or\n    (dteventtime between '20230728' and '20230730') or\n    (dteventtime between '20230519' and '20230611') or\n    (dteventtime between '20230616' and '20230625') or\n    (dteventtime between '20230505' and '20230507') or\n    (dteventtime between '20230512' and '20230514') or\n    (dteventtime between '20230121' and '20230127') or\n    (dteventtime between '20221125' and '20221127') or\n    (dteventtime between '20221202' and '20221204') or\n    (dteventtime between '20220819' and '20220821') or\n    (dteventtime between '20220826' and '20220828') or\n    (dteventtime between '20220722' and '20220724') or\n    (dteventtime between '20220729' and '20220731') or\n    (dteventtime between '20220506' and '20220508') or\n    (dteventtime between '20220513' and '20220515') or\n    (dteventtime between '20220520' and '20220522')\n)\ngroup by vplayerid\n", 'status': 'success', 'result': []}
Starting processing sql sql_116...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dws_jordass_login_df', 'Create Table': 'CREATE TABLE `dws_jordass_login_df` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:不区分平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `cbitmap` varchar(65533) NULL COMMENT "登录位图",\n  `dregdate` varchar(65533) NULL COMMENT "注册日期，格式YYYYMMDD",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `friendcount` bigint(20) NULL COMMENT "好友数量"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dws_jordass_water_di', 'Create Table': 'CREATE TABLE `dws_jordass_water_di` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区，付费日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android,255:所有平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `iamount` bigint(20) NULL COMMENT "代币金额(Q分)",\n  `itimes` bigint(20) NULL COMMENT "流水次数",\n  `imoney` double NULL COMMENT "除100为实际支付人民币金额"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dws_jordass_uid_login_df', 'Create Table': 'CREATE TABLE `dws_jordass_uid_login_df` (\n  `dtstatdate` varchar(65533) NULL COMMENT "日期",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系： \'wx\' - 微信 ；\'qq\' - 手Q\t",\n  `platid` bigint(20) NULL COMMENT "系统平台",\n  `vplayerid` varchar(65533) NULL COMMENT "账号id",\n  `uid` bigint(20) NULL COMMENT "角色id",\n  `vrolename` varchar(65533) NULL COMMENT "角色名称",\n  `dregdate` varchar(65533) NULL COMMENT "注册日期",\n  `lastactdate` varchar(65533) NULL COMMENT "最后活跃日期",\n  `cbitmap` varchar(65533) NULL COMMENT "活跃位图",\n  `ilevel` varchar(65533) NULL COMMENT "账号等级",\n  `friendcount` bigint(20) NULL COMMENT "好友数",\n  `historymaxsegment` bigint(20) NULL COMMENT "历史最高段位",\n  `gender` bigint(20) NULL COMMENT "游戏内性别"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dws_jordass_water_df', 'Create Table': 'CREATE TABLE `dws_jordass_water_df` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区，付费日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android，255所有平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `cbitmap` varchar(65533) NULL COMMENT "流水位图",\n  `dwaterdate` varchar(65533) NULL COMMENT "首次流水日期",\n  `imoney` double NULL COMMENT "累计流水收入(分)(简称流水)",\n  `iamount` bigint(20) NULL COMMENT "代币金额(Q分)"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dws_jordass_uid_login_df.cbitmap,dws_jordass_uid_login_df.historymaxsegment,dws_jordass_water_df.imoney,dws_jordass_uid_login_df.vplayerid,dws_jordass_uid_login_df.vplayerid = dws_jordass_water_df.vplayerid,20250225]
Selected goldensql references: [38, 56, 48]
classification_result: {'sub_questions': '如何判断20250225存量用户的活跃状态（近三个月流失、活跃但无付费、活跃且有付费）？","如何获取用户的历史段位？","如何获取用户的历史付费分层？","如何将上述信息进行关联和分组统计？', 'flag': 'NESTED'}
sql: 
select
    case 
        when instr(substr(cbitmap, 1, 90), '1') = 0 then '近三个月流失'
        when w.vplayerid is null then '近三个月活跃但无付费'
        else '近三个月活跃且有付费'
    end as user_type,
    historymaxsegment as history_segment,
    case 
        when imoney is null or imoney = 0 then '0'
        when imoney > 0 and imoney <= 1200 then '(0-1200]'
        when imoney > 1200 and imoney <= 6000 then '(1200-6000]'
        when imoney > 6000 and imoney <= 18000 then '(6000-18000]'
        when imoney > 18000 then '(18000+]'
    end as payment_tier,
    count(distinct l.vplayerid) as user_count
from 
    dws_jordass_uid_login_df l
left join 
    dws_jordass_water_df w on l.vplayerid = w.vplayerid and w.dtstatdate = '20250225'
where 
    l.dtstatdate = '20250225'
    and l.platid = 255
group by 
    case 
        when instr(substr(cbitmap, 1, 90), '1') = 0 then '近三个月流失'
        when w.vplayerid is null then '近三个月活跃但无付费'
        else '近三个月活跃且有付费'
    end,
    historymaxsegment,
    case 
        when imoney is null or imoney = 0 then '0'
        when imoney > 0 and imoney <= 1200 then '(0-1200]'
        when imoney > 1200 and imoney <= 6000 then '(1200-6000]'
        when imoney > 6000 and imoney <= 18000 then '(6000-18000]'
        when imoney > 18000 then '(18000+]'
    end;

Traceback (most recent call last):
  File "/home/idg/repos/tgac/code/utils.py", line 204, in execute_sql_with_pymysql
    cursor.execute(sql)
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/cursors.py", line 153, in execute
    result = self._query(query)
             ^^^^^^^^^^^^^^^^^^
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/cursors.py", line 322, in _query
    conn.query(q)
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 563, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 825, in _read_query_result
    result.read()
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 1199, in read
    first_packet = self.connection._read_packet()
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/connections.py", line 775, in _read_packet
    packet.raise_for_error()
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/protocol.py", line 219, in raise_for_error
    err.raise_mysql_exception(self._data)
  File "/home/idg/miniconda3/envs/playground/lib/python3.11/site-packages/pymysql/err.py", line 150, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1064, "Column 'cbitmap' is ambiguous")
执行SQL语句时发生错误：(1064, "Column 'cbitmap' is ambiguous")
None
Finished processing sql sql_116 in 43.39845275878906 seconds
{'sql_id': 'sql_116', 'sql': "\nselect\n    case \n        when instr(substr(cbitmap, 1, 90), '1') = 0 then '近三个月流失'\n        when w.vplayerid is null then '近三个月活跃但无付费'\n        else '近三个月活跃且有付费'\n    end as user_type,\n    historymaxsegment as history_segment,\n    case \n        when imoney is null or imoney = 0 then '0'\n        when imoney > 0 and imoney <= 1200 then '(0-1200]'\n        when imoney > 1200 and imoney <= 6000 then '(1200-6000]'\n        when imoney > 6000 and imoney <= 18000 then '(6000-18000]'\n        when imoney > 18000 then '(18000+]'\n    end as payment_tier,\n    count(distinct l.vplayerid) as user_count\nfrom \n    dws_jordass_uid_login_df l\nleft join \n    dws_jordass_water_df w on l.vplayerid = w.vplayerid and w.dtstatdate = '20250225'\nwhere \n    l.dtstatdate = '20250225'\n    and l.platid = 255\ngroup by \n    case \n        when instr(substr(cbitmap, 1, 90), '1') = 0 then '近三个月流失'\n        when w.vplayerid is null then '近三个月活跃但无付费'\n        else '近三个月活跃且有付费'\n    end,\n    historymaxsegment,\n    case \n        when imoney is null or imoney = 0 then '0'\n        when imoney > 0 and imoney <= 1200 then '(0-1200]'\n        when imoney > 1200 and imoney <= 6000 then '(1200-6000]'\n        when imoney > 6000 and imoney <= 18000 then '(6000-18000]'\n        when imoney > 18000 then '(18000+]'\n    end;\n", 'status': 'success', 'result': None}
Starting processing sql sql_117...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dws_jordass_login_df', 'Create Table': 'CREATE TABLE `dws_jordass_login_df` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:不区分平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `cbitmap` varchar(65533) NULL COMMENT "登录位图",\n  `dregdate` varchar(65533) NULL COMMENT "注册日期，格式YYYYMMDD",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `friendcount` bigint(20) NULL COMMENT "好友数量"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dws_jordass_login_df.cbitmap,dws_jordass_login_df.vplayerid,dws_jordass_login_df.platid,dws_jordass_login_df.dtstatdate,20250331,20250510]
Selected goldensql references: [37, 48, 33]
classification_result: {'sub_questions': '如何判断一个玩家是否为活跃用户？","如何判断一个玩家是否为7日回流用户？","如何判断一个玩家是否为14日回流用户？","如何判断一个玩家是否为30日回流用户？', 'flag': 'NESTED'}
sql: 
select
    user_type,
    count(distinct vplayerid) as user_count
from (
    select
        vplayerid,
        case
            when (instr(substr(cbitmap, 1, 1), '1') > 0) then '活跃'
            when (instr(substr(cbitmap, 1, 1), '1') > 0) and (instr(substr(cbitmap, 2, 7), '1') = 0) then '7日回流'
            when (instr(substr(cbitmap, 1, 1), '1') > 0) and (instr(substr(cbitmap, 2, 14), '1') = 0) then '14日回流'
            when (instr(substr(cbitmap, 1, 1), '1') > 0) and (instr(substr(cbitmap, 2, 30), '1') = 0) then '30日回流'
        end as user_type
    from
        dws_jordass_login_df
    where
        dtstatdate between '20250331' and '20250510'
        and platid = 255
) as user_types
where user_type is not null
group by user_type;

[{'user_type': '活跃', 'user_count': 14}]
Finished processing sql sql_117 in 34.98193407058716 seconds
{'sql_id': 'sql_117', 'sql': "\nselect\n    user_type,\n    count(distinct vplayerid) as user_count\nfrom (\n    select\n        vplayerid,\n        case\n            when (instr(substr(cbitmap, 1, 1), '1') > 0) then '活跃'\n            when (instr(substr(cbitmap, 1, 1), '1') > 0) and (instr(substr(cbitmap, 2, 7), '1') = 0) then '7日回流'\n            when (instr(substr(cbitmap, 1, 1), '1') > 0) and (instr(substr(cbitmap, 2, 14), '1') = 0) then '14日回流'\n            when (instr(substr(cbitmap, 1, 1), '1') > 0) and (instr(substr(cbitmap, 2, 30), '1') = 0) then '30日回流'\n        end as user_type\n    from\n        dws_jordass_login_df\n    where\n        dtstatdate between '20250331' and '20250510'\n        and platid = 255\n) as user_types\nwhere user_type is not null\ngroup by user_type;\n", 'status': 'success', 'result': [{'user_type': '活跃', 'user_count': 14}]}
Starting processing sql sql_118...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dws_jordass_mode_roundrecord_di', 'Create Table': 'CREATE TABLE `dws_jordass_mode_roundrecord_di` (\n  `dtstatdate` varchar(65533) NULL COMMENT "统计日期格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `mode` bigint(20) NULL COMMENT "模式ID",\n  `modename` varchar(65533) NULL COMMENT "模式名称",\n  `submode` bigint(20) NULL COMMENT "子模式ID",\n  `submodename` varchar(65533) NULL COMMENT "子模式名称",\n  `map` bigint(20) NULL COMMENT "地图ID",\n  `mapname` varchar(65533) NULL COMMENT "地图名称",\n  `seasonid` bigint(20) NULL COMMENT "赛季ID",\n  `seasonname` varchar(65533) NULL COMMENT "赛季名称",\n  `roundcnt` bigint(20) NULL COMMENT "当日对局数",\n  `roundtime` bigint(20) NULL COMMENT "当日对局时长(秒)",\n  `survivaltime` bigint(20) NULL COMMENT "当日存活时长(秒)",\n  `firstroundtime` varchar(65533) NULL COMMENT "当日首次对局时间",\n  `device_type` bigint(20) NULL COMMENT "设备类型"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dws_jordass_login_di', 'Create Table': 'CREATE TABLE `dws_jordass_login_di` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\t\'wx\' - 微信\t\'qq\' - 手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:所有平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `ionlinetime` bigint(20) NULL COMMENT "在线时长(秒)",\n  `ilogincount` bigint(20) NULL COMMENT "登录次数",\n  `friendcount` bigint(20) NULL COMMENT "好友数量",\n  `dtlogintime` varchar(65533) NULL COMMENT "当日最早登录时间,格式YYYY-MM-DDHH:MM:SS"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dwd_jordass_playerprofstagechange_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_playerprofstagechange_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "小时分区字段，格式YYYYMMDDHH",\n  `dteventtime` varchar(65533) NULL COMMENT "游戏事件的时间, 格式 YYYY-MM-DD HH:MM:SS",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS,1:Android",\n  `izoneareaid` bigint(20) NULL COMMENT "针对分区分服的游戏填写分区id，用来唯一标示一个区；非分区分服游戏请填写0",\n  `vplayerid` varchar(65533) NULL COMMENT "用户playerid号",\n  `uid` varchar(65533) NULL COMMENT "角色UID",\n  `tournamentid` bigint(20) NULL COMMENT "赛事id",\n  `beforstage` bigint(20) NULL COMMENT "变更前阶段",\n  `allianceforceterstage` bigint(20) NULL COMMENT "变更后阶段",\n  `ruletype` bigint(20) NULL COMMENT "晋级规则类型",\n  `ispass` bigint(20) NULL COMMENT "是否晋级",\n  `teamrank` bigint(20) NULL COMMENT "积分赛排名，没有上榜的值为-1",\n  `battlecount` bigint(20) NULL COMMENT "当前赛段对局数",\n  `clubid` varchar(65533) NULL COMMENT "战队id,单人参赛阶段值为0"\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dwd_jordass_mysteryplaylog_hi', 'Create Table': 'CREATE TABLE `dwd_jordass_mysteryplaylog_hi` (\n  `tdbank_imp_date` varchar(65533) NULL COMMENT "分区字段，小时分区，格式：YYYYMMDDHH",\n  `iid` varchar(65533) NULL COMMENT "日志唯一ID",\n  `dttime` varchar(65533) NULL COMMENT "时间戳",\n  `suser` varchar(65533) NULL COMMENT "对应游戏内vplayerid",\n  `sphoneid` varchar(65533) NULL COMMENT "PhoneID",\n  `imodule` varchar(65533) NULL COMMENT "模块ID",\n  `ichannel` varchar(65533) NULL COMMENT "频道ID",\n  `itype` varchar(65533) NULL COMMENT "类型",\n  `sappid` varchar(65533) NULL COMMENT "vgameappid(手Q、微信)",\n  `iostype` varchar(65533) NULL COMMENT "platid(安卓、IOS)",\n  `iactid` varchar(65533) NULL COMMENT "活动ID",\n  `ijumptype` varchar(65533) NULL COMMENT "跳转类型",\n  `sjumpurl` varchar(65533) NULL COMMENT "跳转地址",\n  `ipartition` varchar(65533) NULL COMMENT "小区",\n  `recommend_id` varchar(65533) NULL COMMENT "推荐ID",\n  `changjing_id` varchar(65533) NULL COMMENT "场景ID",\n  `goods_id` varchar(65533) NULL COMMENT "礼包ID",\n  `useridt_count` varchar(65533) NULL COMMENT "个数",\n  `useridt_fee` varchar(65533) NULL COMMENT "价格",\n  `currency_type` varchar(65533) NULL COMMENT "货币类型",\n  `service_type` bigint(20) NULL COMMENT "业务类型",\n  `sroleid` varchar(65533) NULL COMMENT "角色ID",\n  `act_style` varchar(65533) NULL COMMENT "活动类型",\n  `flow_id` varchar(65533) NULL COMMENT "活动FlowID",\n  `dteventtime` varchar(65533) NULL COMMENT "事件时间,格式YYYY-MM-DDHH:MM:SS",\n  `reserve0` varchar(65533) NULL COMMENT "预留字段",\n  `reserve1` varchar(65533) NULL COMMENT "预留字段",\n  `reserve2` varchar(65533) NULL COMMENT "预留字段",\n  `reserve3` varchar(65533) NULL COMMENT "预留字段",\n  `reserve4` varchar(65533) NULL COMMENT "预留字段",\n  `reserve5` varchar(65533) NULL COMMENT "预留字段",\n  `reserve6` varchar(65533) NULL COMMENT "comment",\n  `reserve7` varchar(65533) NULL COMMENT "预留字段",\n  `reserve8` varchar(65533) NULL COMMENT "预留字段",\n  `reserve9` varchar(65533) NULL COMMENT "预留字段",\n  `taskid` varchar(65533) NULL COMMENT "流量管家taskid",\n  `partflag` varchar(65533) NULL COMMENT "参与活动标志:0表示非参与,大于0表示参与"\n) ENGINE=OLAP \nDUPLICATE KEY(`tdbank_imp_date`)\nDISTRIBUTED BY HASH(`tdbank_imp_date`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dwd_jordass_mysteryplaylog_hi.itype,dwd_jordass_mysteryplaylog_hi.iactid,dwd_jordass_mysteryplaylog_hi.dteventtime,dwd_jordass_mysteryplaylog_hi.suser,dws_jordass_mode_roundrecord_di.vplayerid,dws_jordass_mode_roundrecord_di.roundcnt,dws_jordass_mode_roundrecord_di.roundtime,dws_jordass_login_di.vplayerid,dws_jordass_login_di.ionlinetime,dwd_jordass_playerprofstagechange_hi.vplayerid,dwd_jordass_playerprofstagechange_hi.battlecount,20240426,20240505,1193536,1,10,200,201,202,203,204,31,32,33,34,35,702,703]
Selected goldensql references: [33, 34, 35]
classification_result: {'sub_questions': '哪些用户在20240426-20240505期间被曝光了活动1193536？","哪些用户在曝光后参与了活动？","这些用户在传统模式的对局数和时长是多少？","这些用户的活跃情况如何？","这些用户参与专业赛的情况如何？', 'flag': 'NESTED'}
sql: 
with exposure as (
    select distinct suser as vplayerid
    from dwd_jordass_mysteryplaylog_hi
    where iactid = '1193536'
    and itype = '1'
    and dteventtime between '20240426' and '20240505'
),
participation as (
    select distinct suser as vplayerid
    from dwd_jordass_mysteryplaylog_hi
    where iactid = '1193536'
    and itype in ('10','200','201','202','203','204','31','32','33','34','35','702','703')
    and dteventtime between '20240426' and '20240505'
),
traditional_mode as (
    select 
        vplayerid,
        sum(roundcnt) as roundcnt,
        sum(roundtime) as roundtime
    from dws_jordass_mode_roundrecord_di
    where dtstatdate between '20240426' and '20240505'
    and mode in (101,102,103) -- 假设这些是传统模式ID
    group by vplayerid
),
active_users as (
    select 
        vplayerid,
        sum(ionlinetime) as onlinetime
    from dws_jordass_login_di
    where dtstatdate between '20240426' and '20240505'
    group by vplayerid
),
professional_match as (
    select 
        vplayerid,
        count(*) as battlecount
    from dwd_jordass_playerprofstagechange_hi
    where tournamentid = 30002
    and dteventtime between '20240426' and '20240505'
    group by vplayerid
)

select 
    case 
        when p.vplayerid is not null then '曝光且参与'
        else '曝光未参与'
    end as exposure_status,
    count(distinct e.vplayerid) as user_count,
    count(distinct tm.vplayerid) as traditional_user_count,
    coalesce(sum(tm.roundcnt), 0) as traditional_round_count,
    coalesce(sum(tm.roundtime), 0) as traditional_round_time,
    count(distinct au.vplayerid) as active_user_count,
    coalesce(sum(au.onlinetime), 0) as active_time,
    count(distinct pm.vplayerid) as professional_user_count,
    coalesce(sum(pm.battlecount), 0) as professional_battle_count
from exposure e
left join participation p on e.vplayerid = p.vplayerid
left join traditional_mode tm on e.vplayerid = tm.vplayerid
left join active_users au on e.vplayerid = au.vplayerid
left join professional_match pm on e.vplayerid = pm.vplayerid
group by exposure_status;

[]
Finished processing sql sql_118 in 59.00123715400696 seconds
{'sql_id': 'sql_118', 'sql': "\nwith exposure as (\n    select distinct suser as vplayerid\n    from dwd_jordass_mysteryplaylog_hi\n    where iactid = '1193536'\n    and itype = '1'\n    and dteventtime between '20240426' and '20240505'\n),\nparticipation as (\n    select distinct suser as vplayerid\n    from dwd_jordass_mysteryplaylog_hi\n    where iactid = '1193536'\n    and itype in ('10','200','201','202','203','204','31','32','33','34','35','702','703')\n    and dteventtime between '20240426' and '20240505'\n),\ntraditional_mode as (\n    select \n        vplayerid,\n        sum(roundcnt) as roundcnt,\n        sum(roundtime) as roundtime\n    from dws_jordass_mode_roundrecord_di\n    where dtstatdate between '20240426' and '20240505'\n    and mode in (101,102,103) -- 假设这些是传统模式ID\n    group by vplayerid\n),\nactive_users as (\n    select \n        vplayerid,\n        sum(ionlinetime) as onlinetime\n    from dws_jordass_login_di\n    where dtstatdate between '20240426' and '20240505'\n    group by vplayerid\n),\nprofessional_match as (\n    select \n        vplayerid,\n        count(*) as battlecount\n    from dwd_jordass_playerprofstagechange_hi\n    where tournamentid = 30002\n    and dteventtime between '20240426' and '20240505'\n    group by vplayerid\n)\n\nselect \n    case \n        when p.vplayerid is not null then '曝光且参与'\n        else '曝光未参与'\n    end as exposure_status,\n    count(distinct e.vplayerid) as user_count,\n    count(distinct tm.vplayerid) as traditional_user_count,\n    coalesce(sum(tm.roundcnt), 0) as traditional_round_count,\n    coalesce(sum(tm.roundtime), 0) as traditional_round_time,\n    count(distinct au.vplayerid) as active_user_count,\n    coalesce(sum(au.onlinetime), 0) as active_time,\n    count(distinct pm.vplayerid) as professional_user_count,\n    coalesce(sum(pm.battlecount), 0) as professional_battle_count\nfrom exposure e\nleft join participation p on e.vplayerid = p.vplayerid\nleft join traditional_mode tm on e.vplayerid = tm.vplayerid\nleft join active_users au on e.vplayerid = au.vplayerid\nleft join professional_match pm on e.vplayerid = pm.vplayerid\ngroup by exposure_status;\n", 'status': 'success', 'result': []}
Starting processing sql sql_119...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dws_jordass_login_df', 'Create Table': 'CREATE TABLE `dws_jordass_login_df` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:不区分平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `cbitmap` varchar(65533) NULL COMMENT "登录位图",\n  `dregdate` varchar(65533) NULL COMMENT "注册日期，格式YYYYMMDD",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `friendcount` bigint(20) NULL COMMENT "好友数量"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dws_jordass_login_di', 'Create Table': 'CREATE TABLE `dws_jordass_login_di` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\t\'wx\' - 微信\t\'qq\' - 手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:所有平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `ionlinetime` bigint(20) NULL COMMENT "在线时长(秒)",\n  `ilogincount` bigint(20) NULL COMMENT "登录次数",\n  `friendcount` bigint(20) NULL COMMENT "好友数量",\n  `dtlogintime` varchar(65533) NULL COMMENT "当日最早登录时间,格式YYYY-MM-DDHH:MM:SS"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dws_jordass_login_df.dtstatdate,dws_jordass_login_df.vplayerid,20250429,20250601]
Selected goldensql references: [37, 48, 34]
classification_result: {'sub_questions': '如何获取20250429和20250601两天的活跃用户？","如何判断用户在后续半个月的登录状态？","如何根据注册和登录历史判断用户类型？","如何按日期和用户类型聚合统计人数？', 'flag': 'NESTED'}
sql: 
select
    dtstatdate as `统计日期`,
    case 
        when dregdate = dtstatdate then '新增'
        when instr(substr(cbitmap, 2, 7), '1') > 0 then '7日以内留存'
        when instr(substr(cbitmap, 8, 7), '1') > 0 then '7~14日回流'
        when instr(substr(cbitmap, 15, 16), '1') > 0 then '14~30日回流'
        when instr(substr(cbitmap, 31, 60), '1') > 0 then '30~90日回流'
        when instr(substr(cbitmap, 91), '1') > 0 then '90日以上回流'
        when instr(substr(cbitmap, 2, 15), '1') = 0 then '后续半个月未登录'
        else '后续半个月有登录'
    end as `用户类型`,
    count(distinct vplayerid) as `人数`
from dws_jordass_login_df
where dtstatdate in ('20250429', '20250601')
  and platid = 255
  and instr(substr(cbitmap, 1, 1), '1') > 0
group by dtstatdate, 
    case 
        when dregdate = dtstatdate then '新增'
        when instr(substr(cbitmap, 2, 7), '1') > 0 then '7日以内留存'
        when instr(substr(cbitmap, 8, 7), '1') > 0 then '7~14日回流'
        when instr(substr(cbitmap, 15, 16), '1') > 0 then '14~30日回流'
        when instr(substr(cbitmap, 31, 60), '1') > 0 then '30~90日回流'
        when instr(substr(cbitmap, 91), '1') > 0 then '90日以上回流'
        when instr(substr(cbitmap, 2, 15), '1') = 0 then '后续半个月未登录'
        else '后续半个月有登录'
    end;

[{'统计日期': '20250601', '用户类型': '新增', '人数': 1}, {'统计日期': '20250429', '用户类型': '新增', '人数': 1}]
Finished processing sql sql_119 in 40.16802191734314 seconds
{'sql_id': 'sql_119', 'sql': "\nselect\n    dtstatdate as `统计日期`,\n    case \n        when dregdate = dtstatdate then '新增'\n        when instr(substr(cbitmap, 2, 7), '1') > 0 then '7日以内留存'\n        when instr(substr(cbitmap, 8, 7), '1') > 0 then '7~14日回流'\n        when instr(substr(cbitmap, 15, 16), '1') > 0 then '14~30日回流'\n        when instr(substr(cbitmap, 31, 60), '1') > 0 then '30~90日回流'\n        when instr(substr(cbitmap, 91), '1') > 0 then '90日以上回流'\n        when instr(substr(cbitmap, 2, 15), '1') = 0 then '后续半个月未登录'\n        else '后续半个月有登录'\n    end as `用户类型`,\n    count(distinct vplayerid) as `人数`\nfrom dws_jordass_login_df\nwhere dtstatdate in ('20250429', '20250601')\n  and platid = 255\n  and instr(substr(cbitmap, 1, 1), '1') > 0\ngroup by dtstatdate, \n    case \n        when dregdate = dtstatdate then '新增'\n        when instr(substr(cbitmap, 2, 7), '1') > 0 then '7日以内留存'\n        when instr(substr(cbitmap, 8, 7), '1') > 0 then '7~14日回流'\n        when instr(substr(cbitmap, 15, 16), '1') > 0 then '14~30日回流'\n        when instr(substr(cbitmap, 31, 60), '1') > 0 then '30~90日回流'\n        when instr(substr(cbitmap, 91), '1') > 0 then '90日以上回流'\n        when instr(substr(cbitmap, 2, 15), '1') = 0 then '后续半个月未登录'\n        else '后续半个月有登录'\n    end;\n", 'status': 'success', 'result': [{'统计日期': '20250601', '用户类型': '新增', '人数': 1}, {'统计日期': '20250429', '用户类型': '新增', '人数': 1}]}
Starting processing sql sql_120...
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
db_config: {'host': '127.0.0.1', 'user': 'root', 'database': 'tgac', 'charset': 'utf8mb4', 'cursorclass': <class 'pymysql.cursors.DictCursor'>, 'port': 9030, 'connect_timeout': 10}
scheme_list: [[{'Table': 'dws_mgamejp_login_user_activity_di', 'Create Table': 'CREATE TABLE `dws_mgamejp_login_user_activity_di` (\n  `dtstatdate` bigint(20) NULL COMMENT "统计日期YYYYMMDD",\n  `saccounttype` varchar(65533) NULL COMMENT "帐号类型:QQ号或者微信",\n  `suserid` varchar(65533) NULL COMMENT "帐号",\n  `suseridtype` varchar(65533) NULL COMMENT "帐号类型:qq wxid playerid ",\n  `sgamecode` varchar(65533) NULL COMMENT "业务 ",\n  `splattype` varchar(65533) NULL COMMENT "平台类型(大平台)。枚举值为Android/ iOS，取汇总时取-100 ",\n  `splat` varchar(65533) NULL COMMENT "平台(小平台)。备注：写死的-100",\n  `sgameparam` varchar(65533) NULL COMMENT "场次",\n  `schannel` varchar(65533) NULL COMMENT "不可用字段，用户可以忽略 ",\n  `sip` varchar(65533) NULL COMMENT "实际上是当日登录的最小时间戳，即最早登录时间",\n  `sclientver` varchar(65533) NULL COMMENT "客户端版本",\n  `ilevel` bigint(20) NULL COMMENT "用户等级。不可用",\n  `iviplevel` bigint(20) NULL COMMENT "Vip等级。不可用",\n  `itimes` bigint(20) NULL COMMENT "活跃总次数。备注：该字段表示用户在T日的当日活跃总次数",\n  `ionlinetime` bigint(20) NULL COMMENT "活跃总时间。备注：该字段表示用户在T日的当日活跃总时间"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dws_jordass_login_df', 'Create Table': 'CREATE TABLE `dws_jordass_login_df` (\n  `dtstatdate` varchar(65533) NULL COMMENT "分区字段，登陆日期，格式YYYYMMDD",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系：\'wx\':微信，\'qq\'：手Q",\n  `platid` bigint(20) NULL COMMENT "系统平台：0:IOS，1:Android，255:不区分平台",\n  `vplayerid` varchar(65533) NULL COMMENT "玩家ID",\n  `cbitmap` varchar(65533) NULL COMMENT "登录位图",\n  `dregdate` varchar(65533) NULL COMMENT "注册日期，格式YYYYMMDD",\n  `ilevel` bigint(20) NULL COMMENT "等级",\n  `friendcount` bigint(20) NULL COMMENT "好友数量"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dim_mgamejp_tbplayerid2qq_nf', 'Create Table': 'CREATE TABLE `dim_mgamejp_tbplayerid2qq_nf` (\n  `dtstatdate` bigint(20) NULL COMMENT "统计日期YYYYMMDD",\n  `sappid` varchar(65533) NULL COMMENT "游戏id",\n  `splayerid` varchar(65533) NULL COMMENT "playerid",\n  `iqq` bigint(20) NULL COMMENT "QQ帐号"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}], [{'Table': 'dws_jordass_uid_login_df', 'Create Table': 'CREATE TABLE `dws_jordass_uid_login_df` (\n  `dtstatdate` varchar(65533) NULL COMMENT "日期",\n  `vgameappid` varchar(65533) NULL COMMENT "账号体系： \'wx\' - 微信 ；\'qq\' - 手Q\t",\n  `platid` bigint(20) NULL COMMENT "系统平台",\n  `vplayerid` varchar(65533) NULL COMMENT "账号id",\n  `uid` bigint(20) NULL COMMENT "角色id",\n  `vrolename` varchar(65533) NULL COMMENT "角色名称",\n  `dregdate` varchar(65533) NULL COMMENT "注册日期",\n  `lastactdate` varchar(65533) NULL COMMENT "最后活跃日期",\n  `cbitmap` varchar(65533) NULL COMMENT "活跃位图",\n  `ilevel` varchar(65533) NULL COMMENT "账号等级",\n  `friendcount` bigint(20) NULL COMMENT "好友数",\n  `historymaxsegment` bigint(20) NULL COMMENT "历史最高段位",\n  `gender` bigint(20) NULL COMMENT "游戏内性别"\n) ENGINE=OLAP \nDUPLICATE KEY(`dtstatdate`)\nDISTRIBUTED BY HASH(`dtstatdate`) BUCKETS 10 \nPROPERTIES (\n"replication_num" = "1",\n"in_memory" = "false",\n"storage_format" = "DEFAULT",\n"enable_persistent_index" = "false",\n"compression" = "LZ4"\n);'}]]
schema_links:  [dws_jordass_uid_login_df.cbitmap,dws_jordass_uid_login_df.gender,dws_jordass_uid_login_df.vplayerid,dws_jordass_uid_login_df.vgameappid,qq,20250724,20250725]
Selected goldensql references: [33, 38, 45]
classification_result: {'sub_questions': '在2025-07-24到2025-07-25期间，哪些qq用户持续活跃？","在2025-07-24活跃但在2025-07-25流失的qq用户有哪些？', 'flag': 'NESTED'}
sql: 
with 
active_users as (
    select vplayerid, gender
    from dws_jordass_uid_login_df
    where dtstatdate = '20250724' 
    and vgameappid = 'qq'
    and substr(cbitmap,1,2) = '11'
),
lost_users as (
    select vplayerid, gender
    from dws_jordass_uid_login_df
    where dtstatdate = '20250724' 
    and vgameappid = 'qq'
    and substr(cbitmap,1,1) = '1'
    and substr(cbitmap,2,1) = '0'
)

select 
    '7月24~7月25日持续活跃' as user_type,
    gender,
    count(distinct vplayerid) as user_count
from active_users
group by gender

union all

select 
    '7.24活跃7.25流失到盘外' as user_type,
    gender,
    count(distinct vplayerid) as user_count
from lost_users
group by gender;

[]
Finished processing sql sql_120 in 34.480122566223145 seconds
{'sql_id': 'sql_120', 'sql': "\nwith \nactive_users as (\n    select vplayerid, gender\n    from dws_jordass_uid_login_df\n    where dtstatdate = '20250724' \n    and vgameappid = 'qq'\n    and substr(cbitmap,1,2) = '11'\n),\nlost_users as (\n    select vplayerid, gender\n    from dws_jordass_uid_login_df\n    where dtstatdate = '20250724' \n    and vgameappid = 'qq'\n    and substr(cbitmap,1,1) = '1'\n    and substr(cbitmap,2,1) = '0'\n)\n\nselect \n    '7月24~7月25日持续活跃' as user_type,\n    gender,\n    count(distinct vplayerid) as user_count\nfrom active_users\ngroup by gender\n\nunion all\n\nselect \n    '7.24活跃7.25流失到盘外' as user_type,\n    gender,\n    count(distinct vplayerid) as user_count\nfrom lost_users\ngroup by gender;\n", 'status': 'success', 'result': []}
Saved results (streamed) to dataset_exe_result.json
